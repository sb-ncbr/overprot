# VENV
sudo apt install python3-venv
python3 -m venv venv
. venv/bin/activate
python3 -m pip install -r requirements.txt
# sudo apt install pymol
# set 'include-system-site-packages = true' in venv/pyvenv.cfg  # because pymol cannot be installed via pip

# FLASK
. venv/bin/activate
export FLASK_APP='overprot_server'
export FLASK_ENV='development'
flask run

# REDIS-QUEUE
# sudo apt install redis-server
. venv/bin/activate
rq worker overprot_jobs  # run repeatedly to start more workers

# GUNICORN
. venv/bin/activate
gunicorn -w 4 -b 127.0.0.1:4000 overprot_server:app  # 4 workers; module 'overprot_server'; application instance 'app'

# NGINX
# sudo apt install nginx
# configure /etc/nginx/nginx.conf to proxy_pass to gunicorn port
. venv/bin/activate
NGINX_CONF='/home/adam/Workspace/Python/OverProt/OverProt/overprot_flask/nginx/nginx.conf'
sudo nginx -c $NGINX_CONF  # start
sudo nginx -s reload       # reloading the configuration file (default: /etc/nginx/nginx.conf) http>server>location
#sudo nginx -s reopen       # reopening the log files
sudo nginx -s quit         # graceful shutdown
#sudo nginx -s stop         # fast shutdown

## FIREWALL
#sudo ufw allow 'OpenSSH'
#sudo ufw allow 'Nginx Full'
#sudo ufw enable
#sudo ufw status verbose
#sudo ufw app list
##sudo ufw disable
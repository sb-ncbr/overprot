!function(e){"use strict";var t,o,n,i,l,a,r;!function(t){var o;o=function(){let t=e.schemeCategory10.map(t=>e.rgb(t));return{neutral:t.splice(7,1)[0],scheme:t}}(),t.NEUTRAL_COLOR=o.neutral,t.COLOR_SCHEME=o.scheme,t.NEUTRAL_DARK=e.rgb(0,0,0),t.bySseType=function(e){return"h"==(e=e.toLowerCase())?t.NEUTRAL_COLOR:"e"==e?t.COLOR_SCHEME[0]:t.COLOR_SCHEME[1]},t.byIndex0=function(e){return t.COLOR_SCHEME[e%t.COLOR_SCHEME.length]},t.byIndex1=function(e){return e>=1?t.COLOR_SCHEME[(e-1)%t.COLOR_SCHEME.length]:t.NEUTRAL_COLOR},t.byLinHeatmap=function(t,o){const n=t/o;return e.rgb(e.interpolateInferno(n))},t.byExpHeatmap=function(t,o){const n=1-Math.pow(2,-t/o);return e.rgb(e.interpolateInferno(n))}}(t||(t={})),function(e){let t,o,n;!function(e){e[e.Uniform=0]="Uniform",e[e.Type=1]="Type",e[e.Sheet=2]="Sheet",e[e.Stdev=3]="Stdev",e[e.Rainbow=4]="Rainbow"}(t=e.ColorMethod||(e.ColorMethod={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.SymCdf=1]="SymCdf"}(o=e.ShapeMethod||(e.ShapeMethod={})),function(e){e[e.Old=0]="Old",e[e.New=1]="New"}(n=e.LayoutMethod||(e.LayoutMethod={}))}(o||(o={})),function(n){n.CANVAS_HEIGHT=300,n.CANVAS_WIDTH=1200,n.ZOOM_STEP_RATIO=1.25,n.ZOOM_STEP_RATIO_MOUSE=n.ZOOM_STEP_RATIO,n.SHIFT_STEP_RELATIVE=.2,n.MAX_EMPTY_X_MARGIN=0,n.MAX_EMPTY_Y_MARGIN=0,n.MAX_X_ZOOMOUT=1/(1-2*n.MAX_EMPTY_X_MARGIN),n.MAX_Y_ZOOMOUT=1/(1-2*n.MAX_EMPTY_Y_MARGIN),n.TRANSITION_DURATION=e.transition().duration(),n.TOOLTIP_DELAY=600,n.MOUSE_HOLD_BEHAVIOR_INITIAL_SLEEP_TIME=500,n.MOUSE_HOLD_BEHAVIOR_STEP_SLEEP_TIME=50,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT=1e3,n.TOOLTIP_OFFSET={x:12,y:0},n.NODE_STROKE_WIDTH=1,n.NODE_STROKE_WIDTH_HIGHLIGHTED=3,n.EDGE_COLOR="#808080",n.NODE_FILL=t.NEUTRAL_COLOR,n.NODE_STROKE=t.NEUTRAL_COLOR.darker(),n.NODE_LABEL_COLOR="black",n.MINIMAL_WIDTH_FOR_SSE_LABEL=20,n.HEATMAP_MIDDLE_VALUE=5,n.DEFAULT_OCCURRENCE_THRESHOLD=.2,n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY=!0,n.DEFAULT_LAYOUT_METHOD=o.LayoutMethod.New,n.DEFAULT_COLOR_METHOD=o.ColorMethod.Sheet,n.DEFAULT_SHAPE_METHOD=o.ShapeMethod.Rectangle,n.DEFAULT_SHOW_LABELS=!0,n.DEFAULT_SHOW_LEGEND=!0,n.DEFAULT_DISPATCH_EVENTS=!1,n.DEFAULT_LISTEN_EVENTS=!1,n.LENGTH_SCALE=4,n.OCCURRENCE_SCALE=100,n.FLOOR_HEIGHT=1.25*n.OCCURRENCE_SCALE,n.TOP_MARGIN=.35*n.OCCURRENCE_SCALE,n.BOTTOM_MARGIN=.35*n.OCCURRENCE_SCALE,n.LEFT_MARGIN=4*n.LENGTH_SCALE,n.RIGHT_MARGIN=4*n.LENGTH_SCALE,n.GAP_LENGTH=3*n.LENGTH_SCALE,n.KNOB_LENGTH=1*n.LENGTH_SCALE,n.ARC_MAX_DEVIATION=.5*n.OCCURRENCE_SCALE+Math.min(n.TOP_MARGIN,n.BOTTOM_MARGIN)-.1*n.OCCURRENCE_SCALE,n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH=.001,n.ARC_MAX_MINOR=n.ARC_MAX_DEVIATION/(1-Math.sqrt(1-Math.pow(1/(1+2*n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH),2))),n.ARC_SMART_DEVIATION_PARAM_WRT_WORLD_WIDTH=.2,n.HELIX_TYPE="h",n.STRAND_TYPE="e",n.HANGING_TEXT_OFFSET=5,n.RESET_SYMBOL="&#x27F3;",n.OPEN_POPUP_SYMBOL=" &#x25BE;",n.EVENT_PREFIX="PDB.overprot.",n.EVENT_TYPE_SELECT="select",n.EVENT_TYPE_HOVER="hover",n.EVENT_TYPE_DO_SELECT="do.select",n.EVENT_TYPE_DO_HOVER="do.hover",n.ICON_LEGEND='<svg viewBox="0 0 100 100"><path d="M18,21 h12 v12 h-12 z M37,21 h45 v12 h-45 z M18,42 h12 v12 h-12 z M37,42 h45 v12 h-45 z M18,63 h12 v12 h-12 z M37,63 h45 v12 h-45 z"></path></svg>',n.ICON_LEGEND_CHECKED='<svg viewBox="0 0 100 100"><path d="M18,21 h12 v12 h-12 z M37,21 h45 v12 h-45 z M18,42 h12 v12 h-12 z M37,42 h45 v12 h-45 z M18,63 h12 v12 h-12 z M37,63 h45 v12 h-45 z"></path><path erase style="stroke-width: 17px" d="M58,62 l12,22 h1 l22,-34"></path><path nofill style="stroke-width: 7px;" d="M60,66 l10,18 h1 l20,-30"></path></svg>',n.ICON_LABELS='<svg viewBox="0 0 100 100"><path d="M20,80 L44,20 H56 L80,80 L70,80 L64,65 L36,65 L30,80 z M40,55 L50,30 L60,55 z"></path></svg>',n.ICON_LABELS_CHECKED='<svg viewBox="0 0 100 100"><path d="M20,80 L44,20 H56 L80,80 L70,80 L64,65 L36,65 L30,80 z M40,55 L50,30 L60,55 z"></path><path erase style="stroke-width: 17px" d="M58,62 l12,22 h1 l22,-34"></path><path nofill style="stroke-width: 7px;" d="M60,66 l10,18 h1 l20,-30"></path></svg>',n.ICON_BETA_CONNECTIVITY='<svg viewBox="0 0 100 100"><path nofill style="stroke-width: 7px;" d="M20,65 A30,40 0 0,1 80,65"></path></svg>',n.ICON_BETA_CONNECTIVITY_CHECKED='<svg viewBox="0 0 100 100"><path nofill style="stroke-width: 7px;" d="M20,65 A30,40 0 0,1 80,65"></path><path erase style="stroke-width: 17px" d="M58,62 l12,22 h1 l22,-34"></path><path nofill style="stroke-width: 7px;" d="M60,66 l10,18 h1 l20,-30"></path></svg>',n.ICON_PLUS='<svg viewBox="0 0 100 100"><path d="M25,45 H45 V25 H55 V45 H75 V55 H55 V75 H45 V55 H25 z"></path></svg>',n.ICON_MINUS='<svg viewBox="0 0 100 100"><path d="M25,45 H75 V55 H25 z"></path></svg>',n.ICON_RESET='<svg viewBox="0 0 100 100"><path d="M50,25 A25,25,0,1,0,75,50 H65 A15,15,0,1,1,50,35 V47 L70,31 L50,15 z"></path></svg>',n.ICON_CAMERA='<svg viewBox="0 0 100 100"><path d="M15,30 H32 L40,22 H60 L68,30 H85 V72 H15 z M34,50 A16,16,0,0,0,66,50 A16,16,0,0,0,34,50 z M40,50 A10,10,0,0,0,60,50 A10,10,0,0,0,40,50 z M80,35 V41 H72 V35 z "></path></svg>'}(n||(n={})),function(e){function t(e){return[e.x+.5*e.width,e.y+.5*e.height]}function o(e,t){e.zoomout=i(t,e.minZoomout,e.maxZoomout),e.xZoomout=i(e.zoomout,e.minXZoomout,e.maxXZoomout),e.yZoomout=i(e.zoomout,e.minYZoomout,e.maxYZoomout)}function i(e,t,o){return Math.min(Math.max(e,t),o)}function l(e,t=0){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}e.newRectangle=function(){return{x:-1,y:-1,width:2,height:2}},e.rectangleFromCanvas=function(e){return{x:0,y:0,width:+e.style("width").replace("px",""),height:+e.style("height").replace("px","")}},e.rectangleCenter=t,e.newZoomInfo=function(e,t,o,n,l){e>t&&console.warn("newZoomInfo(): minXZoomout > maxXZoomout"),o>n&&console.warn("newZoomInfo(): minYZoomout > maxYZoomout");let a=Math.min(e,o),r=Math.max(t,n),s=i(l,a,t);return{zoomout:s,xZoomout:i(s,e,t),yZoomout:i(s,o,n),minZoomout:a,maxZoomout:r,minXZoomout:e,maxXZoomout:t,minYZoomout:o,maxYZoomout:n,initialZoomout:l}},e.zoomInfoZoomOut=function(e,t){o(e,e.zoomout*t)},e.zoomInfoSetZoomout=o,e.zoomAllZoomout=function(e,t){return Math.max(e.width/t.width,e.height/t.height)},e.centeredVisWorld=function(e,o,n){let i=o.width*n.xZoomout,l=o.height*n.yZoomout,[a,r]=t(e);return{x:a-.5*i,y:r-.5*l,width:i,height:l}},e.constrain=i,e.arcPathD_circle=function(e,t,o,n,i=1){if(0==t)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:l,y1:a,x2:r,y2:s}=e,d=r-l,c=s-a,h=Math.abs(d),u=t*h/(h+o),p=u/2+(Math.pow(d/i,2)+Math.pow(c,2))/(8*u);return`M${r},${s} A${p*i},${p} 0 0,${n?1:0} ${l},${a}`}},e.arcPathD_ellipse=function(e,t,o,i,l=1){if(0==o)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:a,y1:r,x2:s,y2:d}=e,c=d-r,h=s-a,u=h/l,p=Math.sqrt(Math.pow(u,2)+Math.pow(c,2))/2+n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH*t/l,v=Math.min(o*Math.sqrt(Math.abs(h)/t),p),f=Math.atan(c/u),[E,g,m]=function(e,t,o,n){const{cos:i,sin:l,sqrt:a,atan:r}=Math;if(1==n)return[e,t,o];if(0==o||0==l(2*o))return[n*e,t,o];if(e==t)return[n*e,t,0];const s=Math.pow(n,2)*Math.pow(e,2)*Math.pow(i(o),2)+Math.pow(e,2)*Math.pow(l(o),2),d=2*(1-Math.pow(n,2))*e*t*i(o)*l(o),c=Math.pow(n,2)*Math.pow(t,2)*Math.pow(l(o),2)+Math.pow(t,2)*Math.pow(i(o),2),h=d,u=2*(s-c),p=-d,v=Math.pow(u,2)-4*h*p;let f=(-u+a(v))/(2*h),E=(-u-a(v))/(2*h),g=a((s+d*f+c*Math.pow(f,2))/(1+Math.pow(f,2))),m=a((s+d*E+c*Math.pow(E,2))/(1+Math.pow(E,2)));g<m&&([f,E]=[E,f],[g,m]=[m,g]);const _=1/(1+Math.pow(f,2)),w=1-_,T=f/(1+Math.pow(f,2)),A=Math.pow(e,2)*i(o)*l(o)*_+e*t*T+Math.pow(t,2)*i(o)*l(o)*w,M=n*(Math.pow(e,2)*Math.pow(i(o),2)*_-Math.pow(t,2)*Math.pow(l(o),2)*w);let O=r(A/M);return[g,m,O]}(p,v,f,l);return`M${s},${d} A${E},${g} ${m*=180/Math.PI} 0,${i?1:0} ${a},${r}`}},e.arcPathD_bezier=function(e,t,o,n,i=1){if(0==t)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:i,y1:l,x2:a,y2:r}=e,s=a-i,d=Math.abs(s),c=t*d/(d+o)*(n?-1:1);const h=.05*s,u=1.32;return`M${i},${l} C${i+h},${l-c*u} ${a-h},${r-c*u} ${a},${r}`}},e.symCdfPolygonPoints=function(e,o){let[n,i]=t(e),a=o[o.length-1][0],r=o[0][0]>0?1:1-o[0][1],s=.5*e.width/a,d=.5*e.height/r,c=[];o[0][0]>0&&(c.push([0,d]),c.push([o[0][0]*s,d])),c.push([o[0][0]*s,(1-o[0][1])*d]);for(let e=1;e<o.length;e++)c.push([o[e][0]*s,(1-o[e-1][1])*d]),c.push([o[e][0]*s,(1-o[e][1])*d]);let h=[];for(let e=0;e<c.length-1;e++)h.push([n+c[e][0],i+c[e][1]]);for(let e=c.length-1;e>0;e--)h.push([n+c[e][0],i-c[e][1]]);for(let e=0;e<c.length-1;e++)h.push([n-c[e][0],i-c[e][1]]);for(let e=c.length-1;e>0;e--)h.push([n-c[e][0],i+c[e][1]]);return h.map(e=>l(e[0],1)+","+l(e[1],1)).join(" ")},e.rectToScreen=function(e,t,o){let{x:n,y:i,width:l,height:a}=o;return{x:(n-e.x)/e.width*t.width+t.x,y:(i-e.y)/e.height*t.height+t.y,width:l/e.width*t.width,height:a/e.height*t.height}},e.lineToScreen=function(e,t,o){let{x1:n,y1:i,x2:l,y2:a}=o;return{x1:(n-e.x)/e.width*t.width+t.x,y1:(i-e.y)/e.height*t.height+t.y,x2:(l-e.x)/e.width*t.width+t.x,y2:(a-e.y)/e.height*t.height+t.y}},e.round=l}(i||(i={})),function(t){function o(){return{nodes:[],precedence:[],beta_connectivity:[],levels:[],precedenceLines:[],activeNodes:[],origPrecedence:[],origBetaConnectivity:[],error:null}}function l(e){let t={nodes:[],precedence:[],beta_connectivity:[],levels:[],precedenceLines:[],activeNodes:[],origPrecedence:[],origBetaConnectivity:[],error:null};return t.error=e,t}function a(e,t,o,n){let i=o[e].filter(e=>e!=t);for(;i.length>0;){let e=i.pop();if(-1!=n[e]&&n[e]<n[t])i.push(...o[e]);else if(e==t)return!0}return!1}function r(e,t){let o=new Array(e),n=new Array(e);for(let t=0;t<e;t++)o[t]=[],n[t]=[];return t.forEach(e=>{o[e[1]].push(e[0]),n[e[0]].push(e[1])}),{ins:o,outs:n}}t.newDag=o,t.dagFromJson=function(t){var o;let n=null;try{let i=JSON.parse(t);return n=i.error=null!==(o=i.error)&&void 0!==o?o:null,i.nodes.forEach(e=>e.active=!0),i.levels=[],i.precedenceLines=[],i.activeNodes=e.range(i.nodes.length),i.origPrecedence=i.precedence,i.origBetaConnectivity=i.beta_connectivity,function(e){var t,o;for(let n=0;n<e.beta_connectivity.length;n++){const i=e.beta_connectivity[n],l=i[0],a=i[1];void 0==e.nodes[l].ladders&&(e.nodes[l].ladders=[]),null===(t=e.nodes[l].ladders)||void 0===t||t.push(n),void 0==e.nodes[a].ladders&&(e.nodes[a].ladders=[]),null===(o=e.nodes[a].ladders)||void 0===o||o.push(n)}}(i),i}catch(e){return n=null!==n&&void 0!==n?n:"Failed to parse input file.",console.warn(n,"\n",e,"\n",t),l(n)}},t.newDagWithError=l,t.newNodeVisual=function(){return{rect:i.newRectangle(),fill:n.NODE_FILL.hex(),stroke:n.NODE_STROKE.hex()}},t.filterDagAndAddLevels=function(t,o){let n=t.nodes.length;for(let e of t.nodes)e.active=e.occurrence>=o&&e.avg_length>0;let i=e.range(n).filter(e=>t.nodes[e].active),{ins:l,outs:s}=r(n,t.origPrecedence);for(let e=0;e<n;e++)if(!t.nodes[e].active)for(let t of l[e])for(let o of s[e])s[t].includes(o)||(s[t].push(o),l[o].push(t));t.activeNodes=i,t.precedence=[];for(let e of i)for(let o of s[e])t.nodes[o].active&&t.precedence.push([e,o]);!function(e){let t=[],o=new Set(e.activeNodes),n=e.precedence;for(;o.size>0;){let e=new Set(o);n.forEach(t=>e.delete(t[1])),n=n.filter(t=>!e.has(t[0])),e.forEach(e=>o.delete(e)),t.push(Array.from(e))}e.levels=t}(t),function(e){let t=e.nodes.length,o=new Array(t).fill(-1);e.levels.forEach((e,t)=>e.forEach(e=>o[e]=t));let n=[],{outs:i}=r(t,e.precedence);for(let t=0;t<e.levels.length;t++){const l=e.levels[t];l.forEach(e=>{i[e].forEach(l=>{o[l]!=t+1&&a(e,l,i,o)||n.push([e,l])})})}e.precedence=n}(t)},t.getNodeMinMaxLength=function(e){let t=e.cdf.map(e=>e[0]).filter(e=>e>0);return 0==t.length?[0,0]:[t[0],t[t.length-1]]}}(l||(l={})),function(t){function a(){return{file:"",width:n.CANVAS_WIDTH,height:n.CANVAS_HEIGHT,colorMethod:n.DEFAULT_COLOR_METHOD,shapeMethod:n.DEFAULT_SHAPE_METHOD,layoutMethod:n.DEFAULT_LAYOUT_METHOD,betaConnectivityVisibility:n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY,occurrenceThreshold:n.DEFAULT_OCCURRENCE_THRESHOLD,showLabels:n.DEFAULT_SHOW_LABELS,showLegend:n.DEFAULT_SHOW_LEGEND,dispatchEvents:n.DEFAULT_DISPATCH_EVENTS,listenEvents:n.DEFAULT_LISTEN_EVENTS}}function r(e,t,o,n){return null===t?n:void 0!==o[t]?o[t]:(console.warn(`Attribute "${e}" has invalid value "${t}". Allowed values: ${Object.keys(o)}.`),n)}function s(e,t,o,n=[]){if(null===t)return o;{let i=parseInt(t);return isNaN(i)?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be an integer.`),o):n.length>=2&&(i<n[0]||i>n[1])?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be an integer between ${n[0]} and ${n[1]}.`),o):i}}t.newViewer=function(e,t,o,n,r,s,c=null){return{id:e,internalId:t,d3viewer:o,mainDiv:n,guiDiv:r,canvas:s,data:l.newDag(),world:i.newRectangle(),visWorld:i.newRectangle(),screen:i.rectangleFromCanvas(s),zoom:i.newZoomInfo(1,1,1,1,1),settings:null!==c&&void 0!==c?c:a(),nodeMap:new Map,ladderMap:new d}},t.newSettings=a,t.newSettingsFromHTMLElement=function(t){var i;let l=["id","file","width","height","color-method","shape-method","layout-method","beta-connectivity","occurrence-threshold","show-labels","show-legend","dispatch-events","listen-events"];["file"].forEach(e=>{t.hasAttribute(e)||console.error(`Missing attribute: "${e}".`)});for(let e=0;e<t.attributes.length;e++){let o=t.attributes.item(e).name;l.includes(o)||console.warn(`Unknown attribute: "${o}"`)}let a=e.select(t);const d={uniform:o.ColorMethod.Uniform,type:o.ColorMethod.Type,sheet:o.ColorMethod.Sheet,variability:o.ColorMethod.Stdev,rainbow:o.ColorMethod.Rainbow},c={rectangle:o.ShapeMethod.Rectangle,symcdf:o.ShapeMethod.SymCdf},h={old:o.LayoutMethod.Old,new:o.LayoutMethod.New},u={on:!0,off:!1,true:!0,false:!1,1:!0,0:!1};return{file:null!==(i=a.attr("file"))&&void 0!==i?i:"",height:s("height",a.attr("height"),n.CANVAS_HEIGHT),width:s("width",a.attr("width"),n.CANVAS_WIDTH),colorMethod:r("color-method",a.attr("color-method"),d,n.DEFAULT_COLOR_METHOD),shapeMethod:r("shape-method",a.attr("shape-method"),c,n.DEFAULT_SHAPE_METHOD),layoutMethod:r("layout-method",a.attr("layout-method"),h,n.DEFAULT_LAYOUT_METHOD),betaConnectivityVisibility:r("beta-connectivity",a.attr("beta-connectivity"),u,n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY),occurrenceThreshold:function(e,t,o,n=[],i=!1){if(null===t)return o;{let l=parseFloat(t);return i&&t.includes("%")&&(l*=.01),isNaN(l)?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be a float.`),o):n.length>=2&&(l<n[0]||l>n[1])?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be a float between ${n[0]} and ${n[1]}.`),o):l}}("occurrence-threshold",a.attr("occurrence-threshold"),n.DEFAULT_OCCURRENCE_THRESHOLD,[0,1],!0),showLabels:r("show-labels",a.attr("show-labels"),u,n.DEFAULT_SHOW_LABELS),showLegend:r("show-legend",a.attr("show-legend"),u,n.DEFAULT_SHOW_LEGEND),dispatchEvents:r("dispatch-events",a.attr("dispatch-events"),u,n.DEFAULT_DISPATCH_EVENTS),listenEvents:r("listen-events",a.attr("listen-events"),u,n.DEFAULT_LISTEN_EVENTS)}};class d{constructor(){this.map=void 0,this.value=void 0}get(e){var t;let o=this;for(const n of e)if(void 0==(o=null===(t=o.map)||void 0===t?void 0:t.get(n)))return;return o.value}set(e,t){let o=this;for(const t of e)o.map||(o.map=new Map),o.map.has(t)||o.map.set(t,new d),o=o.map.get(t);o.value=t}entries(){let e=[];return this.collectEntries([],e),e}collectEntries(e,t){if(void 0!=this.value&&t.push([[...e],this.value]),void 0!=this.map)for(const[o,n]of this.map.entries())e.push(o),n.collectEntries(e,t),e.pop()}}t.TupleMap=d}(a||(a={})),function(e){function t(){return{levels:[],edges:[],vertices:[],in_neighbors:new Map}}function o(e,t){let o=[];for(const t of e)for(const e of t)o.push(e);let i=new Set(o),l=[];for(const e of t)i.has(e[0])&&i.has(e[1])&&l.push(e);let a={levels:e,edges:l,vertices:o,in_neighbors:new Map};return n(a),a}function n(e){for(const t of e.vertices)e.in_neighbors.set(t,[]);for(const[t,o]of e.edges)e.in_neighbors.get(o).push(t)}function i(e,t,n){let i=e.levels.slice(t,n),l=[];for(let t=1;t<i.length;t++)for(const o of i[t])for(const t of e.in_neighbors.get(o))l.push([t,o]);return o(i,l)}function l(e,n,d){return s(function(e){const o=function(e,t){const o=function(e){let t=new Map;for(const o of e)t.set(o,o);return t}(e);for(const[e,n]of t)u(o,e,n);return function(e){const t=new Map;for(const o of e.keys()){const n=h(e,o);t.has(n)?t.get(n).push(o):t.set(n,[o])}const o=[...t.values()];for(const e of o)e.sort();return o.sort(),o}(o)}(e.vertices,e.edges),n=o.length,i=new Map;for(let e=0;e<o.length;e++){const t=o[e];for(const o of t)i.set(o,e)}const l=[];for(let e=0;e<n;e++)l.push(t());for(let t=0;t<e.levels.length;t++)for(const o of e.levels[t]){const e=i.get(o),n=l[e].levels;n.length<=t&&n.push([]),p(n.length==t+1,"levs.length != iLevel + 1"),n[t].push(o),l[e].vertices.push(o),l[e].in_neighbors.set(o,[])}for(const t of e.edges){const[e,o]=t,n=i.get(e);p(i.get(o)==n,"vertex2component.get(v) != iComp"),l[n].edges.push(t),l[n].in_neighbors.get(o).push(e)}return l}(e).map(e=>(function(e,t,n){const d=function(e){let t=new Map,n=0,l=[],a=-1;const r=e.levels.length;for(let s=0;s<r;s++){const r=e.levels[s];for(let o=0;o<r.length;o++){const n=r[o],i=new Set(e.in_neighbors.get(n));for(const o of e.in_neighbors.get(n))for(const e of t.get(o))i.add(e);t.set(n,i)}if(1==r.length&&t.get(r[0]).size==n){const d=r[0];s>a+1&&l.push(i(e,a+1,s)),l.push(o([[d]],[])),t.clear(),t.set(d,new Set),a=s,n=1}else n+=r.length}return r>a+1&&l.push(i(e,a+1,r)),l}(e);if(1==d.length)return function(e,t,o,n=1024){const i=function(e,t){let o=1;for(const n of e)for(let e=n.length;e>0;e--)if((o*=e)>t)return t;return o}(e.levels,n+1);if(1==e.vertices.length||i>n)return a(e.levels,t,o=o);{let n=null,i=1/0;const l=e.levels.map(e=>(function e(t,o=!1){if(0==t.length)return[[]];const n=[];let i=t[0];let l=t.slice(1,void 0);for(let o=0;o<t.length;o++){for(const t of e(l,!0))t.push(i),n.push(t);[i,l[o]]=[l[o],i]}if(!o)for(const e of n)e.reverse();return n})(e,!0));for(const r of function e(t,o=0){if(o==t.length)return[[]];const n=[];for(const i of t[o])for(const l of e(t,o+1))l.push(i),n.push(l);if(0==o)for(const e of n)e.reverse();return n}(l)){const l=a(r,t,o),[s,d]=l;let c=0;for(const[t,o]of e.edges)c+=Math.abs(d.get(t).y-d.get(o).y);c<i&&(n=l,i=c)}return p(null!=n,"bestEmbedding is null",n),n}}(d[0],t,n);{const e=d.map(e=>l(e,t,n)),o=s(e,r.HORIZONTAL,n);return o}})(e,n,d)),r.VERTICAL_REARRANGED,d)}function a(e,t,o){const n=[];for(const i of e){const e=[];for(const o of i){const{width:n,height:i,weight:l}=t.get(o),a={left:n/2,right:n/2,top:i/2,bottom:i/2,weight:l},r=new Map([[o,{x:0,y:0}]]);e.push([a,r])}const l=s(e,r.VERTICAL,o);n.push(l)}return s(n,r.HORIZONTAL,o)}let r;function s(e,t,o){const n=e.map(e=>e[0]),i=e.map(e=>e[1]);let l,a;if(t==r.HORIZONTAL)[l,a]=function(e,t){const o=(d(e.map(e=>e.left+e.right))+(e.length-1)*t.x)/2,n=o,i=Math.max(...e.map(e=>e.top)),l=Math.max(...e.map(e=>e.bottom)),a=d(e.map(e=>e.weight));let r=[],s=-o;for(const o of e)s+=o.left,r.push({x:s,y:0}),s+=o.right,s+=t.x;return[{left:o,right:n,top:i,bottom:l,weight:a},r]}(n,o);else if(t==r.VERTICAL)[l,a]=c(n,o);else{if(t!=r.VERTICAL_REARRANGED)throw new Error("direction must be HORIZONTAL or VERTICAL or VERTICAL_REARRANGED");[l,a]=c(n,o,!0)}let s=new Map;for(let t=0;t<e.length;t++)for(const[e,o]of i[t])s.set(e,(h=a[t],u=o,{x:h.x+u.x,y:h.y+u.y}));var h,u;return[l,s]}function d(e){let t=0;for(const o of e)t+=o;return t}function c(e,t,o=!1){e.length;let n=0,i=0,l=0;const a=o?function(e){const t=e.map((e,t)=>[t,e]);t.sort((e,t)=>t[1].weight-e[1].weight);let o=[],n=[];for(let e=0;e<t.length;e++)e%2==0?o.push(t[e]):n.push(t[e]);return n.reverse(),n.push(...o),n}(e):e.map((e,t)=>[t,e]);for(const[e,o]of a)l+=o.top,n+=o.weight,i+=o.weight*l,l+=o.bottom,l+=t.y;const r=n>0?i/n:0,s=[];l=-r;for(const[e,o]of a)l+=o.top,s[e]={x:0,y:l},l+=o.bottom,l+=t.y;const d=r,c=l-t.y;return[{left:Math.max(...e.map(e=>e.left)),right:Math.max(...e.map(e=>e.right)),top:d,bottom:c,weight:n},s]}function h(e,t){const o=e.get(t);if(o==t)return t;{const n=h(e,o);return e.set(t,n),n}}function u(e,t,o){const n=h(e,t),i=h(e,o),l=Math.min(n,i);return e.set(n,l),e.set(i,l),l}function p(e,...t){if(!e)throw console.error("AssertionError:",...t),new Error("AssertionError")}e.newDagEmpty=t,e.newDagFromPath=function(e){let t={levels:e.map(e=>[e]),edges:[],vertices:[...e],in_neighbors:new Map};for(let o=0;o<e.length-1;o++)t.edges.push([e[o],e[o+1]]);return n(t),t},e.newDagFromPrecedence=o,e.embedDag=function(e,t,o={x:0,y:0},n=0,i=0,a=0,r=0){let s,d;return 0==e.vertices.length?(s={left:0,right:0,top:0,bottom:0,weight:0},d=new Map):[s,d]=l(e,t,o),s.left+=n,s.right+=i,s.top+=a,s.bottom+=r,[s,d]},function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL",e[e.VERTICAL_REARRANGED=2]="VERTICAL_REARRANGED"}(r||(r={}))}(r||(r={}));var s,d,c=function(e,t,o,n){return new(o||(o=Promise))(function(i,l){function a(e){try{s(n.next(e))}catch(e){l(e)}}function r(e){try{s(n.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(a,r)}s((n=n.apply(e,t||[])).next())})};!function(l){function r(e,t=n.ZOOM_STEP_RATIO,o){i.zoomInfoZoomOut(e.zoom,t);let[l,a]=void 0!=o?[o[0]/e.screen.width,o[1]/e.screen.height]:[.5,.5],r=e.screen.width*e.zoom.xZoomout,d=e.screen.height*e.zoom.yZoomout,{x:c,y:h,width:u,height:p}=e.visWorld;e.visWorld.x=c+(u-r)*l,e.visWorld.y=h+(p-d)*a,e.visWorld.width=r,e.visWorld.height=d,x(e),v(e),s(e)}function s(e){e.mainDiv.selectAll("div.button#zoom-out").attr("disabled",e.zoom.zoomout>=e.zoom.maxZoomout?"true":null),e.mainDiv.selectAll("div.button#zoom-in").attr("disabled",e.zoom.zoomout<=e.zoom.minZoomout?"true":null),e.mainDiv.selectAll("div.button#zoom-reset").attr("disabled",e.zoom.zoomout==e.zoom.initialZoomout?"true":null)}function d(t,o){return(o=o||t.mainDiv.select("div.tooltip")).style("left",e.event.clientX+n.TOOLTIP_OFFSET.x).style("top",e.event.clientY+n.TOOLTIP_OFFSET.y)}function h(t,o,n=(t=>e.select(t)),i=null){o.on("mouseenter.point",(e,t,o)=>{let l=n(o[t]);l.attr("pointed","pointed"),null!=i&&i(l)}),o.on("mouseleave.point",(t,o,l)=>{n(l[o]).attr("pointed",null),null!=i&&i(e.selectAll())})}function u(e){return new Promise(t=>setTimeout(t,e))}function p(e,n){return e.settings.colorMethod==o.ColorMethod.Stdev||e.settings.colorMethod==o.ColorMethod.Rainbow?t.NEUTRAL_DARK.hex():e.data.nodes[n[0]].visual.stroke}function v(e,t=!0){let o=t?n.TRANSITION_DURATION:0,l=e.canvas.select("g.nodes").selectAll("g.node").filter(e=>e.active);l.select("rect").transition().duration(o).attrs(t=>i.rectToScreen(e.visWorld,e.screen,t.visual.rect)),l.select("polygon").transition().duration(o).attr("points",t=>i.symCdfPolygonPoints(i.rectToScreen(e.visWorld,e.screen,t.visual.rect),t.cdf));let a=l.select("text").data().map(t=>f(e,t));l.select("text").style("fill",n.NODE_LABEL_COLOR).transition().duration(o).attrs(t=>{let{x:o,y:l,height:a,width:r}=i.rectToScreen(e.visWorld,e.screen,t.visual.rect);return{x:o+r/2,y:l+a+n.HANGING_TEXT_OFFSET}}).style("opacity",(t,o)=>e.settings.showLabels&&a[o]?1:0).transition().duration(0).style("fill",(e,t)=>a[t]?n.NODE_LABEL_COLOR:"none"),e.canvas.select("g.edges").selectAll("line").transition().duration(o).attrs(t=>i.lineToScreen(e.visWorld,e.screen,t));n.ARC_MAX_MINOR,e.zoom.yZoomout;let r=e.data;r.beta_connectivity.forEach(e=>e[3]=r.nodes[e[0]].active&&r.nodes[e[1]].active?1:0),e.canvas.select("g.beta-connectivity").selectAll("path").transition().duration(o).attr("d",t=>(function(e,t){if(0==t[3])return"";let[o,l,a]=t,r=e.data.nodes[o].visual.rect,s=e.data.nodes[l].visual.rect,d=i.lineToScreen(e.visWorld,e.screen,{x1:r.x+.5*r.width,y1:r.y+.5*r.height,x2:s.x+.5*s.width,y2:s.y+.5*s.height}),c=e.zoom.yZoomout/e.zoom.xZoomout,h=n.ARC_MAX_MINOR/e.zoom.yZoomout;return i.arcPathD_ellipse(d,e.world.width/e.zoom.xZoomout,h,1==a,c)})(e,t))}function f(e,t){return i.rectToScreen(e.visWorld,e.screen,t.visual.rect).width>=n.MINIMAL_WIDTH_FOR_SSE_LABEL}l.zoomOut=r,l.zoomIn=function(e,t=n.ZOOM_STEP_RATIO,o){r(e,1/t,o)},l.zoomAll=function(e){i.zoomInfoSetZoomout(e.zoom,e.zoom.initialZoomout),e.visWorld=i.centeredVisWorld(e.world,e.screen,e.zoom),v(e),s(e)},l.zoomSet=function(e,t,o){i.zoomInfoSetZoomout(e.zoom,t);let[n,l]=null!==o&&void 0!==o?o:i.rectangleCenter(e.visWorld),a=e.screen.width*e.zoom.xZoomout,r=e.screen.height*e.zoom.yZoomout;e.visWorld={x:n-.5*a,y:l-.5*r,width:a,height:r},x(e),v(e,!1),s(e)},l.shift=function(e,t,o){let{width:n,height:i}=e.visWorld;e.visWorld.x+=t*n,e.visWorld.y+=o*i,x(e),v(e)},l.shiftByMouse=function(e,t,o){let{width:n,height:i}=e.visWorld,{width:l,height:a}=e.screen;e.visWorld.x+=t*n/l,e.visWorld.y+=o*i/a,x(e),v(e,!1)},l.save=function(t){const o=t.screen.width,n=t.screen.height,i=new XMLSerializer;t.canvas.attr("rendering","rendering");const l=i.serializeToString(t.canvas.node());t.canvas.attr("rendering",null);const a=new Image(o,n);a.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(l)));const r=e.select(document.createElement("canvas")).attr("width",o).attr("height",n);e.select(a).on("load",()=>{r.node().getContext("2d").drawImage(a,0,0,o,n),function(e,t){const o=document.createElement("a");o.download=t,o.href=e,o.click()}(r.node().toDataURL("image/png").replace("image/png","image/octet-stream"),"overprot.png")})},l.setTooltips=function(t,o,i,l=!1,a=!1){if(null===i)o.on("mouseenter.tooltip",null).on("mousemove.tooltip",null).on("mouseleave.tooltip",null).on("click.tooltip",null);else{let r=i.map(e=>null!=e),s=i.filter(e=>null!=e);o.filter((e,t)=>r[t]).on("mouseenter.tooltip",(o,i,l)=>(function(t,o,i,l=!1){var a;if("pinned"!=e.select(o).attr("tooltip")){let r=t.mainDiv.append("div").attr("class","tooltip").attr("type","hover").html(i);d(t,r),null===(a=e.select(o))||void 0===a||a.attr("tooltip","hover"),R(r,l?n.TOOLTIP_DELAY:0)}})(t,l[i],s[i],a)).on("mousemove.tooltip",(e,o)=>(function(e){d(e,e.mainDiv.selectAll("div.tooltip[type=hover]"))})(t)).on("mouseleave.tooltip",(e,o)=>(function(e){e.mainDiv.selectAll("div.tooltip[type=hover]").remove(),e.mainDiv.selectAll("[tooltip=hover]").attr("tooltip",null)})(t)),l&&o.filter((e,t)=>r[t]).on("click.tooltip",(o,n,i)=>(function(t,o,n){var i;let l=t.mainDiv.append("div").attr("class","tooltip").attr("type","pre-pinned").html(n);d(t,l),null===(i=e.select(o))||void 0===i||i.attr("tooltip","pre-pinned"),t.mainDiv.on("click.tooltip",()=>{t.mainDiv.selectAll("div.tooltip[type=hover],div.tooltip[type=pinned]").remove(),t.mainDiv.selectAll("div.tooltip[type=pre-pinned]").attr("type","pinned"),t.mainDiv.selectAll("[tooltip=hover],[tooltip=pinned]").attr("tooltip",null),t.mainDiv.selectAll("[tooltip=pre-pinned]").attr("tooltip","pinned")})})(t,i[n],s[n])),o.filter((e,t)=>!r[t]).on("mouseenter.tooltip",null).on("mousemove.tooltip",null).on("mouseleave.tooltip",null).on("click.tooltip",null)}},l.addPointBehavior=h,l.addPickBehavior=function(t,o,n=(t=>e.select(t)),i=null){o.on("click.pick",(e,t,o)=>{n(o[t]).attr("picked","pre-picked")}),t.guiDiv.on("click.pick",()=>{t.guiDiv.selectAll("[picked=picked]").attr("picked",null);let e=t.guiDiv.selectAll("[picked=pre-picked]");e.attr("picked","picked"),null!=i&&i(e)})},l.addMouseHoldBehavior=function(t,o,i,l){t.on("mousedown",()=>c(this,void 0,void 0,function*(){if(1==e.event.which||void 0==e.event.which){let e=Math.random().toString(36).slice(2);for(o(),t.attr("pressed",e),yield u(n.MOUSE_HOLD_BEHAVIOR_INITIAL_SLEEP_TIME);t.attr("pressed")==e;)i(),yield u(n.MOUSE_HOLD_BEHAVIOR_STEP_SLEEP_TIME)}})),t.on("mouseup",()=>c(this,void 0,void 0,function*(){t.attr("pressed",null),l()})),t.on("mouseleave",()=>c(this,void 0,void 0,function*(){t.attr("pressed",null),l()}))},l.recolor=function(e,t=!0){let o=t?n.TRANSITION_DURATION:0;e.canvas.select("g.nodes").selectAll("g.node").selectAll("rect,polygon").transition().duration(o).style("fill",e=>e.visual.fill).style("stroke",e=>e.visual.stroke),e.canvas.select("g.beta-connectivity").selectAll("g.ladder").selectAll("path.vis").style("stroke",t=>p(e,t)),A(e,t)},l.redraw=v,l.nodeBigEnoughForLabel=f;const E=200,g=18,m=15,_=5,w=15,T=5;function A(i,a=!0){if(C(i.canvas.selectAll("g.legend")),i.settings.showLegend){let r=i.canvas.select("g.legends").append("g").attr("class","legend"),s=null;switch(i.settings.colorMethod){case o.ColorMethod.Stdev:!function(e,o,n=!0){M(e,o,{x:0,y:0,width:E,height:g},t.NEUTRAL_COLOR,"3D variability [Å]","heatmap")}(i,r,a);break;case o.ColorMethod.Type:!function(e,o,i=!0){let a=M(e,o,{x:0,y:0,width:g,height:g},t.bySseType("H"),"Helix"),r=M(e,o,{x:0,y:0,width:g,height:g},t.bySseType("E"),"Strand");l.addPointBehavior(e,a,()=>L(a,O(e,n.HELIX_TYPE)),t=>l.dispatchMixedEvent(e,n.EVENT_TYPE_HOVER,t.data())),l.addPointBehavior(e,r,()=>L(r,O(e,n.STRAND_TYPE)),t=>l.dispatchMixedEvent(e,n.EVENT_TYPE_HOVER,t.data()))}(i,r,a);break;case o.ColorMethod.Sheet:s=function(e,o,i=!0){let a=new Set;for(let t of e.data.activeNodes){let o=e.data.nodes[t].sheet_id;a.add(o)}a.delete(0);let r=[...a];r.sort((e,t)=>e-t);let s=M(e,o,{x:0,y:0,width:g,height:g},t.bySseType("H"),"Helix");l.addPointBehavior(e,s,()=>L(s,O(e,n.HELIX_TYPE)),t=>l.dispatchMixedEvent(e,n.EVENT_TYPE_HOVER,t.data()));for(let i of r){let a=M(e,o,{x:0,y:0,width:g,height:g},t.byIndex1(i),`β${i}`);l.addPointBehavior(e,a,()=>L(a,y(e,i,!0)),t=>l.dispatchMixedEvent(e,n.EVENT_TYPE_HOVER,t.data()))}return r.length+1}(i,r,a)}i.settings.betaConnectivityVisibility&&function(e,o,n=!0){let i=M(e,o,{x:0,y:0,width:g,height:g},t.NEUTRAL_COLOR,"Parallel","lower_arc"),a=M(e,o,{x:0,y:0,width:g,height:g},t.NEUTRAL_COLOR,"Antiparallel","upper_arc");l.addPointBehavior(e,i,()=>L(i,b(e,1))),l.addPointBehavior(e,a,()=>L(a,b(e,-1)))}(i,r,a),function(t,o,n=null,i=0,l=null){let a=t.nodes(),r=a.map(e=>e.getBBox().width),s=r.reduce((e,t)=>e+t,0)+(a.length-1)*o;if(null!=n&&s>i){if(null!=l){let e=l().node(),t=e.getBBox().width;r.splice(n,0,t),a.splice(n,0,e),s+=t+o}let t=n,d=new Set;for(;s>i;)s-=r[t-=1]+o,d.add(t);for(let t of d)e.select(a[t]).remove();a=a.slice(0,t).concat(a.slice(n,void 0)),r=r.slice(0,t).concat(r.slice(n,void 0))}let d=0;for(let t=0;t<a.length;t++){let n=d-a[t].getBBox().x;e.select(a[t]).attr("transform",`translate(${n},0)`),d+=r[t]+o}}(r.selectAll("g.legend-item"),w,s,i.screen.width-2*m,()=>M(i,r,{x:0,y:0,width:g,height:g},t.NEUTRAL_COLOR,"...","none"));let d=i.screen.width-m-function(e,t=0){let o=e.node().getBBox().width;o>0&&(o+=t);return o}(r),c=i.screen.height-_-g;r.attr("transform",`translate(${d},${c})`),a&&R(r)}}function M(o,i,l,a,r,s="rectangle"){let d,c,h,u,p=i.append("g").attr("class","legend-item");switch(s){case"rectangle":p.append("rect").attrs(Object.assign(Object.assign({},l),{stroke:a.darker().hex(),fill:a.hex()}));break;case"upper_arc":d=l.x,c=l.x+l.width,h=l.y+.6*l.height,u=.5*l.width,p.append("path").attr("d",`M${d},${h} A${u},${u} 0 0,1 ${c},${h}`).attr("fill","none").attr("stroke",a.darker().hex());break;case"lower_arc":d=l.x,c=l.x+l.width,h=l.y+.4*l.height,u=.5*l.width,p.append("path").attr("d",`M${d},${h} A${u},${u} 0 0,0 ${c},${h}`).attr("fill","none").attr("stroke",a.darker().hex());break;case"heatmap":(function(o,i,l,a,r,s,d,c){let h=o.append("g").attr("class","heatmap-bar").attr("transform",`translate(${i.x},${i.y})`),u=d?-n.HANGING_TEXT_OFFSET:i.height+n.HANGING_TEXT_OFFSET,p=d?"alphabetic":"hanging",v=c?-5:i.width+5,f=c?"end":"start",E=(h.append("text").attr("class","heatmap-bar-label").attrs({x:v,y:.5*i.height}).style("text-anchor",f).text(s),Math.floor(i.width)),g=(i.width-1)/E,m=h.append("g").attr("class","heatmap-bar-fill"),_=h.append("g").attr("class","heatmap-bar-stroke");m.selectAll("rect").data(e.range(E)).enter().append("rect").attrs(e=>({x:e*g,y:0,width:g+1,height:i.height,stroke:"none",fill:t.byExpHeatmap(e/E*l,a).hex()})),_.append("rect").attrs(e=>({x:0,y:0,width:i.width,height:i.height,fill:"none"})),h.append("g").attr("class","heatmap-bar-ticks").selectAll("text").data(e.range(Math.floor(l/r)+1)).enter().append("text").attr("x",e=>e*r/l*i.width).attr("y",u).style("dominant-baseline",p).text(e=>e*r)})(p,l,15,5,5,"",!0,!1)}let v="none"!=s?l.x+l.width+T:l.x;return p.append("text").attrs({x:v,y:l.y+.5*l.height}).text(r),p}function O(e,t,o=!1){let n=e.canvas.selectAll("g.node").filter(e=>e.type==t);if(o){n=L(n,e.canvas.selectAll("g.ladder"))}return n}function y(e,t,o=!1){let n=e.canvas.selectAll("g.node").filter(e=>e.sheet_id==t);if(o){n=L(n,e.canvas.selectAll("g.ladder").filter(o=>e.data.nodes[o[0]].sheet_id==t))}return n}function b(e,t){return e.canvas.selectAll("g.ladder").filter(e=>e[2]==t)}function L(...t){let o=[];for(const e of t)o.push(...e.nodes());return e.selectAll(o)}function C(e,t=0){return e.transition().delay(t).duration(n.TRANSITION_DURATION).style("opacity",0).remove()}function R(e,t=0){if(0==e.size())return e.transition();let o=e.style("opacity");return e.style("opacity",0).transition().delay(t).duration(n.TRANSITION_DURATION).style("opacity",o)}function x(e){let{x:t,y:o,width:l,height:a}=e.world,{x:r,y:s,width:d,height:c}=e.visWorld;d<l*n.MAX_X_ZOOMOUT?e.visWorld.x=i.constrain(r,t-n.MAX_EMPTY_X_MARGIN*d,t+l+n.MAX_EMPTY_X_MARGIN*d-d):e.visWorld.x=t+.5*l-.5*d,c<a*n.MAX_Y_ZOOMOUT?e.visWorld.y=i.constrain(s,o-n.MAX_EMPTY_Y_MARGIN*c,o+a+n.MAX_EMPTY_Y_MARGIN*c-c):e.visWorld.y=o+.5*a-.5*c}l.showLegend=A,l.showBetaConnectivity=function(t,o,i=!0){t.settings.betaConnectivityVisibility=o;let r=t.canvas.selectAll("g.beta-connectivity");if(r.size()>0&&!o)i?C(r):r.remove();else if(0==r.size()&&o){let o=t.data;o.beta_connectivity.forEach(e=>e[3]=o.nodes[e[0]].active&&o.nodes[e[1]].active?1:0);let r=t.canvas.append("g").attr("class","beta-connectivity"),s=r.selectAll().data(o.beta_connectivity).enter().append("g").attr("class","ladder");t.ladderMap=new a.TupleMap,s.each((e,o,n)=>{const i=t.data.nodes[e[0]].label,l=t.data.nodes[e[1]].label,a=e[2]>0?"parallel":"antiparallel";t.ladderMap.set([i,l,a],n[o])}),s.append("path").attr("class","vis").style("stroke",e=>p(t,e)),h(0,s.append("path").attr("class","ghost"),o=>(function(t,o,n){let i=e.select(o.parentElement);if(!n)return i;const l=i.data()[0];let a=t.canvas.selectAll("g.node").nodes();return e.selectAll([i.node(),a[l[0]],a[l[1]]])})(t,o,!0),e=>l.dispatchMixedEvent(t,n.EVENT_TYPE_HOVER,e.data())),v(t,!1),i&&R(r)}A(t,i)},l.selectNodeFromShape=function(t,o,n){let i=e.select(o.parentElement);if(!n)return i;let l=[i.node()];const a=i.data()[0];if(void 0!=a.ladders&&a.ladders.length>0){let e=t.canvas.selectAll("g.ladder").nodes();for(const t of a.ladders)l.push(e[t])}return e.selectAll(l)},l.fadeOutRemove=C,l.fadeIn=R,l.dispatchMixedEvent=function(e,t,o){var i;if(!e.settings.dispatchEvents)return;let l=[],a=[];for(const t of o)if(void 0!=t.label){const e=t;l.push({label:e.label,type:e.type,sheetId:"e"==e.type.toLowerCase()?e.sheet_id:null})}else{const o=t;a.push([e.data.nodes[o[0]].label,e.data.nodes[o[1]].label,o[2]>0?"parallel":"antiparallel"])}let r={sourceType:null===(i=e.d3viewer.node())||void 0===i?void 0:i.tagName.toLowerCase(),sourceId:e.id,sourceInternalId:e.internalId,eventType:t,sses:l,ladders:a};e.d3viewer.dispatch(n.EVENT_PREFIX+t,{detail:r,bubbles:!0})},l.handleEvent=function(t,o){var i,l,a,r;const s=o.detail;if(null==s||void 0==s)return void console.error(`Event ${o.type}: event.detail must be an object.`);if(s.sourceType==(null===(i=t.d3viewer.node())||void 0===i?void 0:i.tagName.toLowerCase())&&s.sourceInternalId==t.internalId)return;const d=null!==(l=s.sses)&&void 0!==l?l:[],c=null!==(a=s.ladders)&&void 0!==a?a:[],h=n.EVENT_PREFIX+n.EVENT_TYPE_DO_SELECT,u=n.EVENT_PREFIX+n.EVENT_TYPE_DO_HOVER;let p;switch(o.type){case h:p="picked";break;case u:p="pointed";break;default:return void console.error("Unknown event type for OverProtViewer:",o.type)}t.canvas.selectAll(`g.node[${p}],g.ladder[${p}]`).attr(p,null);for(const n of d){if(void 0==n.label)return void console.error(`Event ${o.type}: event.detail.sses[i].label must be a string.`);const i=t.nodeMap.get(n.label);void 0!=i?e.select(i).attr(p,p):console.warn(`Event ${o.type}: SSE with label "${n.label}" is not present.`)}for(const n of c){if(n.length<3)return void console.error(`Event ${o.type}: event.detail.ladders[i] must be an array of length 3 ([strand1, strand2, "parallel"|"antiparallel"]).`,n);const i=n[0],l=n[1],a=n[2],s=null!==(r=t.ladderMap.get([i,l,a]))&&void 0!==r?r:t.ladderMap.get([l,i,a]);void 0!=s?e.select(s).attr(p,p):console.warn(`Event ${o.type}: Beta-ladder ${n} is not present.`)}o.type==h&&function(e){e.mainDiv.selectAll("div.tooltip[type=pinned]").remove(),e.mainDiv.selectAll("[tooltip=pinned]").attr("tooltip",null)}(t)}}(s||(s={})),function(t){function o(){return e.selectAll()}function l(e,t,n,i,l,r,s){let d={base:{viewer:e,id:t,children:[],div:o(),tooltip:s,show:e=>a(d,e)},text:n,square:i,icon:l,onClick:r};return d}function a(t,o){t.base.div=o.append("div").attr("class",t.square?"button square-button":"button").attr("id",t.base.id);const n=t.icon?"button-icon":"button-text";t.base.div.append("div").attr("class",n).html(t.text),s.setTooltips(t.base.viewer,t.base.div,[t.base.tooltip],!1,!0),t.base.div.on("click",t.onClick),t.base.div.on("dblclick",()=>{e.event.stopPropagation()})}function r(e,t){e.text=t,e.base.div.select("div.button-icon,div.button-text").html(t)}function d(t,i,r,s,d){let c={base:{viewer:t,id:i,children:[],div:o(),tooltip:d,show:e=>(function(e,t){e.base.div=t.append("div").attr("class",e.autocollapse?"popup autocollapse":"popup").attr("id",e.base.id);let o=e.base.div.append("div").attr("class","popup-head");e.base.div.data([e]),a(e.headButton,o)})(c,e)},headButton:l(t,null,r+n.OPEN_POPUP_SYMBOL,!1,!1,()=>(function(t){t.base.div.selectAll("div.popup-tail").size()>0?h(t):(u(t.base.viewer),function(t){t.base.div.select("div.popup-head");let o=t.base.div.append("div").attr("class","popup-tail");t.base.children.forEach(e=>e.base.show(o)),t.autocollapse&&(t.base.viewer.mainDiv.on("click.autocollapse-popups",()=>u(t.base.viewer)),o.on("click.autocollapse-popups",()=>e.event.stopPropagation()))}(t),e.event.stopPropagation())})(c),d),autocollapse:s};return c}function c(e,t){e.base.children.push(t)}function h(e){e.base.div.selectAll("div.popup-tail").remove()}function u(e){e.mainDiv.selectAll("div.popup.autocollapse").each(e=>h(e))}function p(e,t){r(e.headButton,t+n.OPEN_POPUP_SYMBOL)}function v(e,t,n,i,l,a){let r={base:{viewer:e,id:t,children:[],div:o(),tooltip:a,show:e=>(function(e,t){e.base.div=t.append("div").attr("class","listbox").attr("id",e.base.id);e.base.div.selectAll().data(e.namesValuesTooltips).enter().append("div").attr("class",t=>t[1]==e.selectedValue?"button listbox-item selected":"button listbox-item").on("click",t=>{e.selectedValue=t[1],e.base.div.selectAll("div.listbox-item").attr("class",t=>t[1]==e.selectedValue?"button listbox-item selected":"button listbox-item"),e.onSelect(t[1])}).append("div").attr("class","button-text").html(e=>e[0]),s.setTooltips(e.base.viewer,e.base.div.selectAll("div.listbox-item"),e.namesValuesTooltips.map(e=>e[2]),!1,!0),s.setTooltips(e.base.viewer,e.base.div,[e.base.tooltip],!1,!0)})(r,e)},namesValuesTooltips:n,selectedValue:i,onSelect:l};return r}function f(e,t,n,i,l,a,r,s,d,c,h){let u={base:{viewer:e,id:t,children:[],div:o(),tooltip:h,show:e=>E(u,e)},minValue:n,maxValue:i,step:l,selectedValue:a,minValueLabel:null!==r&&void 0!==r?r:n.toString(),maxValueLabel:null!==s&&void 0!==s?s:i.toString(),onMove:d,onRelease:c};return u}function E(t,o){t.base.div=o.append("div").attr("class","slider").attr("id",t.base.id);let n=t.base.div.append("div").attr("class","slider-left-value").text(t.minValueLabel),i=t.base.div.append("div").attr("class","slider-right-value").text(t.maxValueLabel),l=t.base.div.append("div").attr("class","slider-main"),a=l.append("div").attr("class","slider-rail-ruler");a.append("div").attr("class","slider-rail");let r=a.append("div").attr("class","slider-rail-clickable"),d=a.append("div").attr("class","slider-handle-ruler"),c=d.append("div").attr("class","slider-handle"),h=m(t,t.selectedValue);d.style("left",100*h+"%"),s.setTooltips(t.base.viewer,l,[t.base.tooltip],!1,!0),s.setTooltips(t.base.viewer,n,["Click/hold to decrease value."],!1,!0),s.setTooltips(t.base.viewer,i,["Click/hold to increase value."],!1,!0);let u=e.drag().on("start.slider",()=>A(t,e.event.sourceEvent)).on("drag.slider",()=>A(t,e.event.sourceEvent)).on("end.slider",()=>(function(e,t){let o=T(e,t);if(null!==o){let t=_(e,o);t=w(e,t),o=m(e,t),e.base.div.select("div.slider-handle-ruler").style("left",100*o+"%"),e.selectedValue=t,e.onRelease(t)}})(t,e.event.sourceEvent));u(r),u(c),s.addMouseHoldBehavior(n,()=>g(t,-1),()=>g(t,-1),()=>{}),s.addMouseHoldBehavior(i,()=>g(t,1),()=>g(t,1),()=>{})}function g(e,t){let o=i.constrain(e.selectedValue+t*e.step,e.minValue,e.maxValue),n=m(e,o);e.base.div.select("div.slider-handle-ruler").style("left",100*n+"%"),e.selectedValue=o,e.onMove(o),e.onRelease(o)}function m(e,t){let o=(t-e.minValue)/(e.maxValue-e.minValue);return o=i.constrain(o,0,1)}function _(e,t){return e.minValue+t*(e.maxValue-e.minValue)}function w(e,t){let o=Math.round((t-e.minValue)/e.step);return e.minValue+o*e.step}function T(e,t){let o=e.base.div.selectAll("div.slider-rail-ruler").node();if(null!==o){let{x:e,width:n}=o.getBoundingClientRect(),l=(t.clientX-e)/n;return l=i.constrain(l,0,1)}return null}function A(e,t){let o=T(e,t);if(null!==o){let t=_(e,o);o=m(e,t=w(e,t)),e.base.div.select("div.slider-handle-ruler").style("left",100*o+"%"),e.onMove(t)}}t.newControlPanel=function(e,t,n){let i={base:{viewer:e,id:t,children:[],div:o(),tooltip:n,show:e=>(function(e,t){e.base.div=t.append("div").attr("class","control-panel").attr("id",e.base.id),e.base.children.forEach(t=>t.base.show(e.base.div))})(i,e)}};return i},t.addToControlPanel=function(e,t){e.base.children.push(t)},t.newButton=l,t.changeButtonText=r,t.newToggleButton=function(e,t,n,i,l,s,d,c){let h=s,u="string"==typeof n?'<span style="opacity:0;">&check;</span>'+n:n[0],p="string"==typeof n?"&check;"+n:n[1],v={base:{viewer:e,id:t,children:[],div:o(),tooltip:c,show:e=>a(v,e)},text:h?p:u,square:i,icon:l,onClick:()=>{d(h=!h),r(v,h?p:u)}};return v},t.newPopup=d,t.addToPopup=c,t.newListbox=v,t.newDropdownList=function(e,t,o,n,i,l,a,r=!0,s=!0){let u=d(e,t,o,r,a),p=v(e,t,n,i,s?e=>{h(u),l(e)}:l,null);return c(u,p),u},t.newSlider=f,t.showSlider=E,t.newPopupSlider=function(e,t,o,n,i,l,a,r,s,h,u,v,E,g=!0){let m=d(e,t,o+r+n,g,E),_=f(e,t,i,l,a,r,s,h,e=>{p(m,o+e+n),u(e)},e=>{p(m,o+e+n),v(e)},null);return c(m,_),m}}(d||(d={}));var h,u=function(e,t,o,n){return new(o||(o=Promise))(function(i,l){function a(e){try{s(n.next(e))}catch(e){l(e)}}function r(e){try{s(n.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(a,r)}s((n=n.apply(e,t||[])).next())})};!function(c){function h(e,t){e.data=t,l.filterDagAndAddLevels(e.data,e.settings.occurrenceThreshold),p(e)}function p(e){if(e.canvas.selectAll(":scope > :not(defs)").remove(),null!==e.data.error)return void e.canvas.append("text").attr("class","central-message").attrs({x:e.screen.width/2,y:e.screen.height/2}).text("Error: "+e.data.error);if(0==e.data.activeNodes.length)return void e.canvas.append("text").attr("class","central-message").attrs({x:e.screen.width/2,y:e.screen.height/2}).text("No secondary structure elements");let t=e.data,a=e.settings.shapeMethod==o.ShapeMethod.SymCdf?t.nodes.map(e=>e.cdf[e.cdf.length-1][0]*n.LENGTH_SCALE):t.nodes.map(e=>e.avg_length*n.LENGTH_SCALE),d=t.nodes.map(e=>e.occurrence*n.OCCURRENCE_SCALE),c=t.nodes.map(e=>e.occurrence*e.avg_length);if(e.settings.layoutMethod==o.LayoutMethod.Old){let o=t.nodes.length,i=t.levels.length,r=new Array(o),s=new Array(o),c=new Array(o).fill(0),h=0;for(let e=0;e<i;e++){const o=t.levels[e];let i=o.length;for(let e=0;e<i;e++){const t=o[e];r[t]=h,s[t]=h+a[t],c[t]=e-(i-1)/2}h=Math.max(...o.map(e=>s[e]))+n.GAP_LENGTH}for(let e=0;e<t.nodes.length;e++)t.nodes[e].visual=l.newNodeVisual(),t.nodes[e].active?t.nodes[e].visual.rect={x:r[e],width:a[e],y:c[e]*n.FLOOR_HEIGHT-d[e]/2,height:d[e]}:t.nodes[e].visual.rect={x:-n.LEFT_MARGIN,width:0,y:0,height:0};let u=h-n.GAP_LENGTH,p=Math.min(...c),v=Math.max(...c),f=-n.LEFT_MARGIN,E=u+n.RIGHT_MARGIN,g=p*n.FLOOR_HEIGHT-.5*n.OCCURRENCE_SCALE-n.TOP_MARGIN,m=v*n.FLOOR_HEIGHT+.5*n.OCCURRENCE_SCALE+n.BOTTOM_MARGIN;e.world={x:f,y:g,width:E-f,height:m-g}}else if(e.settings.layoutMethod==o.LayoutMethod.New){let o=r.newDagFromPrecedence(t.levels,t.precedence),i=new Map;for(const e of o.vertices)i.set(e,{width:a[e],height:d[e],weight:c[e]});const[s,h]=r.embedDag(o,i,{x:n.GAP_LENGTH,y:n.FLOOR_HEIGHT-n.OCCURRENCE_SCALE},n.LEFT_MARGIN,n.RIGHT_MARGIN,n.TOP_MARGIN,n.BOTTOM_MARGIN);e.world={x:-s.left,y:-s.top,width:s.right+s.left,height:s.bottom+s.top};for(let o=0;o<t.nodes.length;o++)if(t.nodes[o].visual=l.newNodeVisual(),t.nodes[o].active){const{x:e,y:n}=h.get(o),{width:l,height:a}=i.get(o);t.nodes[o].visual.rect={x:e-l/2,y:n-a/2,width:l,height:a}}else t.nodes[o].visual.rect={x:e.world.x,y:e.world.y,width:0,height:0}}let h=i.zoomAllZoomout(e.world,e.screen),u=(n.OCCURRENCE_SCALE+n.TOP_MARGIN+n.BOTTOM_MARGIN)/e.screen.height,p=e.world.height/e.screen.height,E=u/10,g=h*n.MAX_X_ZOOMOUT;e.zoom=i.newZoomInfo(E,g,u,p,h),e.visWorld=i.centeredVisWorld(e.world,e.screen,e.zoom),t.precedenceLines=[];for(const e of t.precedence){let o=t.nodes[e[0]].visual.rect,i=t.nodes[e[1]].visual.rect,l=o.x+o.width,a=o.y+o.height/2,r=i.x,s=i.y+i.height/2;t.precedenceLines.push({x1:l,y1:a,x2:l+n.KNOB_LENGTH,y2:a}),t.precedenceLines.push({x1:l+n.KNOB_LENGTH,y1:a,x2:r-n.KNOB_LENGTH,y2:s}),t.precedenceLines.push({x1:r-n.KNOB_LENGTH,y1:s,x2:r,y2:s})}e.canvas.append("g").attr("class","legends");let m,_=e.canvas.append("g").attr("class","nodes").selectAll("g.node").data(t.nodes).enter().append("g").attr("class","node").attr("opacity",e=>e.active?1:0);e.nodeMap=new Map,_.each((t,o,n)=>e.nodeMap.set(t.label,n[o]));(m=e.settings.shapeMethod==o.ShapeMethod.SymCdf?_.append("polygon"):_.append("rect")).filter(e=>e.active);s.addPointBehavior(e,m,t=>s.selectNodeFromShape(e,t,!0),t=>s.dispatchMixedEvent(e,n.EVENT_TYPE_HOVER,t.data())),s.addPickBehavior(e,m,t=>s.selectNodeFromShape(e,t,!0),t=>s.dispatchMixedEvent(e,n.EVENT_TYPE_SELECT,t.data())),s.setTooltips(e,m,_.data().map(v),!0,!1),_.append("text").attr("class","node-label").text(e=>e.label),e.canvas.append("g").attr("class","edges").selectAll().data(t.precedenceLines).enter().append("line").attr("stroke",n.EDGE_COLOR),s.showBetaConnectivity(e,e.settings.betaConnectivityVisibility,!1),f(e,e.settings.colorMethod,!1),s.zoomAll(e),s.redraw(e,!1)}function v(e){if(e.active){let[t,o]=l.getNodeMinMaxLength(e);return['<div class="node-tooltip">',`<span class="tooltip-title">${e.label}</span>`,"<table>",`<tr><td>Type:</td><td>${"e"==e.type?"Strand":"Helix"}</td></tr>`,`<tr><td>Occurrence:</td><td>${i.round(100*e.occurrence,1)}%</td></tr>`,`<tr><td>Min. length:</td><td>${t} residues</td></tr>`,`<tr><td>Avg. length:</td><td>${i.round(e.avg_length,2)} residues</td></tr>`,`<tr><td>Max. length:</td><td>${o} residues</td></tr>`,`<tr><td>3D variability:</td><td>${i.round(e.stdev3d,2)} &#8491;</td></tr>`,"e"==e.type?`<tr><td>Sheet:</td><td>${e.sheet_id}</td></tr>`:"","</table>","</div>"].join("")}return null}function f(i,l,a=!0){i.settings.colorMethod=l,i.data.nodes.forEach((i,a)=>{let r;switch(l){case o.ColorMethod.Uniform:r=t.NEUTRAL_COLOR;break;case o.ColorMethod.Type:r=t.bySseType(i.type);break;case o.ColorMethod.Sheet:r=t.byIndex1(i.sheet_id);break;case o.ColorMethod.Stdev:r=t.byExpHeatmap(i.stdev3d,n.HEATMAP_MIDDLE_VALUE);break;case o.ColorMethod.Rainbow:r=void 0!=i.rainbow_hex?e.rgb(i.rainbow_hex):t.NEUTRAL_COLOR}i.visual.fill=r.hex(),i.visual.stroke=r.darker().hex()}),s.recolor(i,a)}c.initializeViewer=function(t){var r;let c=a.newSettingsFromHTMLElement(t);const v=t.id||"",E=`${v}-${Math.random().toString(36).slice(2)}`;console.log(`Initializing OverProt viewer with id="${v}", file="${c.file}"`,c);const g=e.select(t);g.selectAll(":scope > *").remove();let m=g.append("div").attr("class","overprot-viewer").attr("id","overprot-viewer-"+E),_=m.append("div").attr("class","gui").styles({width:c.width,height:c.height}),w=null===(r=_.node())||void 0===r?void 0:r.getBoundingClientRect();if(void 0!==w){let{width:e,height:t}=w;c.width=e,c.height=t}let T=_.append("div").attr("class","canvas").append("svg").attr("class","canvas").attrs({width:c.width,height:c.height});const A=function(){var e;const t="div.overprot-viewer";let o=[];for(const i of document.styleSheets){var n=null!==(e=i.cssRules)&&void 0!==e?e:[];for(const e of n)if(e.cssText.includes(t)){let n=e.cssText.replace(t,"");o.push(n)}}return o.join("\n")}();T.append("defs").append("style").attr("type","text/css").html(A);let M=a.newViewer(v,E,g,m,_,T,c);if(function(e){let t=e.guiDiv.append("div").attr("class","internal-controls"),i=[["Uniform",o.ColorMethod.Uniform,"Show all SSEs in the same color."],["Type",o.ColorMethod.Type,"Show &beta;-strands in blue, helices in gray."],["Sheet",o.ColorMethod.Sheet,"Assign the same color to &beta;-strands from the same &beta;-sheet, <br>show helices in gray."],["Variability",o.ColorMethod.Stdev,"<strong>3D variability</strong> measures the standard deviation of the SSE end point coordinates.<br>Low values (dark) indicate conserved SSE position, <br>high values (bright) indicate variable SSE position."],["Rainbow",o.ColorMethod.Rainbow,"Rainbow coloring from N-terminus (blue) to C-terminus (red)."]],a=[["Rectangle",o.ShapeMethod.Rectangle,"Show SSEs as rectangles. <br>Height of the rectangle indicates <strong>occurrence</strong> (what percentage of structures contain this SSE), <br>width indicates <strong>average length</strong> (number of residues)."],["SymCDF",o.ShapeMethod.SymCdf,"<strong>Cumulative distribution function</strong> describes the statistical distribution of the SSE length. <br>The widest part of the shape corresponds to maximum length, the narrowest to minimum length, <br> the height corresponds to occurrence. <br>(The SymCDF shape consists of four symmetrical copies of the CDF, the bottom right quarter is the classical CDF.)"]],r=d.newControlPanel(e,"main-panel",null),c=d.newButton(e,"zoom-in",n.ICON_PLUS,!0,!0,()=>s.zoomIn(e),"Zoom in. <br>Tip: Use Ctrl + mouse wheel to zoom.");d.addToControlPanel(r,c);let u=d.newButton(e,"zoom-out",n.ICON_MINUS,!0,!0,()=>s.zoomOut(e),"Zoom out. <br>Tip: Use Ctrl + mouse wheel to zoom.");d.addToControlPanel(r,u);let v=d.newButton(e,"zoom-reset",n.ICON_RESET,!0,!0,()=>s.zoomAll(e),"Reset zoom. <br>Tip: Use double click to reset zoom.");d.addToControlPanel(r,v);let E=d.newDropdownList(e,"color-method","Color",i,e.settings.colorMethod,t=>f(e,t),"Choose coloring method.",!0,!1);d.addToControlPanel(r,E);let g=d.newDropdownList(e,"shape-method","Shape",a,e.settings.shapeMethod,t=>(function(e,t){e.settings.shapeMethod=t,h(e,e.data)})(e,t),"Choose shape method.",!0,!1);d.addToControlPanel(r,g);let m=d.newPopupSlider(e,"occurrence-threshold","Occurrence threshold: ","%",0,100,1,100*e.settings.occurrenceThreshold,"0%","100%",e=>{},t=>(function(e,t){e.settings.occurrenceThreshold=t,l.filterDagAndAddLevels(e.data,t),p(e)})(e,t/100),"Hide SSEs with occurrence lower than the specified threshold.");d.addToControlPanel(r,m);let _=d.newToggleButton(e,"show-beta-connectivity",[n.ICON_BETA_CONNECTIVITY,n.ICON_BETA_CONNECTIVITY_CHECKED],!0,!0,e.settings.betaConnectivityVisibility,t=>s.showBetaConnectivity(e,t,!0),"Show/hide beta-connectivity.<br>(<strong>Beta-connectivity</strong> shows how &beta;-strands are connected to each other in &beta;-sheets.<br>Upper arcs indicate antiparallel connections,<br>lower arcs indicate parallel connections.)");d.addToControlPanel(r,_);let w=d.newToggleButton(e,"show-labels",[n.ICON_LABELS,n.ICON_LABELS_CHECKED],!0,!0,e.settings.showLabels,t=>{e.settings.showLabels=t,s.redraw(e)},"Show/hide SSE labels.");d.addToControlPanel(r,w);let T=d.newToggleButton(e,"show-legend",[n.ICON_LEGEND,n.ICON_LEGEND_CHECKED],!0,!0,e.settings.showLegend,t=>{e.settings.showLegend=t,s.showLegend(e)},"Show/hide legend.");d.addToControlPanel(r,T);let A=d.newButton(e,"save",n.ICON_CAMERA,!0,!0,()=>s.save(e),"Save image.");d.addToControlPanel(r,A),r.base.show(t)}(M),m.append("br"),T.on("dblclick",()=>s.zoomAll(M)),T.on("wheel",()=>{if(e.event.ctrlKey){let t=e.event.deltaY>0?n.ZOOM_STEP_RATIO_MOUSE:1/n.ZOOM_STEP_RATIO_MOUSE;s.zoomOut(M,t,e.mouse(T.node())),e.event.preventDefault()}else{let e=M.canvas.selectAll("text.temporary-central-message").data([1]).enter().append("rect").attr("class","temporary-central-message-background").attrs({x:0,width:M.screen.width,y:0,height:M.screen.height}),t=M.canvas.selectAll("text.temporary-central-message").data([1]).enter().append("text").attr("class","temporary-central-message").attrs({x:M.screen.width/2,y:M.screen.height/2}).text("Use Ctrl + scroll to zoom");s.fadeIn(e),s.fadeIn(t),s.fadeOutRemove(e,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT),s.fadeOutRemove(t,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT)}}),e.drag().on("drag",()=>s.shiftByMouse(M,-e.event.dx,-e.event.dy))(T),e.select(window).on("resize."+E,()=>{let e=_.node().getBoundingClientRect();!function(e,t,o){let n=e.zoom.zoomout!=e.zoom.initialZoomout,l=e.zoom.zoomout,a=e.visWorld,r=l*e.screen.width/t;e.canvas.attr("width",t).attr("height",o),e.screen.width=t,e.screen.height=o,p(e),n&&s.zoomSet(e,r,i.rectangleCenter(a))}(M,e.width,e.height)}),c.listenEvents&&(t.addEventListener(n.EVENT_PREFIX+n.EVENT_TYPE_DO_SELECT,e=>s.handleEvent(M,e)),t.addEventListener(n.EVENT_PREFIX+n.EVENT_TYPE_DO_HOVER,e=>s.handleEvent(M,e))),M.canvas.append("text").attr("class","central-message").attrs({x:M.screen.width/2,y:M.screen.height/2}).text("Loading..."),""!=c.file){let e=new URL(c.file,document.baseURI).toString();fetch(e).catch(t=>u(this,void 0,void 0,function*(){console.error(`OverProt Viewer with id="${M.id}" failed to initialize because the request for`,e,"failed (this might be caused by CORS policy). Original error:",t);let o=l.newDagWithError(`Failed to fetch data from "${e}"`);h(M,o)})).then(t=>u(this,void 0,void 0,function*(){if(t&&t.ok){let e=yield t.text(),o=l.dagFromJson(e);h(M,o)}else if(t&&!t.ok){console.error(`OverProt Viewer with id="${M.id}" failed to initialize because the request for`,e,"returned status code",t.status,t.statusText);let o=l.newDagWithError(`Failed to fetch data from "${e}"`);h(M,o)}})).catch(e=>u(this,void 0,void 0,function*(){console.error(`OverProt Viewer with id="${M.id}" failed to initialize because of internal error.`);let t=l.newDagWithError("Internal error");throw h(M,t),e}))}else{let e=l.newDagWithError("No file specified");h(M,e)}}}(h||(h={})),function(e){window.customElements.define("overprot-viewer",class extends HTMLElement{constructor(){super()}connectedCallback(){this.initialize()}initialize(){return h.initializeViewer(this)}})}()}(d3);
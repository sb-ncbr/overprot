!function(e){"use strict";var t,o,n,i,l,r,a;!function(t){var o;o=function(){let t=e.schemeCategory10.map(t=>e.rgb(t));return{neutral:t.splice(7,1)[0],scheme:t}}(),t.NEUTRAL_COLOR=o.neutral,t.COLOR_SCHEME=o.scheme,t.NEUTRAL_DARK=e.rgb(0,0,0),t.bySseType=function(e){return"h"==(e=e.toLowerCase())?t.NEUTRAL_COLOR:"e"==e?t.COLOR_SCHEME[0]:t.COLOR_SCHEME[1]},t.byIndex0=function(e){return t.COLOR_SCHEME[e%t.COLOR_SCHEME.length]},t.byIndex1=function(e){return e>=1?t.COLOR_SCHEME[(e-1)%t.COLOR_SCHEME.length]:t.NEUTRAL_COLOR},t.byLinHeatmap=function(t,o){const n=t/o;return e.rgb(e.interpolateInferno(n))},t.byExpHeatmap=function(t,o){const n=1-Math.pow(2,-t/o);return e.rgb(e.interpolateInferno(n))}}(t||(t={})),function(e){let t,o,n;!function(e){e[e.Uniform=0]="Uniform",e[e.Type=1]="Type",e[e.Sheet=2]="Sheet",e[e.Stdev=3]="Stdev",e[e.Rainbow=4]="Rainbow"}(t=e.ColorMethod||(e.ColorMethod={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.SymCdf=1]="SymCdf"}(o=e.ShapeMethod||(e.ShapeMethod={})),function(e){e[e.Old=0]="Old",e[e.New=1]="New"}(n=e.LayoutMethod||(e.LayoutMethod={}))}(o||(o={})),function(n){n.CANVAS_HEIGHT=300,n.CANVAS_WIDTH=1200,n.ZOOM_STEP_RATIO=1.25,n.ZOOM_STEP_RATIO_MOUSE=n.ZOOM_STEP_RATIO,n.SHIFT_STEP_RELATIVE=.2,n.MAX_EMPTY_X_MARGIN=0,n.MAX_EMPTY_Y_MARGIN=0,n.MAX_X_ZOOMOUT=1/(1-2*n.MAX_EMPTY_X_MARGIN),n.MAX_Y_ZOOMOUT=1/(1-2*n.MAX_EMPTY_Y_MARGIN),n.TRANSITION_DURATION=e.transition().duration(),n.TOOLTIP_DELAY=600,n.MOUSE_HOLD_BEHAVIOR_INITIAL_SLEEP_TIME=500,n.MOUSE_HOLD_BEHAVIOR_STEP_SLEEP_TIME=50,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT=1e3,n.TOOLTIP_OFFSET={x:12,y:0},n.NODE_STROKE_WIDTH=1,n.NODE_STROKE_WIDTH_HIGHLIGHTED=3,n.EDGE_COLOR="#808080",n.NODE_FILL=t.NEUTRAL_COLOR,n.NODE_STROKE=t.NEUTRAL_COLOR.darker(),n.NODE_LABEL_COLOR="black",n.MINIMAL_WIDTH_FOR_SSE_LABEL=20,n.HEATMAP_MIDDLE_VALUE=5,n.DEFAULT_OCCURRENCE_THRESHOLD=.2,n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY=!0,n.DEFAULT_LAYOUT_METHOD=o.LayoutMethod.New,n.DEFAULT_COLOR_METHOD=o.ColorMethod.Sheet,n.DEFAULT_SHAPE_METHOD=o.ShapeMethod.Rectangle,n.DEFAULT_DISPATCH_EVENTS=!1,n.DEFAULT_LISTEN_EVENTS=!1,n.LENGTH_SCALE=4,n.OCCURRENCE_SCALE=100,n.FLOOR_HEIGHT=1.25*n.OCCURRENCE_SCALE,n.TOP_MARGIN=.25*n.OCCURRENCE_SCALE,n.BOTTOM_MARGIN=.25*n.OCCURRENCE_SCALE,n.LEFT_MARGIN=4*n.LENGTH_SCALE,n.RIGHT_MARGIN=4*n.LENGTH_SCALE,n.GAP_LENGTH=3*n.LENGTH_SCALE,n.KNOB_LENGTH=1*n.LENGTH_SCALE,n.ARC_MAX_DEVIATION=.5*n.OCCURRENCE_SCALE+Math.min(n.TOP_MARGIN,n.BOTTOM_MARGIN),n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH=.001,n.ARC_MAX_MINOR=n.ARC_MAX_DEVIATION/(1-Math.sqrt(1-Math.pow(1/(1+2*n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH),2))),n.ARC_SMART_DEVIATION_PARAM_WRT_WORLD_WIDTH=.2,n.HELIX_TYPE="h",n.STRAND_TYPE="e",n.HANGING_TEXT_OFFSET=5,n.RESET_SYMBOL="&#x27F3;",n.OPEN_POPUP_SYMBOL=" &#x25BE;",n.EVENT_PREFIX="PDB.overprot.",n.EVENT_TYPE_SELECT="select",n.EVENT_TYPE_HOVER="hover",n.EVENT_TYPE_DO_SELECT="do.select",n.EVENT_TYPE_DO_HOVER="do.hover"}(n||(n={})),function(e){function t(e){return[e.x+.5*e.width,e.y+.5*e.height]}function o(e,t){e.zoomout=i(t,e.minZoomout,e.maxZoomout),e.xZoomout=i(e.zoomout,e.minXZoomout,e.maxXZoomout),e.yZoomout=i(e.zoomout,e.minYZoomout,e.maxYZoomout)}function i(e,t,o){return Math.min(Math.max(e,t),o)}function l(e,t=0){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}e.newRectangle=function(){return{x:-1,y:-1,width:2,height:2}},e.rectangleFromCanvas=function(e){return{x:0,y:0,width:+e.style("width").replace("px",""),height:+e.style("height").replace("px","")}},e.rectangleCenter=t,e.newZoomInfo=function(e,t,o,n,l){e>t&&console.warn("newZoomInfo(): minXZoomout > maxXZoomout"),o>n&&console.warn("newZoomInfo(): minYZoomout > maxYZoomout");let r=Math.min(e,o),a=Math.max(t,n),s=i(l,r,t);return{zoomout:s,xZoomout:i(s,e,t),yZoomout:i(s,o,n),minZoomout:r,maxZoomout:a,minXZoomout:e,maxXZoomout:t,minYZoomout:o,maxYZoomout:n,initialZoomout:l}},e.zoomInfoZoomOut=function(e,t){o(e,e.zoomout*t)},e.zoomInfoSetZoomout=o,e.zoomAllZoomout=function(e,t){return Math.max(e.width/t.width,e.height/t.height)},e.centeredVisWorld=function(e,o,n){let i=o.width*n.xZoomout,l=o.height*n.yZoomout,[r,a]=t(e);return{x:r-.5*i,y:a-.5*l,width:i,height:l}},e.constrain=i,e.arcPathD_circle=function(e,t,o,n,i=1){if(0==t)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:l,y1:r,x2:a,y2:s}=e,c=a-l,d=s-r,h=Math.abs(c),u=t*h/(h+o),p=u/2+(Math.pow(c/i,2)+Math.pow(d,2))/(8*u);return`M${a},${s} A${p*i},${p} 0 0,${n?1:0} ${l},${r}`}},e.arcPathD_ellipse=function(e,t,o,i,l=1){if(0==o)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:r,y1:a,x2:s,y2:c}=e,d=c-a,h=s-r,u=h/l,p=Math.sqrt(Math.pow(u,2)+Math.pow(d,2))/2+n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH*t/l,v=Math.min(o*Math.sqrt(Math.abs(h)/t),p),f=Math.atan(d/u),[E,m,g]=function(e,t,o,n){const{cos:i,sin:l,sqrt:r,atan:a}=Math;if(1==n)return[e,t,o];if(0==o||0==l(2*o))return[n*e,t,o];if(e==t)return[n*e,t,0];const s=Math.pow(n,2)*Math.pow(e,2)*Math.pow(i(o),2)+Math.pow(e,2)*Math.pow(l(o),2),c=2*(1-Math.pow(n,2))*e*t*i(o)*l(o),d=Math.pow(n,2)*Math.pow(t,2)*Math.pow(l(o),2)+Math.pow(t,2)*Math.pow(i(o),2),h=c,u=2*(s-d),p=-c,v=Math.pow(u,2)-4*h*p;let f=(-u+r(v))/(2*h),E=(-u-r(v))/(2*h),m=r((s+c*f+d*Math.pow(f,2))/(1+Math.pow(f,2))),g=r((s+c*E+d*Math.pow(E,2))/(1+Math.pow(E,2)));m<g&&([f,E]=[E,f],[m,g]=[g,m]);const _=1/(1+Math.pow(f,2)),T=1-_,w=f/(1+Math.pow(f,2)),A=Math.pow(e,2)*i(o)*l(o)*_+e*t*w+Math.pow(t,2)*i(o)*l(o)*T,M=n*(Math.pow(e,2)*Math.pow(i(o),2)*_-Math.pow(t,2)*Math.pow(l(o),2)*T);let y=a(A/M);return[m,g,y]}(p,v,f,l);return`M${s},${c} A${E},${m} ${g*=180/Math.PI} 0,${i?1:0} ${r},${a}`}},e.arcPathD_bezier=function(e,t,o,n,i=1){if(0==t)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:i,y1:l,x2:r,y2:a}=e,s=r-i,c=Math.abs(s),d=t*c/(c+o)*(n?-1:1);const h=.05*s,u=1.32;return`M${i},${l} C${i+h},${l-d*u} ${r-h},${a-d*u} ${r},${a}`}},e.symCdfPolygonPoints=function(e,o){let[n,i]=t(e),r=o[o.length-1][0],a=o[0][0]>0?1:1-o[0][1],s=.5*e.width/r,c=.5*e.height/a,d=[];o[0][0]>0&&(d.push([0,c]),d.push([o[0][0]*s,c])),d.push([o[0][0]*s,(1-o[0][1])*c]);for(let e=1;e<o.length;e++)d.push([o[e][0]*s,(1-o[e-1][1])*c]),d.push([o[e][0]*s,(1-o[e][1])*c]);let h=[];for(let e=0;e<d.length-1;e++)h.push([n+d[e][0],i+d[e][1]]);for(let e=d.length-1;e>0;e--)h.push([n+d[e][0],i-d[e][1]]);for(let e=0;e<d.length-1;e++)h.push([n-d[e][0],i-d[e][1]]);for(let e=d.length-1;e>0;e--)h.push([n-d[e][0],i+d[e][1]]);return h.map(e=>l(e[0],1)+","+l(e[1],1)).join(" ")},e.rectToScreen=function(e,t,o){let{x:n,y:i,width:l,height:r}=o;return{x:(n-e.x)/e.width*t.width+t.x,y:(i-e.y)/e.height*t.height+t.y,width:l/e.width*t.width,height:r/e.height*t.height}},e.lineToScreen=function(e,t,o){let{x1:n,y1:i,x2:l,y2:r}=o;return{x1:(n-e.x)/e.width*t.width+t.x,y1:(i-e.y)/e.height*t.height+t.y,x2:(l-e.x)/e.width*t.width+t.x,y2:(r-e.y)/e.height*t.height+t.y}},e.round=l}(i||(i={})),function(t){function o(){return{nodes:[],precedence:[],beta_connectivity:[],levels:[],precedenceLines:[],activeNodes:[],origPrecedence:[],origBetaConnectivity:[],error:null}}function l(e){let t={nodes:[],precedence:[],beta_connectivity:[],levels:[],precedenceLines:[],activeNodes:[],origPrecedence:[],origBetaConnectivity:[],error:null};return t.error=e,t}function r(e,t,o,n){let i=o[e].filter(e=>e!=t);for(;i.length>0;){let e=i.pop();if(-1!=n[e]&&n[e]<n[t])i.push(...o[e]);else if(e==t)return!0}return!1}function a(e,t){let o=new Array(e),n=new Array(e);for(let t=0;t<e;t++)o[t]=[],n[t]=[];return t.forEach(e=>{o[e[1]].push(e[0]),n[e[0]].push(e[1])}),{ins:o,outs:n}}t.newDag=o,t.dagFromJson=function(t){var o;let n=null;try{let i=JSON.parse(t);return n=i.error=null!==(o=i.error)&&void 0!==o?o:null,i.nodes.forEach(e=>e.active=!0),i.levels=[],i.precedenceLines=[],i.activeNodes=e.range(i.nodes.length),i.origPrecedence=i.precedence,i.origBetaConnectivity=i.beta_connectivity,function(e){var t,o;for(let n=0;n<e.beta_connectivity.length;n++){const i=e.beta_connectivity[n],l=i[0],r=i[1];void 0==e.nodes[l].ladders&&(e.nodes[l].ladders=[]),null===(t=e.nodes[l].ladders)||void 0===t||t.push(n),void 0==e.nodes[r].ladders&&(e.nodes[r].ladders=[]),null===(o=e.nodes[r].ladders)||void 0===o||o.push(n)}}(i),i}catch(e){return n=null!==n&&void 0!==n?n:"Failed to parse input file.",console.warn(n,"\n",e,"\n",t),l(n)}},t.newDagWithError=l,t.newNodeVisual=function(){return{rect:i.newRectangle(),fill:n.NODE_FILL.hex(),stroke:n.NODE_STROKE.hex()}},t.filterDagAndAddLevels=function(t,o){let n=t.nodes.length;for(let e of t.nodes)e.active=e.occurrence>=o&&e.avg_length>0;let i=e.range(n).filter(e=>t.nodes[e].active),{ins:l,outs:s}=a(n,t.origPrecedence);for(let e=0;e<n;e++)if(!t.nodes[e].active)for(let t of l[e])for(let o of s[e])s[t].includes(o)||(s[t].push(o),l[o].push(t));t.activeNodes=i,t.precedence=[];for(let e of i)for(let o of s[e])t.nodes[o].active&&t.precedence.push([e,o]);!function(e){let t=[],o=new Set(e.activeNodes),n=e.precedence;for(;o.size>0;){let e=new Set(o);n.forEach(t=>e.delete(t[1])),n=n.filter(t=>!e.has(t[0])),e.forEach(e=>o.delete(e)),t.push(Array.from(e))}e.levels=t}(t),function(e){let t=e.nodes.length,o=new Array(t).fill(-1);e.levels.forEach((e,t)=>e.forEach(e=>o[e]=t));let n=[],{outs:i}=a(t,e.precedence);for(let t=0;t<e.levels.length;t++){const l=e.levels[t];l.forEach(e=>{i[e].forEach(l=>{o[l]!=t+1&&r(e,l,i,o)||n.push([e,l])})})}e.precedence=n}(t)},t.getNodeMinMaxLength=function(e){let t=e.cdf.map(e=>e[0]).filter(e=>e>0);return 0==t.length?[0,0]:[t[0],t[t.length-1]]}}(l||(l={})),function(t){function r(){return{file:"",width:n.CANVAS_WIDTH,height:n.CANVAS_HEIGHT,colorMethod:n.DEFAULT_COLOR_METHOD,shapeMethod:n.DEFAULT_SHAPE_METHOD,layoutMethod:n.DEFAULT_LAYOUT_METHOD,betaConnectivityVisibility:n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY,occurrenceThreshold:n.DEFAULT_OCCURRENCE_THRESHOLD,dispatchEvents:n.DEFAULT_DISPATCH_EVENTS,listenEvents:n.DEFAULT_LISTEN_EVENTS}}function a(e,t,o,n){return null===t?n:void 0!==o[t]?o[t]:(console.warn(`Attribute "${e}" has invalid value "${t}". Allowed values: ${Object.keys(o)}.`),n)}function s(e,t,o,n=[]){if(null===t)return o;{let i=parseInt(t);return isNaN(i)?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be an integer.`),o):n.length>=2&&(i<n[0]||i>n[1])?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be an integer between ${n[0]} and ${n[1]}.`),o):i}}t.newViewer=function(e,t,o,n,a,s,d=null){return{id:e,internalId:t,d3viewer:o,mainDiv:n,guiDiv:a,canvas:s,data:l.newDag(),world:i.newRectangle(),visWorld:i.newRectangle(),screen:i.rectangleFromCanvas(s),zoom:i.newZoomInfo(1,1,1,1,1),settings:null!==d&&void 0!==d?d:r(),nodeMap:new Map,ladderMap:new c}},t.newSettings=r,t.newSettingsFromHTMLElement=function(t){var i;let l=["id","file","width","height","color-method","shape-method","layout-method","beta-connectivity","occurrence-threshold","dispatch-events","listen-events"];["file"].forEach(e=>{t.hasAttribute(e)||console.error(`Missing attribute: "${e}".`)});for(let e=0;e<t.attributes.length;e++){let o=t.attributes.item(e).name;l.includes(o)||console.warn(`Unknown attribute: "${o}"`)}let r=e.select(t);const c={uniform:o.ColorMethod.Uniform,type:o.ColorMethod.Type,sheet:o.ColorMethod.Sheet,variability:o.ColorMethod.Stdev,rainbow:o.ColorMethod.Rainbow},d={rectangle:o.ShapeMethod.Rectangle,symcdf:o.ShapeMethod.SymCdf},h={old:o.LayoutMethod.Old,new:o.LayoutMethod.New},u={on:!0,off:!1,true:!0,false:!1,1:!0,0:!1};return{file:null!==(i=r.attr("file"))&&void 0!==i?i:"",height:s("height",r.attr("height"),n.CANVAS_HEIGHT),width:s("width",r.attr("width"),n.CANVAS_WIDTH),colorMethod:a("color-method",r.attr("color-method"),c,n.DEFAULT_COLOR_METHOD),shapeMethod:a("shape-method",r.attr("shape-method"),d,n.DEFAULT_SHAPE_METHOD),layoutMethod:a("layout-method",r.attr("layout-method"),h,n.DEFAULT_LAYOUT_METHOD),betaConnectivityVisibility:a("beta-connectivity",r.attr("beta-connectivity"),u,n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY),occurrenceThreshold:function(e,t,o,n=[],i=!1){if(null===t)return o;{let l=parseFloat(t);return i&&t.includes("%")&&(l*=.01),isNaN(l)?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be a float.`),o):n.length>=2&&(l<n[0]||l>n[1])?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be a float between ${n[0]} and ${n[1]}.`),o):l}}("occurrence-threshold",r.attr("occurrence-threshold"),n.DEFAULT_OCCURRENCE_THRESHOLD,[0,1],!0),dispatchEvents:a("dispatch-events",r.attr("dispatch-events"),u,n.DEFAULT_DISPATCH_EVENTS),listenEvents:a("listen-events",r.attr("listen-events"),u,n.DEFAULT_LISTEN_EVENTS)}};class c{constructor(){this.map=void 0,this.value=void 0}get(e){var t;let o=this;for(const n of e)if(void 0==(o=null===(t=o.map)||void 0===t?void 0:t.get(n)))return;return o.value}set(e,t){let o=this;for(const t of e)o.map||(o.map=new Map),o.map.has(t)||o.map.set(t,new c),o=o.map.get(t);o.value=t}entries(){let e=[];return this.collectEntries([],e),e}collectEntries(e,t){if(void 0!=this.value&&t.push([[...e],this.value]),void 0!=this.map)for(const[o,n]of this.map.entries())e.push(o),n.collectEntries(e,t),e.pop()}}t.TupleMap=c}(r||(r={})),function(e){function t(){return{levels:[],edges:[],vertices:[],in_neighbors:new Map}}function o(e,t){let o=[];for(const t of e)for(const e of t)o.push(e);let i=new Set(o),l=[];for(const e of t)i.has(e[0])&&i.has(e[1])&&l.push(e);let r={levels:e,edges:l,vertices:o,in_neighbors:new Map};return n(r),r}function n(e){for(const t of e.vertices)e.in_neighbors.set(t,[]);for(const[t,o]of e.edges)e.in_neighbors.get(o).push(t)}function i(e,t,n){let i=e.levels.slice(t,n),l=[];for(let t=1;t<i.length;t++)for(const o of i[t])for(const t of e.in_neighbors.get(o))l.push([t,o]);return o(i,l)}function l(e,n,c){return s(function(e){const o=function(e,t){const o=function(e){let t=new Map;for(const o of e)t.set(o,o);return t}(e);for(const[e,n]of t)u(o,e,n);return function(e){const t=new Map;for(const o of e.keys()){const n=h(e,o);t.has(n)?t.get(n).push(o):t.set(n,[o])}const o=[...t.values()];for(const e of o)e.sort();return o.sort(),o}(o)}(e.vertices,e.edges),n=o.length,i=new Map;for(let e=0;e<o.length;e++){const t=o[e];for(const o of t)i.set(o,e)}const l=[];for(let e=0;e<n;e++)l.push(t());for(let t=0;t<e.levels.length;t++)for(const o of e.levels[t]){const e=i.get(o),n=l[e].levels;n.length<=t&&n.push([]),p(n.length==t+1,"levs.length != iLevel + 1"),n[t].push(o),l[e].vertices.push(o),l[e].in_neighbors.set(o,[])}for(const t of e.edges){const[e,o]=t,n=i.get(e);p(i.get(o)==n,"vertex2component.get(v) != iComp"),l[n].edges.push(t),l[n].in_neighbors.get(o).push(e)}return l}(e).map(e=>(function(e,t,n){const c=function(e){let t=new Map,n=0,l=[],r=-1;const a=e.levels.length;for(let s=0;s<a;s++){const a=e.levels[s];for(let o=0;o<a.length;o++){const n=a[o],i=new Set(e.in_neighbors.get(n));for(const o of e.in_neighbors.get(n))for(const e of t.get(o))i.add(e);t.set(n,i)}if(1==a.length&&t.get(a[0]).size==n){const c=a[0];s>r+1&&l.push(i(e,r+1,s)),l.push(o([[c]],[])),t.clear(),t.set(c,new Set),r=s,n=1}else n+=a.length}return a>r+1&&l.push(i(e,r+1,a)),l}(e);if(1==c.length)return function(e,t,o,n=1024){const i=function(e,t){let o=1;for(const n of e)for(let e=n.length;e>0;e--)if((o*=e)>t)return t;return o}(e.levels,n+1);if(1==e.vertices.length||i>n)return r(e.levels,t,o=o);{let n=null,i=1/0;const l=e.levels.map(e=>(function e(t,o=!1){if(0==t.length)return[[]];const n=[];let i=t[0];let l=t.slice(1,void 0);for(let o=0;o<t.length;o++){for(const t of e(l,!0))t.push(i),n.push(t);[i,l[o]]=[l[o],i]}if(!o)for(const e of n)e.reverse();return n})(e,!0));for(const a of function e(t,o=0){if(o==t.length)return[[]];const n=[];for(const i of t[o])for(const l of e(t,o+1))l.push(i),n.push(l);if(0==o)for(const e of n)e.reverse();return n}(l)){const l=r(a,t,o),[s,c]=l;let d=0;for(const[t,o]of e.edges)d+=Math.abs(c.get(t).y-c.get(o).y);d<i&&(n=l,i=d)}return p(null!=n,"bestEmbedding is null",n),n}}(c[0],t,n);{const e=c.map(e=>l(e,t,n)),o=s(e,a.HORIZONTAL,n);return o}})(e,n,c)),a.VERTICAL_REARRANGED,c)}function r(e,t,o){const n=[];for(const i of e){const e=[];for(const o of i){const{width:n,height:i,weight:l}=t.get(o),r={left:n/2,right:n/2,top:i/2,bottom:i/2,weight:l},a=new Map([[o,{x:0,y:0}]]);e.push([r,a])}const l=s(e,a.VERTICAL,o);n.push(l)}return s(n,a.HORIZONTAL,o)}let a;function s(e,t,o){const n=e.map(e=>e[0]),i=e.map(e=>e[1]);let l,r;if(t==a.HORIZONTAL)[l,r]=function(e,t){const o=(c(e.map(e=>e.left+e.right))+(e.length-1)*t.x)/2,n=o,i=Math.max(...e.map(e=>e.top)),l=Math.max(...e.map(e=>e.bottom)),r=c(e.map(e=>e.weight));let a=[],s=-o;for(const o of e)s+=o.left,a.push({x:s,y:0}),s+=o.right,s+=t.x;return[{left:o,right:n,top:i,bottom:l,weight:r},a]}(n,o);else if(t==a.VERTICAL)[l,r]=d(n,o);else{if(t!=a.VERTICAL_REARRANGED)throw new Error("direction must be HORIZONTAL or VERTICAL or VERTICAL_REARRANGED");[l,r]=d(n,o,!0)}let s=new Map;for(let t=0;t<e.length;t++)for(const[e,o]of i[t])s.set(e,(h=r[t],u=o,{x:h.x+u.x,y:h.y+u.y}));var h,u;return[l,s]}function c(e){let t=0;for(const o of e)t+=o;return t}function d(e,t,o=!1){e.length;let n=0,i=0,l=0;const r=o?function(e){const t=e.map((e,t)=>[t,e]);t.sort((e,t)=>t[1].weight-e[1].weight);let o=[],n=[];for(let e=0;e<t.length;e++)e%2==0?o.push(t[e]):n.push(t[e]);return n.reverse(),n.push(...o),n}(e):e.map((e,t)=>[t,e]);for(const[e,o]of r)l+=o.top,n+=o.weight,i+=o.weight*l,l+=o.bottom,l+=t.y;const a=n>0?i/n:0,s=[];l=-a;for(const[e,o]of r)l+=o.top,s[e]={x:0,y:l},l+=o.bottom,l+=t.y;const c=a,d=l-t.y;return[{left:Math.max(...e.map(e=>e.left)),right:Math.max(...e.map(e=>e.right)),top:c,bottom:d,weight:n},s]}function h(e,t){const o=e.get(t);if(o==t)return t;{const n=h(e,o);return e.set(t,n),n}}function u(e,t,o){const n=h(e,t),i=h(e,o),l=Math.min(n,i);return e.set(n,l),e.set(i,l),l}function p(e,...t){if(!e)throw console.error("AssertionError:",...t),new Error("AssertionError")}e.newDagEmpty=t,e.newDagFromPath=function(e){let t={levels:e.map(e=>[e]),edges:[],vertices:[...e],in_neighbors:new Map};for(let o=0;o<e.length-1;o++)t.edges.push([e[o],e[o+1]]);return n(t),t},e.newDagFromPrecedence=o,e.embedDag=function(e,t,o={x:0,y:0},n=0,i=0,r=0,a=0){let s,c;return 0==e.vertices.length?(s={left:0,right:0,top:0,bottom:0,weight:0},c=new Map):[s,c]=l(e,t,o),s.left+=n,s.right+=i,s.top+=r,s.bottom+=a,[s,c]},function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL",e[e.VERTICAL_REARRANGED=2]="VERTICAL_REARRANGED"}(a||(a={}))}(a||(a={}));var s,c,d=function(e,t,o,n){return new(o||(o=Promise))(function(i,l){function r(e){try{s(n.next(e))}catch(e){l(e)}}function a(e){try{s(n.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,a)}s((n=n.apply(e,t||[])).next())})};!function(l){function a(e,t=n.ZOOM_STEP_RATIO,o){i.zoomInfoZoomOut(e.zoom,t);let[l,r]=void 0!=o?[o[0]/e.screen.width,o[1]/e.screen.height]:[.5,.5],a=e.screen.width*e.zoom.xZoomout,c=e.screen.height*e.zoom.yZoomout,{x:d,y:h,width:u,height:p}=e.visWorld;e.visWorld.x=d+(u-a)*l,e.visWorld.y=h+(p-c)*r,e.visWorld.width=a,e.visWorld.height=c,g(e),v(e),s(e)}function s(e){e.mainDiv.selectAll("div.button#zoom-out").attr("disabled",e.zoom.zoomout>=e.zoom.maxZoomout?"true":null),e.mainDiv.selectAll("div.button#zoom-in").attr("disabled",e.zoom.zoomout<=e.zoom.minZoomout?"true":null),e.mainDiv.selectAll("div.button#zoom-reset").attr("disabled",e.zoom.zoomout==e.zoom.initialZoomout?"true":null)}function c(t,o){return(o=o||t.mainDiv.select("div.tooltip")).style("left",e.event.clientX+n.TOOLTIP_OFFSET.x).style("top",e.event.clientY+n.TOOLTIP_OFFSET.y)}function h(t,o,n=(t=>e.select(t)),i=null){o.on("mouseenter.point",(e,t,o)=>{let l=n(o[t]);l.attr("pointed","pointed"),null!=i&&i(l)}),o.on("mouseleave.point",(t,o,l)=>{n(l[o]).attr("pointed",null),null!=i&&i(e.selectAll())})}function u(e){return new Promise(t=>setTimeout(t,e))}function p(e,n){return e.settings.colorMethod==o.ColorMethod.Stdev||e.settings.colorMethod==o.ColorMethod.Rainbow?t.NEUTRAL_DARK.hex():e.data.nodes[n[0]].visual.stroke}function v(e,t=!0){let o=t?n.TRANSITION_DURATION:0,l=e.canvas.select("g.nodes").selectAll("g.node").filter(e=>e.active);l.select("rect").transition().duration(o).attrs(t=>i.rectToScreen(e.visWorld,e.screen,t.visual.rect)),l.select("polygon").transition().duration(o).attr("points",t=>i.symCdfPolygonPoints(i.rectToScreen(e.visWorld,e.screen,t.visual.rect),t.cdf));let r=l.select("text").data().map(t=>f(e,t));l.select("text").style("fill",n.NODE_LABEL_COLOR).transition().duration(o).attrs(t=>{let{x:o,y:l,height:r,width:a}=i.rectToScreen(e.visWorld,e.screen,t.visual.rect);return{x:o+a/2,y:l+r+n.HANGING_TEXT_OFFSET}}).style("opacity",(e,t)=>r[t]?1:0).transition().duration(0).style("fill",(e,t)=>r[t]?n.NODE_LABEL_COLOR:"none"),e.canvas.select("g.edges").selectAll("line").transition().duration(o).attrs(t=>i.lineToScreen(e.visWorld,e.screen,t));n.ARC_MAX_MINOR,e.zoom.yZoomout;let a=e.data;a.beta_connectivity.forEach(e=>e[3]=a.nodes[e[0]].active&&a.nodes[e[1]].active?1:0),e.canvas.select("g.beta-connectivity").selectAll("path").transition().duration(o).attr("d",t=>(function(e,t){if(0==t[3])return"";let[o,l,r]=t,a=e.data.nodes[o].visual.rect,s=e.data.nodes[l].visual.rect,c=i.lineToScreen(e.visWorld,e.screen,{x1:a.x+.5*a.width,y1:a.y+.5*a.height,x2:s.x+.5*s.width,y2:s.y+.5*s.height}),d=e.zoom.yZoomout/e.zoom.xZoomout,h=n.ARC_MAX_MINOR/e.zoom.yZoomout;return i.arcPathD_ellipse(c,e.world.width/e.zoom.xZoomout,h,1==r,d)})(e,t))}function f(e,t){return i.rectToScreen(e.visWorld,e.screen,t.visual.rect).width>=n.MINIMAL_WIDTH_FOR_SSE_LABEL}function E(e,t=0){return e.transition().delay(t).duration(n.TRANSITION_DURATION).style("opacity",0).remove()}function m(e,t=0){if(0==e.size())return e.transition();let o=e.style("opacity");return e.style("opacity",0).transition().delay(t).duration(n.TRANSITION_DURATION).style("opacity",o)}function g(e){let{x:t,y:o,width:l,height:r}=e.world,{x:a,y:s,width:c,height:d}=e.visWorld;c<l*n.MAX_X_ZOOMOUT?e.visWorld.x=i.constrain(a,t-n.MAX_EMPTY_X_MARGIN*c,t+l+n.MAX_EMPTY_X_MARGIN*c-c):e.visWorld.x=t+.5*l-.5*c,d<r*n.MAX_Y_ZOOMOUT?e.visWorld.y=i.constrain(s,o-n.MAX_EMPTY_Y_MARGIN*d,o+r+n.MAX_EMPTY_Y_MARGIN*d-d):e.visWorld.y=o+.5*r-.5*d}l.zoomOut=a,l.zoomIn=function(e,t=n.ZOOM_STEP_RATIO,o){a(e,1/t,o)},l.zoomAll=function(e){i.zoomInfoSetZoomout(e.zoom,e.zoom.initialZoomout),e.visWorld=i.centeredVisWorld(e.world,e.screen,e.zoom),v(e),s(e)},l.zoomSet=function(e,t,o){i.zoomInfoSetZoomout(e.zoom,t);let[n,l]=null!==o&&void 0!==o?o:i.rectangleCenter(e.visWorld),r=e.screen.width*e.zoom.xZoomout,a=e.screen.height*e.zoom.yZoomout;e.visWorld={x:n-.5*r,y:l-.5*a,width:r,height:a},g(e),v(e,!1),s(e)},l.shift=function(e,t,o){let{width:n,height:i}=e.visWorld;e.visWorld.x+=t*n,e.visWorld.y+=o*i,g(e),v(e)},l.shiftByMouse=function(e,t,o){let{width:n,height:i}=e.visWorld,{width:l,height:r}=e.screen;e.visWorld.x+=t*n/l,e.visWorld.y+=o*i/r,g(e),v(e,!1)},l.save=function(t){const o=t.screen.width,n=t.screen.height,i=new XMLSerializer;t.canvas.attr("rendering","rendering");const l=i.serializeToString(t.canvas.node());t.canvas.attr("rendering",null);const r=new Image(o,n);r.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(l)));const a=e.select(document.createElement("canvas")).attr("width",o).attr("height",n);e.select(r).on("load",()=>{a.node().getContext("2d").drawImage(r,0,0,o,n),function(e,t){const o=document.createElement("a");o.download=t,o.href=e,o.click()}(a.node().toDataURL("image/png").replace("image/png","image/octet-stream"),"overprot.png")})},l.setTooltips=function(t,o,i,l=!1,r=!1){if(null===i)o.on("mouseenter.tooltip",null).on("mousemove.tooltip",null).on("mouseleave.tooltip",null).on("click.tooltip",null);else{let a=i.map(e=>null!=e),s=i.filter(e=>null!=e);o.filter((e,t)=>a[t]).on("mouseenter.tooltip",(o,i,l)=>(function(t,o,i,l=!1){var r;if("pinned"!=e.select(o).attr("tooltip")){let a=t.mainDiv.append("div").attr("class","tooltip").attr("type","hover").html(i);c(t,a),null===(r=e.select(o))||void 0===r||r.attr("tooltip","hover"),m(a,l?n.TOOLTIP_DELAY:0)}})(t,l[i],s[i],r)).on("mousemove.tooltip",(e,o)=>(function(e){c(e,e.mainDiv.selectAll("div.tooltip[type=hover]"))})(t)).on("mouseleave.tooltip",(e,o)=>(function(e){e.mainDiv.selectAll("div.tooltip[type=hover]").remove(),e.mainDiv.selectAll("[tooltip=hover]").attr("tooltip",null)})(t)),l&&o.filter((e,t)=>a[t]).on("click.tooltip",(o,n,i)=>(function(t,o,n){var i;let l=t.mainDiv.append("div").attr("class","tooltip").attr("type","pre-pinned").html(n);c(t,l),null===(i=e.select(o))||void 0===i||i.attr("tooltip","pre-pinned"),t.mainDiv.on("click.tooltip",()=>{t.mainDiv.selectAll("div.tooltip[type=hover],div.tooltip[type=pinned]").remove(),t.mainDiv.selectAll("div.tooltip[type=pre-pinned]").attr("type","pinned"),t.mainDiv.selectAll("[tooltip=hover],[tooltip=pinned]").attr("tooltip",null),t.mainDiv.selectAll("[tooltip=pre-pinned]").attr("tooltip","pinned")})})(t,i[n],s[n])),o.filter((e,t)=>!a[t]).on("mouseenter.tooltip",null).on("mousemove.tooltip",null).on("mouseleave.tooltip",null).on("click.tooltip",null)}},l.addPointBehavior=h,l.addPickBehavior=function(t,o,n=(t=>e.select(t)),i=null){o.on("click.pick",(e,t,o)=>{n(o[t]).attr("picked","pre-picked")}),t.guiDiv.on("click.pick",()=>{t.guiDiv.selectAll("[picked=picked]").attr("picked",null);let e=t.guiDiv.selectAll("[picked=pre-picked]");e.attr("picked","picked"),null!=i&&i(e)})},l.addMouseHoldBehavior=function(t,o,i,l){t.on("mousedown",()=>d(this,void 0,void 0,function*(){if(1==e.event.which||void 0==e.event.which){let e=Math.random().toString(36).slice(2);for(o(),t.attr("pressed",e),yield u(n.MOUSE_HOLD_BEHAVIOR_INITIAL_SLEEP_TIME);t.attr("pressed")==e;)i(),yield u(n.MOUSE_HOLD_BEHAVIOR_STEP_SLEEP_TIME)}})),t.on("mouseup",()=>d(this,void 0,void 0,function*(){t.attr("pressed",null),l()})),t.on("mouseleave",()=>d(this,void 0,void 0,function*(){t.attr("pressed",null),l()}))},l.recolor=function(i,l=!0){let r=l?n.TRANSITION_DURATION:0;i.canvas.select("g.nodes").selectAll("g.node").selectAll("rect,polygon").transition().duration(r).style("fill",e=>e.visual.fill).style("stroke",e=>e.visual.stroke),i.canvas.select("g.beta-connectivity").selectAll("g.ladder").selectAll("path.vis").style("stroke",e=>p(i,e)),function(o,i,l=!0){var r,a,s,c;if(E(o.canvas.selectAll("g.heatmap-bar")),i){let i=function(o,i,l,r,a,s=""){let c=o.append("g").attr("class","heatmap-bar").attr("transform",`translate(${i.x},${i.y})`),d=(c.append("text").attr("class","heatmap-bar-label").attrs({x:-5,y:.5*i.height}).text(s),Math.floor(i.width)),h=(i.width-1)/d,u=c.append("g").attr("class","heatmap-bar-fill"),p=c.append("g").attr("class","heatmap-bar-stroke");return u.selectAll("rect").data(e.range(d)).enter().append("rect").attrs(e=>({x:e*h,y:0,width:h+1,height:i.height,stroke:"none",fill:t.byExpHeatmap(e/d*l,r).hex()})),p.append("rect").attrs(e=>({x:0,y:0,width:i.width,height:i.height,fill:"none"})),c.append("g").attr("class","heatmap-bar-ticks").selectAll("text").data(e.range(Math.floor(l/a)+1)).enter().append("text").attr("x",e=>e*a/l*i.width).attr("y",i.height+n.HANGING_TEXT_OFFSET).text(e=>e*a),c}(o.canvas,{x:o.screen.width-200-15,y:5,width:200,height:20},15,5,5,"3D variability [Å]"),d=null===(a=null===(r=o.mainDiv.select("div.control-panel#main-panel").node())||void 0===r?void 0:r.getBoundingClientRect())||void 0===a?void 0:a.right,h=null===(c=null===(s=i.node())||void 0===s?void 0:s.getBoundingClientRect())||void 0===c?void 0:c.left;void 0!==d&&void 0!==h&&d>h&&function(e,t,o,i){e.attr("transform",`translate(${t},${o})`);let l=e.select("g.heatmap-bar-ticks").selectAll("text"),r=e.select("g.heatmap-bar-stroke rect").attr("height");i?(l.attr("y",-n.HANGING_TEXT_OFFSET),l.style("dominant-baseline","alphabetic")):(l.attr("y",r+n.HANGING_TEXT_OFFSET),l.style("dominant-baseline","hanging"))}(i,o.screen.width-200-15,o.screen.height-5-20,!0),l&&m(i)}}(i,i.settings.colorMethod==o.ColorMethod.Stdev,l)},l.redraw=v,l.nodeBigEnoughForLabel=f,l.showBetaConnectivity=function(t,o,i=!0){t.settings.betaConnectivityVisibility=o;let a=t.canvas.selectAll("g.beta-connectivity");if(a.size()>0&&!o)i?E(a):a.remove();else if(0==a.size()&&o){let o=t.data;o.beta_connectivity.forEach(e=>e[3]=o.nodes[e[0]].active&&o.nodes[e[1]].active?1:0);let a=t.canvas.append("g").attr("class","beta-connectivity"),s=a.selectAll().data(o.beta_connectivity).enter().append("g").attr("class","ladder");t.ladderMap=new r.TupleMap,s.each((e,o,n)=>{const i=t.data.nodes[e[0]].label,l=t.data.nodes[e[1]].label,r=e[2]>0?"parallel":"antiparallel";t.ladderMap.set([i,l,r],n[o])}),s.append("path").attr("class","vis").style("stroke",e=>p(t,e)),h(0,s.append("path").attr("class","ghost"),o=>(function(t,o,n){let i=e.select(o.parentElement);if(!n)return i;const l=i.data()[0];let r=t.canvas.selectAll("g.node").nodes();return e.selectAll([i.node(),r[l[0]],r[l[1]]])})(t,o,!0),e=>l.dispatchMixedEvent(t,n.EVENT_TYPE_HOVER,e.data())),v(t,!1),i&&m(a)}},l.selectNodeFromShape=function(t,o,n){let i=e.select(o.parentElement);if(!n)return i;let l=[i.node()];const r=i.data()[0];if(void 0!=r.ladders&&r.ladders.length>0){let e=t.canvas.selectAll("g.ladder").nodes();for(const t of r.ladders)l.push(e[t])}return e.selectAll(l)},l.fadeOutRemove=E,l.fadeIn=m,l.dispatchMixedEvent=function(e,t,o){var i;if(!e.settings.dispatchEvents)return;let l=[],r=[];for(const t of o)if(void 0!=t.label){const e=t;l.push({label:e.label,type:e.type,sheetId:"e"==e.type.toLowerCase()?e.sheet_id:null})}else{const o=t;r.push([e.data.nodes[o[0]].label,e.data.nodes[o[1]].label,o[2]>0?"parallel":"antiparallel"])}let a={sourceType:null===(i=e.d3viewer.node())||void 0===i?void 0:i.tagName.toLowerCase(),sourceId:e.id,sourceInternalId:e.internalId,eventType:t,sses:l,ladders:r};e.d3viewer.dispatch(n.EVENT_PREFIX+t,{detail:a,bubbles:!0})},l.handleEvent=function(t,o){var i,l,r,a;const s=o.detail;if(null==s||void 0==s)return void console.error(`Event ${o.type}: event.detail must be an object.`);if(s.sourceType==(null===(i=t.d3viewer.node())||void 0===i?void 0:i.tagName.toLowerCase())&&s.sourceInternalId==t.internalId)return;const c=null!==(l=s.sses)&&void 0!==l?l:[],d=null!==(r=s.ladders)&&void 0!==r?r:[],h=n.EVENT_PREFIX+n.EVENT_TYPE_DO_SELECT,u=n.EVENT_PREFIX+n.EVENT_TYPE_DO_HOVER;let p;switch(o.type){case h:p="picked";break;case u:p="pointed";break;default:return void console.error("Unknown event type for OverProtViewer:",o.type)}t.canvas.selectAll(`g.node[${p}],g.ladder[${p}]`).attr(p,null);for(const n of c){if(void 0==n.label)return void console.error(`Event ${o.type}: event.detail.sses[i].label must be a string.`);const i=t.nodeMap.get(n.label);void 0!=i?e.select(i).attr(p,p):console.warn(`Event ${o.type}: SSE with label "${n.label}" is not present.`)}for(const n of d){if(n.length<3)return void console.error(`Event ${o.type}: event.detail.ladders[i] must be an array of length 3 ([strand1, strand2, "parallel"|"antiparallel"]).`,n);const i=n[0],l=n[1],r=n[2],s=null!==(a=t.ladderMap.get([i,l,r]))&&void 0!==a?a:t.ladderMap.get([l,i,r]);void 0!=s?e.select(s).attr(p,p):console.warn(`Event ${o.type}: Beta-ladder ${n} is not present.`)}o.type==h&&function(e){e.mainDiv.selectAll("div.tooltip[type=pinned]").remove(),e.mainDiv.selectAll("[tooltip=pinned]").attr("tooltip",null)}(t)}}(s||(s={})),function(t){function o(){return e.selectAll()}function l(e,t,n,i,l,a){let s={base:{viewer:e,id:t,children:[],div:o(),tooltip:a,show:e=>r(s,e)},text:n,square:i,onClick:l};return s}function r(t,o){t.base.div=o.append("div").attr("class",t.square?"button square-button":"button").attr("id",t.base.id),t.base.div.append("div").attr("class","button-text").html(t.text),s.setTooltips(t.base.viewer,t.base.div,[t.base.tooltip],!1,!0),t.base.div.on("click",t.onClick),t.base.div.on("dblclick",()=>{e.event.stopPropagation()})}function a(e,t){e.text=t,e.base.div.select("div.button-text").html(t)}function c(t,i,a,s,c){let d={base:{viewer:t,id:i,children:[],div:o(),tooltip:c,show:e=>(function(e,t){e.base.div=t.append("div").attr("class",e.autocollapse?"popup autocollapse":"popup").attr("id",e.base.id);let o=e.base.div.append("div").attr("class","popup-head");e.base.div.data([e]),r(e.headButton,o)})(d,e)},headButton:l(t,null,a+n.OPEN_POPUP_SYMBOL,!1,()=>(function(t){t.base.div.selectAll("div.popup-tail").size()>0?h(t):(u(t.base.viewer),function(t){var o;let n=t.base.div.select("div.popup-head"),i=t.base.div.append("div").attr("class","popup-tail");t.base.children.forEach(e=>e.base.show(i));let l=n.node().getBoundingClientRect().width,r=null===(o=i.node())||void 0===o?void 0:o.getBoundingClientRect().width;void 0!==r&&void 0!==l&&r<l&&i.style("width",l);t.autocollapse&&(t.base.viewer.mainDiv.on("click.autocollapse-popups",()=>u(t.base.viewer)),i.on("click.autocollapse-popups",()=>e.event.stopPropagation()))}(t),e.event.stopPropagation())})(d),c),autocollapse:s};return d}function d(e,t){e.base.children.push(t)}function h(e){e.base.div.selectAll("div.popup-tail").remove()}function u(e){e.mainDiv.selectAll("div.popup.autocollapse").each(e=>h(e))}function p(e,t){a(e.headButton,t+n.OPEN_POPUP_SYMBOL)}function v(e,t,n,i,l,r){let a={base:{viewer:e,id:t,children:[],div:o(),tooltip:r,show:e=>(function(e,t){e.base.div=t.append("div").attr("class","listbox").attr("id",e.base.id);e.base.div.selectAll().data(e.namesValuesTooltips).enter().append("div").attr("class",t=>t[1]==e.selectedValue?"button listbox-item selected":"button listbox-item").on("click",t=>{e.selectedValue=t[1],e.base.div.selectAll("div.listbox-item").attr("class",t=>t[1]==e.selectedValue?"button listbox-item selected":"button listbox-item"),e.onSelect(t[1])}).append("div").attr("class","button-text").html(e=>e[0]),s.setTooltips(e.base.viewer,e.base.div.selectAll("div.listbox-item"),e.namesValuesTooltips.map(e=>e[2]),!1,!0),s.setTooltips(e.base.viewer,e.base.div,[e.base.tooltip],!1,!0)})(a,e)},namesValuesTooltips:n,selectedValue:i,onSelect:l};return a}function f(e,t,n,i,l,r,a,s,c,d,h){let u={base:{viewer:e,id:t,children:[],div:o(),tooltip:h,show:e=>E(u,e)},minValue:n,maxValue:i,step:l,selectedValue:r,minValueLabel:null!==a&&void 0!==a?a:n.toString(),maxValueLabel:null!==s&&void 0!==s?s:i.toString(),onMove:c,onRelease:d};return u}function E(t,o){t.base.div=o.append("div").attr("class","slider").attr("id",t.base.id);let n=t.base.div.append("div").attr("class","slider-left-value").text(t.minValueLabel),i=t.base.div.append("div").attr("class","slider-right-value").text(t.maxValueLabel),l=t.base.div.append("div").attr("class","slider-main"),r=l.append("div").attr("class","slider-rail-ruler");r.append("div").attr("class","slider-rail");let a=r.append("div").attr("class","slider-rail-clickable"),c=r.append("div").attr("class","slider-handle-ruler"),d=c.append("div").attr("class","slider-handle"),h=g(t,t.selectedValue);c.style("left",100*h+"%"),s.setTooltips(t.base.viewer,l,[t.base.tooltip],!1,!0),s.setTooltips(t.base.viewer,n,["Click/hold to decrease value."],!1,!0),s.setTooltips(t.base.viewer,i,["Click/hold to increase value."],!1,!0);let u=e.drag().on("start.slider",()=>A(t,e.event.sourceEvent)).on("drag.slider",()=>A(t,e.event.sourceEvent)).on("end.slider",()=>(function(e,t){let o=w(e,t);if(null!==o){let t=_(e,o);t=T(e,t),o=g(e,t),e.base.div.select("div.slider-handle-ruler").style("left",100*o+"%"),e.selectedValue=t,e.onRelease(t)}})(t,e.event.sourceEvent));u(a),u(d),s.addMouseHoldBehavior(n,()=>m(t,-1),()=>m(t,-1),()=>{}),s.addMouseHoldBehavior(i,()=>m(t,1),()=>m(t,1),()=>{})}function m(e,t){let o=i.constrain(e.selectedValue+t*e.step,e.minValue,e.maxValue),n=g(e,o);e.base.div.select("div.slider-handle-ruler").style("left",100*n+"%"),e.selectedValue=o,e.onMove(o),e.onRelease(o)}function g(e,t){let o=(t-e.minValue)/(e.maxValue-e.minValue);return o=i.constrain(o,0,1)}function _(e,t){return e.minValue+t*(e.maxValue-e.minValue)}function T(e,t){let o=Math.round((t-e.minValue)/e.step);return e.minValue+o*e.step}function w(e,t){let o=e.base.div.selectAll("div.slider-rail-ruler").node();if(null!==o){let{x:e,width:n}=o.getBoundingClientRect(),l=(t.clientX-e)/n;return l=i.constrain(l,0,1)}return null}function A(e,t){let o=w(e,t);if(null!==o){let t=_(e,o);o=g(e,t=T(e,t)),e.base.div.select("div.slider-handle-ruler").style("left",100*o+"%"),e.onMove(t)}}t.newControlPanel=function(e,t,n){let i={base:{viewer:e,id:t,children:[],div:o(),tooltip:n,show:e=>(function(e,t){e.base.div=t.append("div").attr("class","control-panel").attr("id",e.base.id),e.base.children.forEach(t=>t.base.show(e.base.div))})(i,e)}};return i},t.addToControlPanel=function(e,t){e.base.children.push(t)},t.newButton=l,t.changeButtonText=a,t.newPopup=c,t.addToPopup=d,t.newListbox=v,t.newDropdownList=function(e,t,o,n,i,l,r,a=!0,s=!0){let u=c(e,t,o,a,r),p=v(e,t,n,i,s?e=>{h(u),l(e)}:l,null);return d(u,p),u},t.newSlider=f,t.showSlider=E,t.newPopupSlider=function(e,t,o,n,i,l,r,a,s,h,u,v,E,m=!0){let g=c(e,t,o+a+n,m,E),_=f(e,t,i,l,r,a,s,h,e=>{p(g,o+e+n),u(e)},e=>{p(g,o+e+n),v(e)},null);return d(g,_),g}}(c||(c={}));var h,u=function(e,t,o,n){return new(o||(o=Promise))(function(i,l){function r(e){try{s(n.next(e))}catch(e){l(e)}}function a(e){try{s(n.throw(e))}catch(e){l(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,a)}s((n=n.apply(e,t||[])).next())})};!function(d){function h(e,t){e.data=t,l.filterDagAndAddLevels(e.data,e.settings.occurrenceThreshold),p(e)}function p(e){if(e.canvas.selectAll(":scope > :not(defs)").remove(),null!==e.data.error)return void e.canvas.append("text").attr("class","central-message").attrs({x:e.screen.width/2,y:e.screen.height/2}).text("Error: "+e.data.error);if(0==e.data.activeNodes.length)return void e.canvas.append("text").attr("class","central-message").attrs({x:e.screen.width/2,y:e.screen.height/2}).text("No secondary structure elements");let t=e.data,r=e.settings.shapeMethod==o.ShapeMethod.SymCdf?t.nodes.map(e=>e.cdf[e.cdf.length-1][0]*n.LENGTH_SCALE):t.nodes.map(e=>e.avg_length*n.LENGTH_SCALE),c=t.nodes.map(e=>e.occurrence*n.OCCURRENCE_SCALE),d=t.nodes.map(e=>e.occurrence*e.avg_length);if(e.settings.layoutMethod==o.LayoutMethod.Old){let o=t.nodes.length,i=t.levels.length,a=new Array(o),s=new Array(o),d=new Array(o).fill(0),h=0;for(let e=0;e<i;e++){const o=t.levels[e];let i=o.length;for(let e=0;e<i;e++){const t=o[e];a[t]=h,s[t]=h+r[t],d[t]=e-(i-1)/2}h=Math.max(...o.map(e=>s[e]))+n.GAP_LENGTH}for(let e=0;e<t.nodes.length;e++)t.nodes[e].visual=l.newNodeVisual(),t.nodes[e].active?t.nodes[e].visual.rect={x:a[e],width:r[e],y:d[e]*n.FLOOR_HEIGHT-c[e]/2,height:c[e]}:t.nodes[e].visual.rect={x:-n.LEFT_MARGIN,width:0,y:0,height:0};let u=h-n.GAP_LENGTH,p=Math.min(...d),v=Math.max(...d),f=-n.LEFT_MARGIN,E=u+n.RIGHT_MARGIN,m=p*n.FLOOR_HEIGHT-.5*n.OCCURRENCE_SCALE-n.TOP_MARGIN,g=v*n.FLOOR_HEIGHT+.5*n.OCCURRENCE_SCALE+n.BOTTOM_MARGIN;e.world={x:f,y:m,width:E-f,height:g-m}}else if(e.settings.layoutMethod==o.LayoutMethod.New){let o=a.newDagFromPrecedence(t.levels,t.precedence),i=new Map;for(const e of o.vertices)i.set(e,{width:r[e],height:c[e],weight:d[e]});const[s,h]=a.embedDag(o,i,{x:n.GAP_LENGTH,y:n.FLOOR_HEIGHT-n.OCCURRENCE_SCALE},n.LEFT_MARGIN,n.RIGHT_MARGIN,n.TOP_MARGIN,n.BOTTOM_MARGIN);e.world={x:-s.left,y:-s.top,width:s.right+s.left,height:s.bottom+s.top};for(let o=0;o<t.nodes.length;o++)if(t.nodes[o].visual=l.newNodeVisual(),t.nodes[o].active){const{x:e,y:n}=h.get(o),{width:l,height:r}=i.get(o);t.nodes[o].visual.rect={x:e-l/2,y:n-r/2,width:l,height:r}}else t.nodes[o].visual.rect={x:e.world.x,y:e.world.y,width:0,height:0}}let h=i.zoomAllZoomout(e.world,e.screen),u=(n.OCCURRENCE_SCALE+n.TOP_MARGIN+n.BOTTOM_MARGIN)/e.screen.height,p=e.world.height/e.screen.height,E=u/10,m=h*n.MAX_X_ZOOMOUT;e.zoom=i.newZoomInfo(E,m,u,p,h),e.visWorld=i.centeredVisWorld(e.world,e.screen,e.zoom),t.precedenceLines=[];for(const e of t.precedence){let o=t.nodes[e[0]].visual.rect,i=t.nodes[e[1]].visual.rect,l=o.x+o.width,r=o.y+o.height/2,a=i.x,s=i.y+i.height/2;t.precedenceLines.push({x1:l,y1:r,x2:l+n.KNOB_LENGTH,y2:r}),t.precedenceLines.push({x1:l+n.KNOB_LENGTH,y1:r,x2:a-n.KNOB_LENGTH,y2:s}),t.precedenceLines.push({x1:a-n.KNOB_LENGTH,y1:s,x2:a,y2:s})}let g,_=e.canvas.append("g").attr("class","nodes").selectAll("g.node").data(t.nodes).enter().append("g").attr("class","node").attr("opacity",e=>e.active?1:0);e.nodeMap=new Map,_.each((t,o,n)=>e.nodeMap.set(t.label,n[o]));(g=e.settings.shapeMethod==o.ShapeMethod.SymCdf?_.append("polygon"):_.append("rect")).filter(e=>e.active);s.addPointBehavior(e,g,t=>s.selectNodeFromShape(e,t,!0),t=>s.dispatchMixedEvent(e,n.EVENT_TYPE_HOVER,t.data())),s.addPickBehavior(e,g,t=>s.selectNodeFromShape(e,t,!0),t=>s.dispatchMixedEvent(e,n.EVENT_TYPE_SELECT,t.data())),s.setTooltips(e,g,_.data().map(v),!0,!1),_.append("text").attr("class","node-label").text(e=>e.label),e.canvas.append("g").attr("class","edges").selectAll().data(t.precedenceLines).enter().append("line").attr("stroke",n.EDGE_COLOR),s.showBetaConnectivity(e,e.settings.betaConnectivityVisibility,!1),f(e,e.settings.colorMethod,!1),s.zoomAll(e),s.redraw(e,!1)}function v(e){if(e.active){let[t,o]=l.getNodeMinMaxLength(e);return['<div class="node-tooltip">',`<span class="tooltip-title">${e.label}</span>`,"<table>",`<tr><td>Type:</td><td>${"e"==e.type?"Strand":"Helix"}</td></tr>`,`<tr><td>Occurrence:</td><td>${i.round(100*e.occurrence,1)}%</td></tr>`,`<tr><td>Min. length:</td><td>${t} residues</td></tr>`,`<tr><td>Avg. length:</td><td>${i.round(e.avg_length,2)} residues</td></tr>`,`<tr><td>Max. length:</td><td>${o} residues</td></tr>`,`<tr><td>3D variability:</td><td>${i.round(e.stdev3d,2)} &#8491;</td></tr>`,"e"==e.type?`<tr><td>Sheet:</td><td>${e.sheet_id}</td></tr>`:"","</table>","</div>"].join("")}return null}function f(i,l,r=!0){i.settings.colorMethod=l,i.data.nodes.forEach((i,r)=>{let a;switch(l){case o.ColorMethod.Uniform:a=t.NEUTRAL_COLOR;break;case o.ColorMethod.Type:a=t.bySseType(i.type);break;case o.ColorMethod.Sheet:a=t.byIndex1(i.sheet_id);break;case o.ColorMethod.Stdev:a=t.byExpHeatmap(i.stdev3d,n.HEATMAP_MIDDLE_VALUE);break;case o.ColorMethod.Rainbow:a=void 0!=i.rainbow_hex?e.rgb(i.rainbow_hex):t.NEUTRAL_COLOR}i.visual.fill=a.hex(),i.visual.stroke=a.darker().hex()}),s.recolor(i,r)}d.initializeViewer=function(t){var a;let d=r.newSettingsFromHTMLElement(t);const v=t.id||"",E=`${v}-${Math.random().toString(36).slice(2)}`;console.log(`Initializing OverProt viewer with id="${v}", file="${d.file}"`,d);const m=e.select(t);m.selectAll(":scope > *").remove();let g=m.append("div").attr("class","overprot-viewer").attr("id","overprot-viewer-"+E),_=g.append("div").attr("class","gui").styles({width:d.width,height:d.height}),T=null===(a=_.node())||void 0===a?void 0:a.getBoundingClientRect();if(void 0!==T){let{width:e,height:t}=T;d.width=e,d.height=t}let w=_.append("div").attr("class","canvas").append("svg").attr("class","canvas").attrs({width:d.width,height:d.height});const A=function(){var e;const t="div.overprot-viewer";let o=[];for(const i of document.styleSheets){var n=null!==(e=i.cssRules)&&void 0!==e?e:[];for(const e of n)if(e.cssText.includes(t)){let n=e.cssText.replace(t,"");o.push(n)}}return o.join("\n")}();w.append("defs").append("style").attr("type","text/css").html(A);let M=r.newViewer(v,E,m,g,_,w,d);if(function(e){let t=e.guiDiv.append("div").attr("class","internal-controls"),i=[["Uniform",o.ColorMethod.Uniform,"Show all SSEs in the same color."],["Type",o.ColorMethod.Type,"Show &beta;-strands in blue, helices in gray."],["Sheet",o.ColorMethod.Sheet,"Assign the same color to &beta;-strands from the same &beta;-sheet, <br>show helices in gray."],["Variability",o.ColorMethod.Stdev,"<strong>3D variability</strong> measures the standard deviation of the SSE end point coordinates.<br>Low values (dark) indicate conserved SSE position, <br>high values (bright) indicate variable SSE position."],["Rainbow",o.ColorMethod.Rainbow,"Rainbow coloring from N-terminus (blue) to C-terminus (red)."]],r=[["Rectangle",o.ShapeMethod.Rectangle,"Show SSEs as rectangles. <br>Height of the rectangle indicates <strong>occurrence</strong> (what percentage of structures contain this SSE), <br>width indicates <strong>average length</strong> (number of residues)."],["SymCDF",o.ShapeMethod.SymCdf,"<strong>Cumulative distribution function</strong> describes the statistical distribution of the SSE length. <br>The widest part of the shape corresponds to maximum length, the narrowest to minimum length, <br> the height corresponds to occurrence. <br>(The SymCDF shape consists of four symmetrical copies of the CDF, the bottom right quarter is the classical CDF.)"]],a=c.newControlPanel(e,"main-panel",null),d=c.newButton(e,"zoom-in","+",!0,()=>s.zoomIn(e),"Zoom in. <br>Tip: Use Ctrl + mouse wheel to zoom.");c.addToControlPanel(a,d);let u=c.newButton(e,"zoom-out","-",!0,()=>s.zoomOut(e),"Zoom out. <br>Tip: Use Ctrl + mouse wheel to zoom.");c.addToControlPanel(a,u);let v=c.newButton(e,"zoom-reset",n.RESET_SYMBOL,!0,()=>s.zoomAll(e),"Reset zoom. <br>Tip: Use double click to reset zoom.");c.addToControlPanel(a,v);let E=c.newDropdownList(e,"color-method","Color",i,e.settings.colorMethod,t=>f(e,t),"Choose coloring method.",!0,!1);c.addToControlPanel(a,E);let m=c.newDropdownList(e,"shape-method","Shape",r,e.settings.shapeMethod,t=>(function(e,t){e.settings.shapeMethod=t,h(e,e.data)})(e,t),"Choose shape method.",!0,!1);c.addToControlPanel(a,m);let g=c.newDropdownList(e,"beta-connectivity","Beta-connectivity",[["On",!0,null],["Off",!1,null]],e.settings.betaConnectivityVisibility,t=>s.showBetaConnectivity(e,t,!0),"<strong>Beta-connectivity</strong> shows how &beta;-strands are connected to each other in &beta;-sheets.<br>Upper arcs indicate antiparallel connections,<br>lower arcs indicate parallel connections.",!0,!1);c.addToControlPanel(a,g);let _=c.newPopupSlider(e,"occurrence-threshold","Occurrence threshold: ","%",0,100,1,100*e.settings.occurrenceThreshold,"0%","100%",e=>{},t=>(function(e,t){e.settings.occurrenceThreshold=t,l.filterDagAndAddLevels(e.data,t),p(e)})(e,t/100),"Hide SSEs with occurrence lower than the specified threshold.");c.addToControlPanel(a,_);let T=c.newButton(e,"save","&#10515;",!0,()=>s.save(e),"Save image.");c.addToControlPanel(a,T),a.base.show(t)}(M),g.append("br"),w.on("dblclick",()=>s.zoomAll(M)),w.on("wheel",()=>{if(e.event.ctrlKey){let t=e.event.deltaY>0?n.ZOOM_STEP_RATIO_MOUSE:1/n.ZOOM_STEP_RATIO_MOUSE;s.zoomOut(M,t,e.mouse(w.node())),e.event.preventDefault()}else{let e=M.canvas.selectAll("text.temporary-central-message").data([1]).enter().append("rect").attr("class","temporary-central-message-background").attrs({x:0,width:M.screen.width,y:0,height:M.screen.height}),t=M.canvas.selectAll("text.temporary-central-message").data([1]).enter().append("text").attr("class","temporary-central-message").attrs({x:M.screen.width/2,y:M.screen.height/2}).text("Use Ctrl + scroll to zoom");s.fadeIn(e),s.fadeIn(t),s.fadeOutRemove(e,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT),s.fadeOutRemove(t,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT)}}),e.drag().on("drag",()=>s.shiftByMouse(M,-e.event.dx,-e.event.dy))(w),e.select(window).on("resize."+E,()=>{let e=_.node().getBoundingClientRect();!function(e,t,o){let n=e.zoom.zoomout!=e.zoom.initialZoomout,l=e.zoom.zoomout,r=e.visWorld,a=l*e.screen.width/t;e.canvas.attr("width",t).attr("height",o),e.screen.width=t,e.screen.height=o,p(e),n&&s.zoomSet(e,a,i.rectangleCenter(r))}(M,e.width,e.height)}),d.listenEvents&&(t.addEventListener(n.EVENT_PREFIX+n.EVENT_TYPE_DO_SELECT,e=>s.handleEvent(M,e)),t.addEventListener(n.EVENT_PREFIX+n.EVENT_TYPE_DO_HOVER,e=>s.handleEvent(M,e))),M.canvas.append("text").attr("class","central-message").attrs({x:M.screen.width/2,y:M.screen.height/2}).text("Loading..."),""!=d.file){let e=new URL(d.file,document.baseURI).toString();fetch(e).catch(t=>u(this,void 0,void 0,function*(){console.error(`OverProt Viewer with id="${M.id}" failed to initialize because the request for`,e,"failed (this might be caused by CORS policy). Original error:",t);let o=l.newDagWithError(`Failed to fetch data from "${e}"`);h(M,o)})).then(t=>u(this,void 0,void 0,function*(){if(t&&t.ok){let e=yield t.text(),o=l.dagFromJson(e);h(M,o)}else if(t&&!t.ok){console.error(`OverProt Viewer with id="${M.id}" failed to initialize because the request for`,e,"returned status code",t.status,t.statusText);let o=l.newDagWithError(`Failed to fetch data from "${e}"`);h(M,o)}})).catch(e=>u(this,void 0,void 0,function*(){console.error(`OverProt Viewer with id="${M.id}" failed to initialize because of internal error.`);let t=l.newDagWithError("Internal error");throw h(M,t),e}))}else{let e=l.newDagWithError("No file specified");h(M,e)}}}(h||(h={})),function(e){window.customElements.define("overprot-viewer",class extends HTMLElement{constructor(){super()}connectedCallback(){this.initialize()}initialize(){return h.initializeViewer(this)}})}()}(d3);
!function(e){"use strict";var t,o,n,i,l,r,s;!function(t){var o;o=function(){let t=e.schemeCategory10.map(t=>e.rgb(t));return{neutral:t.splice(7,1)[0],scheme:t}}(),t.NEUTRAL_COLOR=o.neutral,t.COLOR_SCHEME=o.scheme,t.NEUTRAL_DARK=e.rgb(0,0,0),t.bySseType=function(e){return"h"==(e=e.toLowerCase())?t.NEUTRAL_COLOR:"e"==e?t.COLOR_SCHEME[0]:t.COLOR_SCHEME[1]},t.byIndex0=function(e){return t.COLOR_SCHEME[e%t.COLOR_SCHEME.length]},t.byIndex1=function(e){return e>=1?t.COLOR_SCHEME[(e-1)%t.COLOR_SCHEME.length]:t.NEUTRAL_COLOR},t.byLinHeatmap=function(t,o){const n=t/o;return e.rgb(e.interpolateInferno(n))},t.byExpHeatmap=function(t,o){const n=1-Math.pow(2,-t/o);return e.rgb(e.interpolateInferno(n))}}(t||(t={})),function(e){let t,o,n;!function(e){e[e.Uniform=0]="Uniform",e[e.Type=1]="Type",e[e.Sheet=2]="Sheet",e[e.Stdev=3]="Stdev"}(t=e.ColorMethod||(e.ColorMethod={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.SymCdf=1]="SymCdf"}(o=e.ShapeMethod||(e.ShapeMethod={})),function(e){e[e.Old=0]="Old",e[e.New=1]="New"}(n=e.LayoutMethod||(e.LayoutMethod={}))}(o||(o={})),function(n){n.CANVAS_HEIGHT=300,n.CANVAS_WIDTH=1500,n.ZOOM_STEP_RATIO=1.25,n.ZOOM_STEP_RATIO_MOUSE=n.ZOOM_STEP_RATIO,n.SHIFT_STEP_RELATIVE=.2,n.MAX_EMPTY_X_MARGIN=0,n.MAX_EMPTY_Y_MARGIN=0,n.MAX_X_ZOOMOUT=1/(1-2*n.MAX_EMPTY_X_MARGIN),n.MAX_Y_ZOOMOUT=1/(1-2*n.MAX_EMPTY_Y_MARGIN),n.TRANSITION_DURATION=e.transition().duration(),n.TOOLTIP_DELAY=600,n.MOUSE_HOLD_BEHAVIOR_INITIAL_SLEEP_TIME=500,n.MOUSE_HOLD_BEHAVIOR_STEP_SLEEP_TIME=50,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT=1e3,n.TOOLTIP_OFFSET={x:12,y:0},n.NODE_STROKE_WIDTH=1,n.NODE_STROKE_WIDTH_HIGHLIGHTED=3,n.EDGE_COLOR="#808080",n.NODE_FILL=t.NEUTRAL_COLOR,n.NODE_STROKE=t.NEUTRAL_COLOR.darker(),n.MINIMAL_WIDTH_FOR_SSE_LABEL=20,n.HEATMAP_MIDDLE_VALUE=5,n.DEFAULT_OCCURRENCE_THRESHOLD=.2,n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY=!0,n.DEFAULT_LAYOUT_METHOD=o.LayoutMethod.New,n.DEFAULT_COLOR_METHOD=o.ColorMethod.Sheet,n.DEFAULT_SHAPE_METHOD=o.ShapeMethod.Rectangle,n.DEFAULT_DISPATCH_EVENTS=!1,n.DEFAULT_LISTEN_EVENTS=!1,n.LENGTH_SCALE=4,n.OCCURRENCE_SCALE=100,n.FLOOR_HEIGHT=1.25*n.OCCURRENCE_SCALE,n.TOP_MARGIN=.25*n.OCCURRENCE_SCALE,n.BOTTOM_MARGIN=.25*n.OCCURRENCE_SCALE,n.LEFT_MARGIN=4*n.LENGTH_SCALE,n.RIGHT_MARGIN=4*n.LENGTH_SCALE,n.GAP_LENGTH=3*n.LENGTH_SCALE,n.KNOB_LENGTH=1*n.LENGTH_SCALE,n.ARC_MAX_DEVIATION=.5*n.OCCURRENCE_SCALE+Math.min(n.TOP_MARGIN,n.BOTTOM_MARGIN),n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH=.001,n.ARC_MAX_MINOR=n.ARC_MAX_DEVIATION/(1-Math.sqrt(1-Math.pow(1/(1+2*n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH),2))),n.ARC_SMART_DEVIATION_PARAM_WRT_WORLD_WIDTH=.2,n.HELIX_TYPE="h",n.STRAND_TYPE="e",n.HANGING_TEXT_OFFSET=5,n.RESET_SYMBOL="&#x27F3;",n.OPEN_POPUP_SYMBOL=" &#x25BE;",n.EVENT_PREFIX="PDB.overprot.",n.EVENT_TYPE_SELECT="select",n.EVENT_TYPE_HOVER="hover",n.EVENT_TYPE_DO_SELECT="do.select",n.EVENT_TYPE_DO_HOVER="do.hover"}(n||(n={})),function(e){function t(e){return[e.x+.5*e.width,e.y+.5*e.height]}function o(e,t){e.zoomout=i(t,e.minZoomout,e.maxZoomout),e.xZoomout=i(e.zoomout,e.minXZoomout,e.maxXZoomout),e.yZoomout=i(e.zoomout,e.minYZoomout,e.maxYZoomout)}function i(e,t,o){return Math.min(Math.max(e,t),o)}function l(e,t=0){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}e.newRectangle=function(){return{x:-1,y:-1,width:2,height:2}},e.rectangleFromCanvas=function(e){return{x:0,y:0,width:+e.style("width").replace("px",""),height:+e.style("height").replace("px","")}},e.rectangleCenter=t,e.newZoomInfo=function(e,t,o,n,l){e>t&&console.warn("newZoomInfo(): minXZoomout > maxXZoomout"),o>n&&console.warn("newZoomInfo(): minYZoomout > maxYZoomout");let r=Math.min(e,o),s=Math.max(t,n),a=i(l,r,t);return{zoomout:a,xZoomout:i(a,e,t),yZoomout:i(a,o,n),minZoomout:r,maxZoomout:s,minXZoomout:e,maxXZoomout:t,minYZoomout:o,maxYZoomout:n,initialZoomout:l}},e.zoomInfoZoomOut=function(e,t){o(e,e.zoomout*t)},e.zoomInfoSetZoomout=o,e.zoomAllZoomout=function(e,t){return Math.max(e.width/t.width,e.height/t.height)},e.centeredVisWorld=function(e,o,n){let i=o.width*n.xZoomout,l=o.height*n.yZoomout,[r,s]=t(e);return{x:r-.5*i,y:s-.5*l,width:i,height:l}},e.constrain=i,e.arcPathD_circle=function(e,t,o,n,i=1){if(0==t)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:l,y1:r,x2:s,y2:a}=e,c=s-l,d=a-r,h=Math.abs(c),u=t*h/(h+o),p=u/2+(Math.pow(c/i,2)+Math.pow(d,2))/(8*u);return`M${s},${a} A${p*i},${p} 0 0,${n?1:0} ${l},${r}`}},e.arcPathD_ellipse=function(e,t,o,i,l=1){if(0==o)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:r,y1:s,x2:a,y2:c}=e,d=c-s,h=a-r,u=h/l,p=Math.sqrt(Math.pow(u,2)+Math.pow(d,2))/2+n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH*t/l,v=Math.min(o*Math.sqrt(Math.abs(h)/t),p),f=Math.atan(d/u),[E,m,g]=function(e,t,o,n){const{cos:i,sin:l,sqrt:r,atan:s}=Math;if(1==n)return[e,t,o];if(0==o||0==l(2*o))return[n*e,t,o];if(e==t)return[n*e,t,0];const a=Math.pow(n,2)*Math.pow(e,2)*Math.pow(i(o),2)+Math.pow(e,2)*Math.pow(l(o),2),c=2*(1-Math.pow(n,2))*e*t*i(o)*l(o),d=Math.pow(n,2)*Math.pow(t,2)*Math.pow(l(o),2)+Math.pow(t,2)*Math.pow(i(o),2),h=c,u=2*(a-d),p=-c,v=Math.pow(u,2)-4*h*p;let f=(-u+r(v))/(2*h),E=(-u-r(v))/(2*h),m=r((a+c*f+d*Math.pow(f,2))/(1+Math.pow(f,2))),g=r((a+c*E+d*Math.pow(E,2))/(1+Math.pow(E,2)));m<g&&([f,E]=[E,f],[m,g]=[g,m]);const T=1/(1+Math.pow(f,2)),_=1-T,w=f/(1+Math.pow(f,2)),A=Math.pow(e,2)*i(o)*l(o)*T+e*t*w+Math.pow(t,2)*i(o)*l(o)*_,M=n*(Math.pow(e,2)*Math.pow(i(o),2)*T-Math.pow(t,2)*Math.pow(l(o),2)*_);let y=s(A/M);return[m,g,y]}(p,v,f,l);return`M${a},${c} A${E},${m} ${g*=180/Math.PI} 0,${i?1:0} ${r},${s}`}},e.arcPathD_bezier=function(e,t,o,n,i=1){if(0==t)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:i,y1:l,x2:r,y2:s}=e,a=r-i,c=Math.abs(a),d=t*c/(c+o)*(n?-1:1);const h=.05*a,u=1.32;return`M${i},${l} C${i+h},${l-d*u} ${r-h},${s-d*u} ${r},${s}`}},e.symCdfPolygonPoints=function(e,o){let[n,i]=t(e),r=o[o.length-1][0],s=o[0][0]>0?1:1-o[0][1],a=.5*e.width/r,c=.5*e.height/s,d=[];o[0][0]>0&&(d.push([0,c]),d.push([o[0][0]*a,c])),d.push([o[0][0]*a,(1-o[0][1])*c]);for(let e=1;e<o.length;e++)d.push([o[e][0]*a,(1-o[e-1][1])*c]),d.push([o[e][0]*a,(1-o[e][1])*c]);let h=[];for(let e=0;e<d.length-1;e++)h.push([n+d[e][0],i+d[e][1]]);for(let e=d.length-1;e>0;e--)h.push([n+d[e][0],i-d[e][1]]);for(let e=0;e<d.length-1;e++)h.push([n-d[e][0],i-d[e][1]]);for(let e=d.length-1;e>0;e--)h.push([n-d[e][0],i+d[e][1]]);return h.map(e=>l(e[0],1)+","+l(e[1],1)).join(" ")},e.rectToScreen=function(e,t,o){let{x:n,y:i,width:l,height:r}=o;return{x:(n-e.x)/e.width*t.width+t.x,y:(i-e.y)/e.height*t.height+t.y,width:l/e.width*t.width,height:r/e.height*t.height}},e.lineToScreen=function(e,t,o){let{x1:n,y1:i,x2:l,y2:r}=o;return{x1:(n-e.x)/e.width*t.width+t.x,y1:(i-e.y)/e.height*t.height+t.y,x2:(l-e.x)/e.width*t.width+t.x,y2:(r-e.y)/e.height*t.height+t.y}},e.round=l}(i||(i={})),function(t){function o(){return{nodes:[],precedence:[],beta_connectivity:[],levels:[],precedenceLines:[],activeNodes:[],origPrecedence:[],origBetaConnectivity:[],error:null}}function l(e){let t={nodes:[],precedence:[],beta_connectivity:[],levels:[],precedenceLines:[],activeNodes:[],origPrecedence:[],origBetaConnectivity:[],error:null};return t.error=e,t}function r(e,t,o,n){let i=o[e].filter(e=>e!=t);for(;i.length>0;){let e=i.pop();if(-1!=n[e]&&n[e]<n[t])i.push(...o[e]);else if(e==t)return!0}return!1}function s(e,t){let o=new Array(e),n=new Array(e);for(let t=0;t<e;t++)o[t]=[],n[t]=[];return t.forEach(e=>{o[e[1]].push(e[0]),n[e[0]].push(e[1])}),{ins:o,outs:n}}t.newDag=o,t.dagFromJson=function(t){var o;let n=null;try{let i=JSON.parse(t);return n=i.error=null!==(o=i.error)&&void 0!==o?o:null,i.nodes.forEach(e=>e.active=!0),i.levels=[],i.precedenceLines=[],i.activeNodes=e.range(i.nodes.length),i.origPrecedence=i.precedence,i.origBetaConnectivity=i.beta_connectivity,i}catch(e){return n=null!==n&&void 0!==n?n:"Failed to parse input file.",console.warn(n,"\n",e,"\n",t),l(n)}},t.newDagWithError=l,t.newNodeVisual=function(){return{rect:i.newRectangle(),fill:n.NODE_FILL.hex(),stroke:n.NODE_STROKE.hex()}},t.filterDagAndAddLevels=function(t,o){let n=t.nodes.length;for(let e of t.nodes)e.active=e.occurrence>=o&&e.avg_length>0;let i=e.range(n).filter(e=>t.nodes[e].active),{ins:l,outs:a}=s(n,t.origPrecedence);for(let e=0;e<n;e++)if(!t.nodes[e].active)for(let t of l[e])for(let o of a[e])a[t].includes(o)||(a[t].push(o),l[o].push(t));t.activeNodes=i,t.precedence=[];for(let e of i)for(let o of a[e])t.nodes[o].active&&t.precedence.push([e,o]);!function(e){let t=[],o=new Set(e.activeNodes),n=e.precedence;for(;o.size>0;){let e=new Set(o);n.forEach(t=>e.delete(t[1])),n=n.filter(t=>!e.has(t[0])),e.forEach(e=>o.delete(e)),t.push(Array.from(e))}e.levels=t}(t),function(e){let t=e.nodes.length,o=new Array(t).fill(-1);e.levels.forEach((e,t)=>e.forEach(e=>o[e]=t));let n=[],{outs:i}=s(t,e.precedence);for(let t=0;t<e.levels.length;t++){const l=e.levels[t];l.forEach(e=>{i[e].forEach(l=>{o[l]!=t+1&&r(e,l,i,o)||n.push([e,l])})})}e.precedence=n}(t)},t.getNodeMinMaxLength=function(e){let t=e.cdf.map(e=>e[0]).filter(e=>e>0);return 0==t.length?[0,0]:[t[0],t[t.length-1]]}}(l||(l={})),function(t){function r(){return{file:"",width:n.CANVAS_WIDTH,height:n.CANVAS_HEIGHT,colorMethod:n.DEFAULT_COLOR_METHOD,shapeMethod:n.DEFAULT_SHAPE_METHOD,layoutMethod:n.DEFAULT_LAYOUT_METHOD,betaConnectivityVisibility:n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY,occurrenceThreshold:n.DEFAULT_OCCURRENCE_THRESHOLD,dispatchEvents:n.DEFAULT_DISPATCH_EVENTS,listenEvents:n.DEFAULT_LISTEN_EVENTS}}function s(e,t,o,n){return null===t?n:void 0!==o[t]?o[t]:(console.warn(`Attribute "${e}" has invalid value "${t}". Allowed values: ${Object.keys(o)}.`),n)}function a(e,t,o,n=[]){if(null===t)return o;{let i=parseInt(t);return isNaN(i)?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be an integer.`),o):n.length>=2&&(i<n[0]||i>n[1])?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be an integer between ${n[0]} and ${n[1]}.`),o):i}}t.newViewer=function(e,t,o,n,s,a,c=null){return{id:e,uniqueId:t,d3viewer:o,mainDiv:n,guiDiv:s,canvas:a,data:l.newDag(),world:i.newRectangle(),visWorld:i.newRectangle(),screen:i.rectangleFromCanvas(a),zoom:i.newZoomInfo(1,1,1,1,1),settings:null!==c&&void 0!==c?c:r(),nodeMap:new Map}},t.newSettings=r,t.newSettingsFromHTMLElement=function(t){var i;let l=["id","file","width","height","color-method","shape-method","layout-method","beta-connectivity","occurrence-threshold","dispatch-events","listen-events"];["file"].forEach(e=>{t.hasAttribute(e)||console.error(`Missing attribute: "${e}".`)});for(let e=0;e<t.attributes.length;e++){let o=t.attributes.item(e).name;l.includes(o)||console.warn(`Unknown attribute: "${o}"`)}let r=e.select(t);const c={uniform:o.ColorMethod.Uniform,type:o.ColorMethod.Type,sheet:o.ColorMethod.Sheet,variability:o.ColorMethod.Stdev},d={rectangle:o.ShapeMethod.Rectangle,symcdf:o.ShapeMethod.SymCdf},h={old:o.LayoutMethod.Old,new:o.LayoutMethod.New},u={on:!0,off:!1,true:!0,false:!1,1:!0,0:!1};return{file:null!==(i=r.attr("file"))&&void 0!==i?i:"",height:a("height",r.attr("height"),n.CANVAS_HEIGHT),width:a("width",r.attr("width"),n.CANVAS_WIDTH),colorMethod:s("color-method",r.attr("color-method"),c,n.DEFAULT_COLOR_METHOD),shapeMethod:s("shape-method",r.attr("shape-method"),d,n.DEFAULT_SHAPE_METHOD),layoutMethod:s("layout-method",r.attr("layout-method"),h,n.DEFAULT_LAYOUT_METHOD),betaConnectivityVisibility:s("beta-connectivity",r.attr("beta-connectivity"),u,n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY),occurrenceThreshold:function(e,t,o,n=[],i=!1){if(null===t)return o;{let l=parseFloat(t);return i&&t.includes("%")&&(l*=.01),isNaN(l)?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be a float.`),o):n.length>=2&&(l<n[0]||l>n[1])?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be a float between ${n[0]} and ${n[1]}.`),o):l}}("occurrence-threshold",r.attr("occurrence-threshold"),n.DEFAULT_OCCURRENCE_THRESHOLD,[0,1],!0),dispatchEvents:s("dispatch-events",r.attr("dispatch-events"),u,n.DEFAULT_DISPATCH_EVENTS),listenEvents:s("listen-events",r.attr("listen-events"),u,n.DEFAULT_LISTEN_EVENTS)}}}(r||(r={})),function(e){function t(){return{levels:[],edges:[],vertices:[],in_neighbors:new Map}}function o(e,t){let o=[];for(const t of e)for(const e of t)o.push(e);let i=new Set(o),l=[];for(const e of t)i.has(e[0])&&i.has(e[1])&&l.push(e);let r={levels:e,edges:l,vertices:o,in_neighbors:new Map};return n(r),r}function n(e){for(const t of e.vertices)e.in_neighbors.set(t,[]);for(const[t,o]of e.edges)e.in_neighbors.get(o).push(t)}function i(e,t,n){let i=e.levels.slice(t,n),l=[];for(let t=1;t<i.length;t++)for(const o of i[t])for(const t of e.in_neighbors.get(o))l.push([t,o]);let r=o(i,l);for(const[e,t]of r.edges)p(r.vertices.includes(e),e,"not in vertices"),p(r.vertices.includes(t),t,"not in vertices");return r}function l(e,n,c){return a(function(e){const o=function(e,t){const o=function(e){let t=new Map;for(const o of e)t.set(o,o);return t}(e);for(const[e,n]of t)u(o,e,n);return function(e){const t=new Map;for(const o of e.keys()){const n=h(e,o);t.has(n)?t.get(n).push(o):t.set(n,[o])}const o=[...t.values()];for(const e of o)e.sort();return o.sort(),o}(o)}(e.vertices,e.edges),n=o.length,i=new Map;for(let e=0;e<o.length;e++){const t=o[e];for(const o of t)i.set(o,e)}const l=[];for(let e=0;e<n;e++)l.push(t());for(let t=0;t<e.levels.length;t++)for(const o of e.levels[t]){const e=i.get(o),n=l[e].levels;n.length<=t&&n.push([]),p(n.length==t+1,"levs.length != iLevel + 1"),n[t].push(o),l[e].vertices.push(o),l[e].in_neighbors.set(o,[])}for(const t of e.edges){const[e,o]=t,n=i.get(e);p(i.get(o)==n,"vertex2component.get(v) != iComp"),l[n].edges.push(t),l[n].in_neighbors.get(o).push(e)}return l}(e).map(e=>(function(e,t,n){const c=function(e){let t=new Map,n=0,l=[],r=-1;const s=e.levels.length;for(let a=0;a<s;a++){const s=e.levels[a];for(let o=0;o<s.length;o++){const n=s[o],i=new Set(e.in_neighbors.get(n));for(const o of e.in_neighbors.get(n))for(const e of t.get(o))i.add(e);t.set(n,i)}if(1==s.length&&t.get(s[0]).size==n){const c=s[0];a>r+1&&l.push(i(e,r+1,a)),l.push(o([[c]],[])),t.clear(),t.set(c,new Set),r=a,n=1}else n+=s.length}s>r+1&&l.push(i(e,r+1,s));let a=new Set;for(const e of l)for(const t of e.vertices)a.add(t);return p(function(e,t){if(e.size!=t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}(a,new Set(e.vertices)),"checkVertices",a,"!= dag.vertices",e.vertices),l}(e);if(1==c.length)return function(e,t,o,n=1024){const i=function(e,t){let o=1;for(const n of e)for(let e=n.length;e>0;e--)if((o*=e)>t)return t;return o}(e.levels,n+1);if(1==e.vertices.length||i>n)return r(e.levels,t,o=o);{let n=null,i=1/0;const l=e.levels.map(e=>(function e(t,o=!1){if(0==t.length)return[[]];const n=[];let i=t[0];let l=t.slice(1,void 0);for(let o=0;o<t.length;o++){for(const t of e(l,!0))t.push(i),n.push(t);[i,l[o]]=[l[o],i]}if(!o)for(const e of n)e.reverse();return n})(e,!0));for(const s of function e(t,o=0){if(o==t.length)return[[]];const n=[];for(const i of t[o])for(const l of e(t,o+1))l.push(i),n.push(l);if(0==o)for(const e of n)e.reverse();return n}(l)){const l=r(s,t,o),[a,c]=l;let d=0;for(const[t,o]of e.edges)d+=Math.abs(c.get(t).y-c.get(o).y);d<i&&(n=l,i=d)}return p(null!=n,"bestEmbedding is null",n),n}}(c[0],t,n);{const e=c.map(e=>l(e,t,n)),o=a(e,s.HORIZONTAL,n);return o}})(e,n,c)),s.VERTICAL_REARRANGED,c)}function r(e,t,o){const n=[];for(const i of e){const e=[];for(const o of i){const{width:n,height:i}=t.get(o),l={left:n/2,right:n/2,top:i/2,bottom:i/2,weight:n*i},r=new Map([[o,{x:0,y:0}]]);e.push([l,r])}const l=a(e,s.VERTICAL,o);n.push(l)}return a(n,s.HORIZONTAL,o)}let s;function a(e,t,o){const n=e.map(e=>e[0]),i=e.map(e=>e[1]);let l,r;if(t==s.HORIZONTAL)[l,r]=function(e,t){const o=(c(e.map(e=>e.left+e.right))+(e.length-1)*t.x)/2,n=o,i=Math.max(...e.map(e=>e.top)),l=Math.max(...e.map(e=>e.bottom)),r=c(e.map(e=>e.weight));let s=[],a=-o;for(const o of e)a+=o.left,s.push({x:a,y:0}),a+=o.right,a+=t.x;return[{left:o,right:n,top:i,bottom:l,weight:r},s]}(n,o);else if(t==s.VERTICAL)[l,r]=d(n,o);else{if(t!=s.VERTICAL_REARRANGED)throw new Error("direction must be HORIZONTAL or VERTICAL or VERTICAL_REARRANGED");[l,r]=d(n,o,!0)}let a=new Map;for(let t=0;t<e.length;t++)for(const[e,o]of i[t])a.set(e,(h=r[t],u=o,{x:h.x+u.x,y:h.y+u.y}));var h,u;return[l,a]}function c(e){let t=0;for(const o of e)t+=o;return t}function d(e,t,o=!1){e.length;let n=0,i=0,l=0;const r=o?function(e){const t=e.map((e,t)=>[t,e]);t.sort((e,t)=>t[1].weight-e[1].weight);let o=[],n=[];for(let e=0;e<t.length;e++)e%2==0?o.push(t[e]):n.push(t[e]);return n.reverse(),n.push(...o),n}(e):e.map((e,t)=>[t,e]);for(const[e,o]of r)l+=o.top,n+=o.weight,i+=o.weight*l,l+=o.bottom,l+=t.y;const s=n>0?i/n:0,a=[];l=-s;for(const[e,o]of r)l+=o.top,a[e]={x:0,y:l},l+=o.bottom,l+=t.y;const c=s,d=l-t.y;return[{left:Math.max(...e.map(e=>e.left)),right:Math.max(...e.map(e=>e.right)),top:c,bottom:d,weight:n},a]}function h(e,t){const o=e.get(t);if(o==t)return t;{const n=h(e,o);return e.set(t,n),n}}function u(e,t,o){const n=h(e,t),i=h(e,o),l=Math.min(n,i);return e.set(n,l),e.set(i,l),l}function p(e,...t){if(!e)throw console.error("AssertionError:",...t),new Error("AssertionError")}e.newDagEmpty=t,e.newDagFromPath=function(e){let t={levels:e.map(e=>[e]),edges:[],vertices:[...e],in_neighbors:new Map};for(let o=0;o<e.length-1;o++)t.edges.push([e[o],e[o+1]]);return n(t),t},e.newDagFromPrecedence=o,e.embedDag=function(e,t,o={x:0,y:0},n=0,i=0,r=0,s=0){let a,c;return 0==e.vertices.length?(a={left:0,right:0,top:0,bottom:0,weight:0},c=new Map):[a,c]=l(e,t,o),a.left+=n,a.right+=i,a.top+=r,a.bottom+=s,[a,c]},function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL",e[e.VERTICAL_REARRANGED=2]="VERTICAL_REARRANGED"}(s||(s={}))}(s||(s={}));var a,c,d=function(e,t,o,n){return new(o||(o=Promise))(function(i,l){function r(e){try{a(n.next(e))}catch(e){l(e)}}function s(e){try{a(n.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,s)}a((n=n.apply(e,t||[])).next())})};!function(l){function r(e,t=n.ZOOM_STEP_RATIO,o){i.zoomInfoZoomOut(e.zoom,t);let[l,r]=void 0!=o?[o[0]/e.screen.width,o[1]/e.screen.height]:[.5,.5],a=e.screen.width*e.zoom.xZoomout,c=e.screen.height*e.zoom.yZoomout,{x:d,y:h,width:p,height:v}=e.visWorld;e.visWorld.x=d+(p-a)*l,e.visWorld.y=h+(v-c)*r,e.visWorld.width=a,e.visWorld.height=c,E(e),u(e),s(e)}function s(e){e.mainDiv.selectAll("div.button#zoom-out").attr("disabled",e.zoom.zoomout>=e.zoom.maxZoomout?"true":null),e.mainDiv.selectAll("div.button#zoom-in").attr("disabled",e.zoom.zoomout<=e.zoom.minZoomout?"true":null),e.mainDiv.selectAll("div.button#zoom-reset").attr("disabled",e.zoom.zoomout==e.zoom.initialZoomout?"true":null)}function a(t,o){return(o=o||t.mainDiv.select("div.tooltip")).style("left",e.event.clientX+n.TOOLTIP_OFFSET.x).style("top",e.event.clientY+n.TOOLTIP_OFFSET.y)}function c(t,o,n=(t=>e.select(t)),i=null){o.on("mouseenter.point",(e,t,o)=>{let l=n(o[t]);l.attr("pointed","pointed"),null!=i&&i(l)}),o.on("mouseleave.point",(t,o,l)=>{n(l[o]).attr("pointed",null),null!=i&&i(e.selectAll())})}function h(e){return new Promise(t=>setTimeout(t,e))}function u(e,t=!0){let o=t?n.TRANSITION_DURATION:0,l=e.canvas.select("g.nodes").selectAll("g.node").filter(e=>e.active);l.select("rect").transition().duration(o).attrs(t=>i.rectToScreen(e.visWorld,e.screen,t.visual.rect)),l.select("polygon").transition().duration(o).attr("points",t=>i.symCdfPolygonPoints(i.rectToScreen(e.visWorld,e.screen,t.visual.rect),t.cdf)),l.select("text").transition().duration(o).attrs(t=>{let{x:o,y:l,height:r,width:s}=i.rectToScreen(e.visWorld,e.screen,t.visual.rect);return{x:o+s/2,y:l+r+n.HANGING_TEXT_OFFSET}}).style("opacity",t=>p(e,t)?1:0),e.canvas.select("g.edges").selectAll("line").transition().duration(o).attrs(t=>i.lineToScreen(e.visWorld,e.screen,t));n.ARC_MAX_MINOR,e.zoom.yZoomout;let r=e.data;r.beta_connectivity.forEach(e=>e[3]=r.nodes[e[0]].active&&r.nodes[e[1]].active?1:0),e.canvas.select("g.beta-connectivity").selectAll("path").transition().duration(o).attr("d",t=>(function(e,t){if(0==t[3])return"";let[o,l,r]=t,s=e.data.nodes[o].visual.rect,a=e.data.nodes[l].visual.rect,c=i.lineToScreen(e.visWorld,e.screen,{x1:s.x+.5*s.width,y1:s.y+.5*s.height,x2:a.x+.5*a.width,y2:a.y+.5*a.height}),d=e.zoom.yZoomout/e.zoom.xZoomout,h=n.ARC_MAX_MINOR/e.zoom.yZoomout;return i.arcPathD_ellipse(c,e.world.width/e.zoom.xZoomout,h,1==r,d)})(e,t))}function p(e,t){return i.rectToScreen(e.visWorld,e.screen,t.visual.rect).width>=n.MINIMAL_WIDTH_FOR_SSE_LABEL}function v(e,t=0){return e.transition().delay(t).duration(n.TRANSITION_DURATION).style("opacity",0).remove()}function f(e,t=0){if(0==e.size())return e.transition();let o=e.style("opacity");return e.style("opacity",0).transition().delay(t).duration(n.TRANSITION_DURATION).style("opacity",o)}function E(e){let{x:t,y:o,width:l,height:r}=e.world,{x:s,y:a,width:c,height:d}=e.visWorld;c<l*n.MAX_X_ZOOMOUT?e.visWorld.x=i.constrain(s,t-n.MAX_EMPTY_X_MARGIN*c,t+l+n.MAX_EMPTY_X_MARGIN*c-c):e.visWorld.x=t+.5*l-.5*c,d<r*n.MAX_Y_ZOOMOUT?e.visWorld.y=i.constrain(a,o-n.MAX_EMPTY_Y_MARGIN*d,o+r+n.MAX_EMPTY_Y_MARGIN*d-d):e.visWorld.y=o+.5*r-.5*d}l.zoomOut=r,l.zoomIn=function(e,t=n.ZOOM_STEP_RATIO,o){r(e,1/t,o)},l.zoomAll=function(e){i.zoomInfoSetZoomout(e.zoom,e.zoom.initialZoomout),e.visWorld=i.centeredVisWorld(e.world,e.screen,e.zoom),u(e),s(e)},l.zoomSet=function(e,t,o){i.zoomInfoSetZoomout(e.zoom,t);let[n,l]=null!==o&&void 0!==o?o:i.rectangleCenter(e.visWorld),r=e.screen.width*e.zoom.xZoomout,a=e.screen.height*e.zoom.yZoomout;e.visWorld={x:n-.5*r,y:l-.5*a,width:r,height:a},E(e),u(e,!1),s(e)},l.shift=function(e,t,o){let{width:n,height:i}=e.visWorld;e.visWorld.x+=t*n,e.visWorld.y+=o*i,E(e),u(e)},l.shiftByMouse=function(e,t,o){let{width:n,height:i}=e.visWorld,{width:l,height:r}=e.screen;e.visWorld.x+=t*n/l,e.visWorld.y+=o*i/r,E(e),u(e,!1)},l.setTooltips=function(t,o,i,l=!1,r=!1){if(null===i)o.on("mouseenter.tooltip",null).on("mousemove.tooltip",null).on("mouseleave.tooltip",null).on("click.tooltip",null);else{let s=i.map(e=>null!=e),c=i.filter(e=>null!=e);o.filter((e,t)=>s[t]).on("mouseenter.tooltip",(o,i,l)=>(function(t,o,i,l=!1){var r;if("pinned"!=e.select(o).attr("tooltip")){let s=t.mainDiv.append("div").attr("class","tooltip").attr("type","hover").html(i);a(t,s),null===(r=e.select(o))||void 0===r||r.attr("tooltip","hover"),f(s,l?n.TOOLTIP_DELAY:0)}})(t,l[i],c[i],r)).on("mousemove.tooltip",(e,o)=>(function(e){a(e,e.mainDiv.selectAll("div.tooltip[type=hover]"))})(t)).on("mouseleave.tooltip",(e,o)=>(function(e){e.mainDiv.selectAll("div.tooltip[type=hover]").remove(),e.mainDiv.selectAll("[tooltip=hover]").attr("tooltip",null)})(t)),l&&o.filter((e,t)=>s[t]).on("click.tooltip",(o,n,i)=>(function(t,o,n){var i;let l=t.mainDiv.append("div").attr("class","tooltip").attr("type","pre-pinned").html(n);a(t,l),null===(i=e.select(o))||void 0===i||i.attr("tooltip","pre-pinned"),t.mainDiv.on("click.tooltip",()=>{t.mainDiv.selectAll("div.tooltip[type=hover],div.tooltip[type=pinned]").remove(),t.mainDiv.selectAll("div.tooltip[type=pre-pinned]").attr("type","pinned"),t.mainDiv.selectAll("[tooltip=hover],[tooltip=pinned]").attr("tooltip",null),t.mainDiv.selectAll("[tooltip=pre-pinned]").attr("tooltip","pinned")})})(t,i[n],c[n])),o.filter((e,t)=>!s[t]).on("mouseenter.tooltip",null).on("mousemove.tooltip",null).on("mouseleave.tooltip",null).on("click.tooltip",null)}},l.addPointBehavior=c,l.addPickBehavior=function(t,o,n=(t=>e.select(t)),i=null){o.on("click.pick",(e,t,o)=>{n(o[t]).attr("picked","pre-picked")}),t.guiDiv.on("click.pick",()=>{t.guiDiv.selectAll("[picked=picked]").attr("picked",null);let e=t.guiDiv.selectAll("[picked=pre-picked]");e.attr("picked","picked"),null!=i&&i(e)})},l.addMouseHoldBehavior=function(t,o,i,l){t.on("mousedown",()=>d(this,void 0,void 0,function*(){if(1==e.event.which||void 0==e.event.which){let e=Math.random().toString(36).slice(2);for(o(),t.attr("pressed",e),yield h(n.MOUSE_HOLD_BEHAVIOR_INITIAL_SLEEP_TIME);t.attr("pressed")==e;)i(),yield h(n.MOUSE_HOLD_BEHAVIOR_STEP_SLEEP_TIME)}})),t.on("mouseup",()=>d(this,void 0,void 0,function*(){t.attr("pressed",null),l()})),t.on("mouseleave",()=>d(this,void 0,void 0,function*(){t.attr("pressed",null),l()}))},l.recolor=function(i,l=!0){let r=l?n.TRANSITION_DURATION:0;i.canvas.select("g.nodes").selectAll("g.node").selectAll("rect,polygon").transition().duration(r).style("fill",e=>e.visual.fill).style("stroke",e=>e.visual.stroke);let s=i.canvas.select("g.beta-connectivity").selectAll("path");if(i.settings.colorMethod!=o.ColorMethod.Stdev)s.style("stroke",e=>i.data.nodes[e[0]].visual.stroke);else{let e=t.NEUTRAL_DARK.hex();s.style("stroke",e)}!function(o,i,l=!0){var r,s,a,c;if(v(o.canvas.selectAll("g.heatmap-bar")),i){let i=function(o,i,l,r,s,a=""){let c=o.append("g").attr("class","heatmap-bar").attr("transform",`translate(${i.x},${i.y})`),d=(c.append("text").attr("class","heatmap-bar-label").attrs({x:-5,y:.5*i.height}).text(a),Math.floor(i.width)),h=(i.width-1)/d,u=c.append("g").attr("class","heatmap-bar-fill"),p=c.append("g").attr("class","heatmap-bar-stroke");return u.selectAll("rect").data(e.range(d)).enter().append("rect").attrs(e=>({x:e*h,y:0,width:h+1,height:i.height,stroke:"none",fill:t.byExpHeatmap(e/d*l,r).hex()})),p.append("rect").attrs(e=>({x:0,y:0,width:i.width,height:i.height,fill:"none"})),c.append("g").attr("class","heatmap-bar-ticks").selectAll("text").data(e.range(Math.floor(l/s)+1)).enter().append("text").attr("x",e=>e*s/l*i.width).attr("y",i.height+n.HANGING_TEXT_OFFSET).text(e=>e*s),c}(o.canvas,{x:o.screen.width-200-15,y:5,width:200,height:20},15,5,5,"3D variability [Å]"),d=null===(s=null===(r=o.mainDiv.select("div.control-panel#main-panel").node())||void 0===r?void 0:r.getBoundingClientRect())||void 0===s?void 0:s.right,h=null===(c=null===(a=i.node())||void 0===a?void 0:a.getBoundingClientRect())||void 0===c?void 0:c.left;void 0!==d&&void 0!==h&&d>h&&function(e,t,o,i){e.attr("transform",`translate(${t},${o})`);let l=e.select("g.heatmap-bar-ticks").selectAll("text"),r=e.select("g.heatmap-bar-stroke rect").attr("height");i?(l.attr("y",-n.HANGING_TEXT_OFFSET),l.style("dominant-baseline","alphabetic")):(l.attr("y",r+n.HANGING_TEXT_OFFSET),l.style("dominant-baseline","hanging"))}(i,o.screen.width-200-15,o.screen.height-5-20,!0),l&&f(i)}}(i,i.settings.colorMethod==o.ColorMethod.Stdev,l)},l.redraw=u,l.nodeBigEnoughForLabel=p,l.showBetaConnectivity=function(e,t,o=!0){e.settings.betaConnectivityVisibility=t;let n=e.canvas.selectAll("g.beta-connectivity");if(n.size()>0&&!t)o?v(n):n.remove();else if(0==n.size()&&t){let t=e.data;t.beta_connectivity.forEach(e=>e[3]=t.nodes[e[0]].active&&t.nodes[e[1]].active?1:0);let n=e.canvas.append("g").attr("class","beta-connectivity");c(0,n.selectAll().data(t.beta_connectivity).enter().append("path").style("stroke",e=>t.nodes[e[0]].visual.stroke)),u(e,!1),o&&f(n)}},l.fadeOutRemove=v,l.fadeIn=f,l.dispatchSseEvent=function(e,t,o){var i;if(!e.settings.dispatchEvents)return;let l={sourceType:null===(i=e.d3viewer.node())||void 0===i?void 0:i.tagName,sourceId:e.id,sourceInternalId:e.uniqueId,eventType:t,targetType:"sses",sses:o.map(e=>({label:e.label,type:e.type,sheetId:"e"==e.type.toLowerCase()?e.sheet_id:null}))};e.mainDiv.dispatch(n.EVENT_PREFIX+t,{detail:l,bubbles:!0})},l.handleEvent=function(t,o){var i;const l=o.detail;if(null==l||void 0==l)return void console.error(`Event ${o.type}: event.detail must be an object.`);if(l.sourceType==(null===(i=t.d3viewer.node())||void 0===i?void 0:i.tagName)&&l.sourceInternalId==t.uniqueId)return void console.log("Ignoring self",t.uniqueId);const r=l.sses;if(void 0==r)return void console.error(`Event ${o.type}: event.detail.sses must be an array.`);const s=n.EVENT_PREFIX+n.EVENT_TYPE_DO_SELECT,a=n.EVENT_PREFIX+n.EVENT_TYPE_DO_HOVER;let c;switch(o.type){case s:c="picked";break;case a:c="pointed";break;default:return void console.error("Unknown event type for OverProtViewer:",o.type)}t.canvas.selectAll(`g.node[${c}]`).attr(c,null);for(const n of r){if(void 0==n.label)return void console.error(`Event ${o.type}: event.detail.sses[i].label must be a string.`);const i=t.nodeMap.get(n.label);void 0!=i?e.select(i).attr(c,c):console.warn(`Event ${o.type}: SSE with label "${n.label}" is not present.`)}o.type==s&&function(e){e.mainDiv.selectAll("div.tooltip[type=pinned]").remove(),e.mainDiv.selectAll("[tooltip=pinned]").attr("tooltip",null)}(t)}}(a||(a={})),function(t){function o(){return e.selectAll()}function l(e,t,n,i,l,s){let a={base:{viewer:e,id:t,children:[],div:o(),tooltip:s,show:e=>r(a,e)},text:n,square:i,onClick:l};return a}function r(t,o){t.base.div=o.append("div").attr("class",t.square?"button square-button":"button").attr("id",t.base.id),t.base.div.append("div").attr("class","button-text").html(t.text),a.setTooltips(t.base.viewer,t.base.div,[t.base.tooltip],!1,!0),t.base.div.on("click",t.onClick),t.base.div.on("dblclick",()=>{e.event.stopPropagation()})}function s(e,t){e.text=t,e.base.div.select("div.button-text").html(t)}function c(t,i,s,a,c){let d={base:{viewer:t,id:i,children:[],div:o(),tooltip:c,show:e=>(function(e,t){e.base.div=t.append("div").attr("class",e.autocollapse?"popup autocollapse":"popup").attr("id",e.base.id);let o=e.base.div.append("div").attr("class","popup-head");e.base.div.data([e]),r(e.headButton,o)})(d,e)},headButton:l(t,null,s+n.OPEN_POPUP_SYMBOL,!1,()=>(function(t){t.base.div.selectAll("div.popup-tail").size()>0?h(t):(u(t.base.viewer),function(t){var o;let n=t.base.div.select("div.popup-head"),i=t.base.div.append("div").attr("class","popup-tail");t.base.children.forEach(e=>e.base.show(i));let l=n.node().getBoundingClientRect().width,r=null===(o=i.node())||void 0===o?void 0:o.getBoundingClientRect().width;void 0!==r&&void 0!==l&&r<l&&i.style("width",l);t.autocollapse&&(t.base.viewer.mainDiv.on("click.autocollapse-popups",()=>u(t.base.viewer)),i.on("click.autocollapse-popups",()=>e.event.stopPropagation()))}(t),e.event.stopPropagation())})(d),c),autocollapse:a};return d}function d(e,t){e.base.children.push(t)}function h(e){e.base.div.selectAll("div.popup-tail").remove()}function u(e){e.mainDiv.selectAll("div.popup.autocollapse").each(e=>h(e))}function p(e,t){s(e.headButton,t+n.OPEN_POPUP_SYMBOL)}function v(e,t,n,i,l,r){let s={base:{viewer:e,id:t,children:[],div:o(),tooltip:r,show:e=>(function(e,t){e.base.div=t.append("div").attr("class","listbox").attr("id",e.base.id);e.base.div.selectAll().data(e.namesValuesTooltips).enter().append("div").attr("class",t=>t[1]==e.selectedValue?"button listbox-item selected":"button listbox-item").on("click",t=>{e.selectedValue=t[1],e.base.div.selectAll("div.listbox-item").attr("class",t=>t[1]==e.selectedValue?"button listbox-item selected":"button listbox-item"),e.onSelect(t[1])}).append("div").attr("class","button-text").html(e=>e[0]),a.setTooltips(e.base.viewer,e.base.div.selectAll("div.listbox-item"),e.namesValuesTooltips.map(e=>e[2]),!1,!0),a.setTooltips(e.base.viewer,e.base.div,[e.base.tooltip],!1,!0)})(s,e)},namesValuesTooltips:n,selectedValue:i,onSelect:l};return s}function f(e,t,n,i,l,r,s,a,c,d,h){let u={base:{viewer:e,id:t,children:[],div:o(),tooltip:h,show:e=>E(u,e)},minValue:n,maxValue:i,step:l,selectedValue:r,minValueLabel:null!==s&&void 0!==s?s:n.toString(),maxValueLabel:null!==a&&void 0!==a?a:i.toString(),onMove:c,onRelease:d};return u}function E(t,o){t.base.div=o.append("div").attr("class","slider").attr("id",t.base.id);let n=t.base.div.append("div").attr("class","slider-left-value").text(t.minValueLabel),i=t.base.div.append("div").attr("class","slider-right-value").text(t.maxValueLabel),l=t.base.div.append("div").attr("class","slider-main"),r=l.append("div").attr("class","slider-rail-ruler");r.append("div").attr("class","slider-rail");let s=r.append("div").attr("class","slider-rail-clickable"),c=r.append("div").attr("class","slider-handle-ruler"),d=c.append("div").attr("class","slider-handle"),h=g(t,t.selectedValue);c.style("left",100*h+"%"),a.setTooltips(t.base.viewer,l,[t.base.tooltip],!1,!0),a.setTooltips(t.base.viewer,n,["Click/hold to decrease value."],!1,!0),a.setTooltips(t.base.viewer,i,["Click/hold to increase value."],!1,!0);let u=e.drag().on("start.slider",()=>A(t,e.event.sourceEvent)).on("drag.slider",()=>A(t,e.event.sourceEvent)).on("end.slider",()=>(function(e,t){let o=w(e,t);if(null!==o){let t=T(e,o);t=_(e,t),o=g(e,t),e.base.div.select("div.slider-handle-ruler").style("left",100*o+"%"),e.selectedValue=t,e.onRelease(t)}})(t,e.event.sourceEvent));u(s),u(d),a.addMouseHoldBehavior(n,()=>m(t,-1),()=>m(t,-1),()=>{}),a.addMouseHoldBehavior(i,()=>m(t,1),()=>m(t,1),()=>{})}function m(e,t){let o=i.constrain(e.selectedValue+t*e.step,e.minValue,e.maxValue),n=g(e,o);e.base.div.select("div.slider-handle-ruler").style("left",100*n+"%"),e.selectedValue=o,e.onMove(o),e.onRelease(o)}function g(e,t){let o=(t-e.minValue)/(e.maxValue-e.minValue);return o=i.constrain(o,0,1)}function T(e,t){return e.minValue+t*(e.maxValue-e.minValue)}function _(e,t){let o=Math.round((t-e.minValue)/e.step);return e.minValue+o*e.step}function w(e,t){let o=e.base.div.selectAll("div.slider-rail-ruler").node();if(null!==o){let{x:e,width:n}=o.getBoundingClientRect(),l=(t.clientX-e)/n;return l=i.constrain(l,0,1)}return null}function A(e,t){let o=w(e,t);if(null!==o){let t=T(e,o);o=g(e,t=_(e,t)),e.base.div.select("div.slider-handle-ruler").style("left",100*o+"%"),e.onMove(t)}}t.newControlPanel=function(e,t,n){let i={base:{viewer:e,id:t,children:[],div:o(),tooltip:n,show:e=>(function(e,t){e.base.div=t.append("div").attr("class","control-panel").attr("id",e.base.id),e.base.children.forEach(t=>t.base.show(e.base.div))})(i,e)}};return i},t.addToControlPanel=function(e,t){e.base.children.push(t)},t.newButton=l,t.changeButtonText=s,t.newPopup=c,t.addToPopup=d,t.newListbox=v,t.newDropdownList=function(e,t,o,n,i,l,r,s=!0,a=!0){let u=c(e,t,o,s,r),p=v(e,t,n,i,a?e=>{h(u),l(e)}:l,null);return d(u,p),u},t.newSlider=f,t.showSlider=E,t.newPopupSlider=function(e,t,o,n,i,l,r,s,a,h,u,v,E,m=!0){let g=c(e,t,o+s+n,m,E),T=f(e,t,i,l,r,s,a,h,e=>{p(g,o+e+n),u(e)},e=>{p(g,o+e+n),v(e)},null);return d(g,T),g}}(c||(c={}));var h,u=function(e,t,o,n){return new(o||(o=Promise))(function(i,l){function r(e){try{a(n.next(e))}catch(e){l(e)}}function s(e){try{a(n.throw(e))}catch(e){l(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(r,s)}a((n=n.apply(e,t||[])).next())})};!function(d){function h(e,t){e.data=t,l.filterDagAndAddLevels(e.data,e.settings.occurrenceThreshold),p(e)}function p(t){if(t.canvas.selectAll("*").remove(),null!==t.data.error)return void t.canvas.append("text").attr("class","central-message").attrs({x:t.screen.width/2,y:t.screen.height/2}).text("Error: "+t.data.error);if(0==t.data.activeNodes.length)return void t.canvas.append("text").attr("class","central-message").attrs({x:t.screen.width/2,y:t.screen.height/2}).text("No secondary structure elements");let r=t.data,c=t.settings.shapeMethod==o.ShapeMethod.SymCdf?r.nodes.map(e=>e.cdf[e.cdf.length-1][0]*n.LENGTH_SCALE):r.nodes.map(e=>e.avg_length*n.LENGTH_SCALE),d=r.nodes.map(e=>e.occurrence*n.OCCURRENCE_SCALE);if(t.settings.layoutMethod==o.LayoutMethod.Old){let e=r.nodes.length,o=r.levels.length,i=new Array(e),s=new Array(e),a=new Array(e).fill(0),h=0;for(let e=0;e<o;e++){const t=r.levels[e];let o=t.length;for(let e=0;e<o;e++){const n=t[e];i[n]=h,s[n]=h+c[n],a[n]=e-(o-1)/2}h=Math.max(...t.map(e=>s[e]))+n.GAP_LENGTH}for(let e=0;e<r.nodes.length;e++)r.nodes[e].visual=l.newNodeVisual(),r.nodes[e].active?r.nodes[e].visual.rect={x:i[e],width:c[e],y:a[e]*n.FLOOR_HEIGHT-d[e]/2,height:d[e]}:r.nodes[e].visual.rect={x:-n.LEFT_MARGIN,width:0,y:0,height:0};let u=h-n.GAP_LENGTH,p=Math.min(...a),v=Math.max(...a),f=-n.LEFT_MARGIN,E=u+n.RIGHT_MARGIN,m=p*n.FLOOR_HEIGHT-.5*n.OCCURRENCE_SCALE-n.TOP_MARGIN,g=v*n.FLOOR_HEIGHT+.5*n.OCCURRENCE_SCALE+n.BOTTOM_MARGIN;t.world={x:f,y:m,width:E-f,height:g-m}}else if(t.settings.layoutMethod==o.LayoutMethod.New){let e=s.newDagFromPrecedence(r.levels,r.precedence),o=new Map;for(const t of e.vertices)o.set(t,{width:c[t],height:d[t]});const[i,a]=s.embedDag(e,o,{x:n.GAP_LENGTH,y:n.FLOOR_HEIGHT-n.OCCURRENCE_SCALE},n.LEFT_MARGIN,n.RIGHT_MARGIN,n.TOP_MARGIN,n.BOTTOM_MARGIN);t.world={x:-i.left,y:-i.top,width:i.right+i.left,height:i.bottom+i.top};for(let e=0;e<r.nodes.length;e++)if(r.nodes[e].visual=l.newNodeVisual(),r.nodes[e].active){const{x:t,y:n}=a.get(e),{width:i,height:l}=o.get(e);r.nodes[e].visual.rect={x:t-i/2,y:n-l/2,width:i,height:l}}else r.nodes[e].visual.rect={x:t.world.x,y:t.world.y,width:0,height:0}}let h=i.zoomAllZoomout(t.world,t.screen),u=(n.OCCURRENCE_SCALE+n.TOP_MARGIN+n.BOTTOM_MARGIN)/t.screen.height,p=t.world.height/t.screen.height,E=u/10,m=h*n.MAX_X_ZOOMOUT;t.zoom=i.newZoomInfo(E,m,u,p,h),t.visWorld=i.centeredVisWorld(t.world,t.screen,t.zoom),r.precedenceLines=[];for(const e of r.precedence){let t=r.nodes[e[0]].visual.rect,o=r.nodes[e[1]].visual.rect,i=t.x+t.width,l=t.y+t.height/2,s=o.x,a=o.y+o.height/2;r.precedenceLines.push({x1:i,y1:l,x2:i+n.KNOB_LENGTH,y2:l}),r.precedenceLines.push({x1:i+n.KNOB_LENGTH,y1:l,x2:s-n.KNOB_LENGTH,y2:a}),r.precedenceLines.push({x1:s-n.KNOB_LENGTH,y1:a,x2:s,y2:a})}let g,T=new Map,_=t.canvas.append("g").attr("class","nodes").selectAll("g.node").data(r.nodes).enter().append("g").attr("class","node").attr("opacity",e=>e.active?1:0).each((e,t,o)=>T.set(e.label,o[t]));t.nodeMap=T,console.log("viewer.nodeMap:",t.nodeMap);(g=t.settings.shapeMethod==o.ShapeMethod.SymCdf?_.append("polygon"):_.append("rect")).filter(e=>e.active);a.addPointBehavior(t,g,t=>e.select(t.parentElement),e=>a.dispatchSseEvent(t,n.EVENT_TYPE_HOVER,e.data())),a.addPickBehavior(t,g,t=>e.select(t.parentElement),e=>a.dispatchSseEvent(t,n.EVENT_TYPE_SELECT,e.data())),a.setTooltips(t,g,_.data().map(v),!0,!1),_.append("text").attr("class","node-label").style("opacity",e=>a.nodeBigEnoughForLabel(t,e)?1:0).text(e=>e.label),t.canvas.append("g").attr("class","edges").selectAll().data(r.precedenceLines).enter().append("line").attr("stroke",n.EDGE_COLOR),a.showBetaConnectivity(t,t.settings.betaConnectivityVisibility,!1),f(t,t.settings.colorMethod,!1),a.zoomAll(t),a.redraw(t,!1)}function v(e){if(e.active){let[t,o]=l.getNodeMinMaxLength(e);return['<div class="node-tooltip">',`<span class="tooltip-title">${e.label}</span>`,"<table>",`<tr><td>Type:</td><td>${"e"==e.type?"Strand":"Helix"}</td></tr>`,`<tr><td>Occurrence:</td><td>${i.round(100*e.occurrence,1)}%</td></tr>`,`<tr><td>Min. length:</td><td>${t} residues</td></tr>`,`<tr><td>Avg. length:</td><td>${i.round(e.avg_length,2)} residues</td></tr>`,`<tr><td>Max. length:</td><td>${o} residues</td></tr>`,`<tr><td>3D variability:</td><td>${i.round(e.stdev3d,2)} &#8491;</td></tr>`,"e"==e.type?`<tr><td>Sheet:</td><td>${e.sheet_id}</td></tr>`:"","</table>","</div>"].join("")}return null}function f(e,i,l=!0){e.settings.colorMethod=i,e.data.nodes.forEach((e,l)=>{let r;switch(i){case o.ColorMethod.Uniform:r=t.NEUTRAL_COLOR;break;case o.ColorMethod.Type:r=t.bySseType(e.type);break;case o.ColorMethod.Sheet:r=t.byIndex1(e.sheet_id);break;case o.ColorMethod.Stdev:r=t.byExpHeatmap(e.stdev3d,n.HEATMAP_MIDDLE_VALUE)}e.visual.fill=r.hex(),e.visual.stroke=r.darker().hex()}),a.recolor(e,l)}d.initializeViewer=function(t){var s;let d=r.newSettingsFromHTMLElement(t);const v=t.id||"",E=`${v}-${Math.random().toString(36).slice(2)}`;console.log(`Initializing OverProt viewer with id="${v}", file="${d.file}"`,d);const m=e.select(t);m.selectAll(":scope > *").remove();let g=m.append("div").attr("class","overprot-viewer").attr("id","overprot-viewer-"+E),T=g.append("div").attr("class","gui").styles({width:d.width,height:d.height}),_=null===(s=T.node())||void 0===s?void 0:s.getBoundingClientRect();if(void 0!==_){let{width:e,height:t}=_;d.width=e,d.height=t}let w=T.append("div").attr("class","canvas").append("svg").attr("class","canvas").attrs({width:d.width,height:d.height}),A=r.newViewer(v,E,m,g,T,w,d);if(function(e){let t=e.guiDiv.append("div").attr("class","internal-controls"),i=[["Uniform",o.ColorMethod.Uniform,"Show all SSEs in the same color."],["Type",o.ColorMethod.Type,"Show &beta;-strands in blue, helices in gray."],["Sheet",o.ColorMethod.Sheet,"Assign the same color to &beta;-strands from the same &beta;-sheet, <br>show helices in gray."],["Variability",o.ColorMethod.Stdev,"<strong>3D variability</strong> measures the standard deviation of the SSE end point coordinates.<br>Low values (dark) indicate conserved SSE position, <br>high values (bright) indicate variable SSE position."]],r=[["Rectangle",o.ShapeMethod.Rectangle,"Show SSEs as rectangles. <br>Height of the rectangle indicates <strong>occurrence</strong> (what percentage of structures contain this SSE), <br>width indicates <strong>average length</strong> (number of residues)."],["SymCDF",o.ShapeMethod.SymCdf,"<strong>Cumulative distribution function</strong> describes the statistical distribution of the SSE length. <br>The widest part of the shape corresponds to maximum length, the narrowest to minimum length, <br> the height corresponds to occurrence. <br>(The SymCDF shape consists of four symmetrical copies of the CDF, the bottom right quarter is the classical CDF.)"]],s=c.newControlPanel(e,"main-panel",null),d=c.newButton(e,"zoom-in","+",!0,()=>a.zoomIn(e),"Zoom in. <br>Tip: Use Ctrl + mouse wheel to zoom.");c.addToControlPanel(s,d);let u=c.newButton(e,"zoom-out","-",!0,()=>a.zoomOut(e),"Zoom out. <br>Tip: Use Ctrl + mouse wheel to zoom.");c.addToControlPanel(s,u);let v=c.newButton(e,"zoom-reset",n.RESET_SYMBOL,!0,()=>a.zoomAll(e),"Reset zoom. <br>Tip: Use double click to reset zoom.");c.addToControlPanel(s,v);let E=c.newDropdownList(e,"color-method","Color",i,e.settings.colorMethod,t=>f(e,t),"Choose coloring method.",!0,!1);c.addToControlPanel(s,E);let m=c.newDropdownList(e,"shape-method","Shape",r,e.settings.shapeMethod,t=>(function(e,t){e.settings.shapeMethod=t,h(e,e.data)})(e,t),"Choose shape method.",!0,!1);c.addToControlPanel(s,m);let g=c.newDropdownList(e,"beta-connectivity","Beta-connectivity",[["On",!0,null],["Off",!1,null]],e.settings.betaConnectivityVisibility,t=>a.showBetaConnectivity(e,t,!0),"<strong>Beta-connectivity</strong> shows how &beta;-strands are connected to each other in &beta;-sheets.<br>Upper arcs indicate antiparallel connections,<br>lower arcs indicate parallel connections.",!0,!1);c.addToControlPanel(s,g);let T=c.newPopupSlider(e,"occurrence-threshold","Occurrence threshold: ","%",0,100,1,100*e.settings.occurrenceThreshold,"0%","100%",e=>{},t=>(function(e,t){e.settings.occurrenceThreshold=t,l.filterDagAndAddLevels(e.data,t),p(e)})(e,t/100),"Hide SSEs with occurrence lower than the specified threshold.");c.addToControlPanel(s,T),s.base.show(t)}(A),g.append("br"),w.on("dblclick",()=>a.zoomAll(A)),w.on("wheel",()=>{if(e.event.ctrlKey){let t=e.event.deltaY>0?n.ZOOM_STEP_RATIO_MOUSE:1/n.ZOOM_STEP_RATIO_MOUSE;a.zoomOut(A,t,e.mouse(w.node())),e.event.preventDefault()}else{let e=A.canvas.selectAll("text.temporary-central-message").data([1]).enter().append("rect").attr("class","temporary-central-message-background").attrs({x:0,width:A.screen.width,y:0,height:A.screen.height}),t=A.canvas.selectAll("text.temporary-central-message").data([1]).enter().append("text").attr("class","temporary-central-message").attrs({x:A.screen.width/2,y:A.screen.height/2}).text("Use Ctrl + scroll to zoom");a.fadeIn(e),a.fadeIn(t),a.fadeOutRemove(e,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT),a.fadeOutRemove(t,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT)}}),e.drag().on("drag",()=>a.shiftByMouse(A,-e.event.dx,-e.event.dy))(w),e.select(window).on("resize."+E,()=>{let e=T.node().getBoundingClientRect();!function(e,t,o){let n=e.zoom.zoomout!=e.zoom.initialZoomout,l=e.zoom.zoomout,r=e.visWorld,s=l*e.screen.width/t;e.canvas.attr("width",t).attr("height",o),e.screen.width=t,e.screen.height=o,p(e),n&&a.zoomSet(e,s,i.rectangleCenter(r))}(A,e.width,e.height)}),d.listenEvents&&(t.addEventListener(n.EVENT_PREFIX+n.EVENT_TYPE_DO_SELECT,e=>a.handleEvent(A,e)),t.addEventListener(n.EVENT_PREFIX+n.EVENT_TYPE_DO_HOVER,e=>a.handleEvent(A,e))),A.canvas.append("text").attr("class","central-message").attrs({x:A.screen.width/2,y:A.screen.height/2}).text("Loading..."),""!=d.file){let e=new URL(d.file,document.baseURI).toString();fetch(e).catch(t=>u(this,void 0,void 0,function*(){console.error(`OverProt Viewer with id="${A.id}" failed to initialize because the request for`,e,"failed (this might be caused by CORS policy). Original error:",t);let o=l.newDagWithError(`Failed to fetch data from "${e}"`);h(A,o)})).then(t=>u(this,void 0,void 0,function*(){if(t&&t.ok){let e=yield t.text(),o=l.dagFromJson(e);h(A,o)}else if(t&&!t.ok){console.error(`OverProt Viewer with id="${A.id}" failed to initialize because the request for`,e,"returned status code",t.status,t.statusText);let o=l.newDagWithError(`Failed to fetch data from "${e}"`);h(A,o)}})).catch(e=>u(this,void 0,void 0,function*(){console.error(`OverProt Viewer with id="${A.id}" failed to initialize because of internal error.`);let t=l.newDagWithError("Internal error");throw h(A,t),e}))}else{let e=l.newDagWithError("No file specified");h(A,e)}}}(h||(h={})),function(e){window.customElements.define("overprot-viewer",class extends HTMLElement{constructor(){super()}connectedCallback(){this.initialize()}initialize(){return h.initializeViewer(this)}})}()}(d3);
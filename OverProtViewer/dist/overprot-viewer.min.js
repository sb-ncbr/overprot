!function(e){"use strict";var t,o,n,i,r,l,a;!function(t){var o;o=function(){let t=e.schemeCategory10.map(t=>e.rgb(t));return{neutral:t.splice(7,1)[0],scheme:t}}(),t.NEUTRAL_COLOR=o.neutral,t.COLOR_SCHEME=o.scheme,t.NEUTRAL_DARK=e.rgb(0,0,0),t.bySseType=function(e){return"h"==(e=e.toLowerCase())?t.NEUTRAL_COLOR:"e"==e?t.COLOR_SCHEME[0]:t.COLOR_SCHEME[1]},t.byIndex0=function(e){return t.COLOR_SCHEME[e%t.COLOR_SCHEME.length]},t.byIndex1=function(e){return e>=1?t.COLOR_SCHEME[(e-1)%t.COLOR_SCHEME.length]:t.NEUTRAL_COLOR},t.byLinHeatmap=function(t,o){const n=t/o;return e.rgb(e.interpolateInferno(n))},t.byExpHeatmap=function(t,o){const n=1-Math.pow(2,-t/o);return e.rgb(e.interpolateInferno(n))}}(t||(t={})),function(e){let t,o,n;!function(e){e[e.Uniform=0]="Uniform",e[e.Type=1]="Type",e[e.Sheet=2]="Sheet",e[e.Stdev=3]="Stdev"}(t=e.ColorMethod||(e.ColorMethod={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.SymCdf=1]="SymCdf"}(o=e.ShapeMethod||(e.ShapeMethod={})),function(e){e[e.Old=0]="Old",e[e.New=1]="New"}(n=e.LayoutMethod||(e.LayoutMethod={}))}(o||(o={})),function(n){n.CANVAS_HEIGHT=300,n.CANVAS_WIDTH=1500,n.ZOOM_STEP_RATIO=1.25,n.ZOOM_STEP_RATIO_MOUSE=n.ZOOM_STEP_RATIO,n.SHIFT_STEP_RELATIVE=.2,n.MAX_EMPTY_X_MARGIN=0,n.MAX_EMPTY_Y_MARGIN=0,n.MAX_X_ZOOMOUT=1/(1-2*n.MAX_EMPTY_X_MARGIN),n.MAX_Y_ZOOMOUT=1/(1-2*n.MAX_EMPTY_Y_MARGIN),n.TRANSITION_DURATION=e.transition().duration(),n.TOOLTIP_DELAY=600,n.MOUSE_HOLD_BEHAVIOR_INITIAL_SLEEP_TIME=500,n.MOUSE_HOLD_BEHAVIOR_STEP_SLEEP_TIME=50,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT=1e3,n.TOOLTIP_OFFSET={x:12,y:0},n.NODE_STROKE_WIDTH=1,n.NODE_STROKE_WIDTH_HIGHLIGHTED=3,n.EDGE_COLOR="#808080",n.NODE_FILL=t.NEUTRAL_COLOR,n.NODE_STROKE=t.NEUTRAL_COLOR.darker(),n.MINIMAL_WIDTH_FOR_SSE_LABEL=20,n.HEATMAP_MIDDLE_VALUE=5,n.DEFAULT_OCCURRENCE_THRESHOLD=.2,n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY=!0,n.DEFAULT_LAYOUT_METHOD=o.LayoutMethod.New,n.DEFAULT_COLOR_METHOD=o.ColorMethod.Sheet,n.DEFAULT_SHAPE_METHOD=o.ShapeMethod.Rectangle,n.LENGTH_SCALE=4,n.OCCURRENCE_SCALE=100,n.FLOOR_HEIGHT=1.25*n.OCCURRENCE_SCALE,n.TOP_MARGIN=.25*n.OCCURRENCE_SCALE,n.BOTTOM_MARGIN=.25*n.OCCURRENCE_SCALE,n.LEFT_MARGIN=4*n.LENGTH_SCALE,n.RIGHT_MARGIN=4*n.LENGTH_SCALE,n.GAP_LENGTH=3*n.LENGTH_SCALE,n.KNOB_LENGTH=1*n.LENGTH_SCALE,n.ARC_MAX_DEVIATION=.5*n.OCCURRENCE_SCALE+Math.min(n.TOP_MARGIN,n.BOTTOM_MARGIN),n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH=.001,n.ARC_MAX_MINOR=n.ARC_MAX_DEVIATION/(1-Math.sqrt(1-Math.pow(1/(1+2*n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH),2))),n.ARC_SMART_DEVIATION_PARAM_WRT_WORLD_WIDTH=.2,n.HELIX_TYPE="h",n.STRAND_TYPE="e",n.HANGING_TEXT_OFFSET=5,n.RESET_SYMBOL="&#x27F3;",n.OPEN_POPUP_SYMBOL=" &#x25BE;"}(n||(n={})),function(e){function t(e){return[e.x+.5*e.width,e.y+.5*e.height]}function o(e,t){e.zoomout=i(t,e.minZoomout,e.maxZoomout),e.xZoomout=i(e.zoomout,e.minXZoomout,e.maxXZoomout),e.yZoomout=i(e.zoomout,e.minYZoomout,e.maxYZoomout)}function i(e,t,o){return Math.min(Math.max(e,t),o)}function r(e,t=0){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}e.newRectangle=function(){return{x:-1,y:-1,width:2,height:2}},e.rectangleFromCanvas=function(e){return{x:0,y:0,width:+e.style("width").replace("px",""),height:+e.style("height").replace("px","")}},e.rectangleCenter=t,e.newZoomInfo=function(e,t,o,n,r){e>t&&console.warn("newZoomInfo(): minXZoomout > maxXZoomout"),o>n&&console.warn("newZoomInfo(): minYZoomout > maxYZoomout");let l=Math.min(e,o),a=Math.max(t,n),s=i(r,l,t);return{zoomout:s,xZoomout:i(s,e,t),yZoomout:i(s,o,n),minZoomout:l,maxZoomout:a,minXZoomout:e,maxXZoomout:t,minYZoomout:o,maxYZoomout:n,initialZoomout:r}},e.zoomInfoZoomOut=function(e,t){o(e,e.zoomout*t)},e.zoomInfoSetZoomout=o,e.zoomAllZoomout=function(e,t){return Math.max(e.width/t.width,e.height/t.height)},e.centeredVisWorld=function(e,o,n){let i=o.width*n.xZoomout,r=o.height*n.yZoomout,[l,a]=t(e);return{x:l-.5*i,y:a-.5*r,width:i,height:r}},e.constrain=i,e.arcPathD_circle=function(e,t,o,n,i=1){if(0==t)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:r,y1:l,x2:a,y2:s}=e,c=a-r,d=s-l,h=Math.abs(c),u=t*h/(h+o),p=u/2+(Math.pow(c/i,2)+Math.pow(d,2))/(8*u);return`M${a},${s} A${p*i},${p} 0 0,${n?1:0} ${r},${l}`}},e.arcPathD_ellipse=function(e,t,o,i,r=1){if(0==o)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:l,y1:a,x2:s,y2:c}=e,d=c-a,h=s-l,u=h/r,p=Math.sqrt(Math.pow(u,2)+Math.pow(d,2))/2+n.ARC_EXTRA_MAJOR_WRT_WORLD_WIDTH*t/r,f=Math.min(o*Math.sqrt(Math.abs(h)/t),p),v=Math.atan(d/u),[g,m,E]=function(e,t,o,n){const{cos:i,sin:r,sqrt:l,atan:a}=Math;if(1==n)return[e,t,o];if(0==o||0==r(2*o))return[n*e,t,o];if(e==t)return[n*e,t,0];const s=Math.pow(n,2)*Math.pow(e,2)*Math.pow(i(o),2)+Math.pow(e,2)*Math.pow(r(o),2),c=2*(1-Math.pow(n,2))*e*t*i(o)*r(o),d=Math.pow(n,2)*Math.pow(t,2)*Math.pow(r(o),2)+Math.pow(t,2)*Math.pow(i(o),2),h=c,u=2*(s-d),p=-c,f=Math.pow(u,2)-4*h*p;let v=(-u+l(f))/(2*h),g=(-u-l(f))/(2*h),m=l((s+c*v+d*Math.pow(v,2))/(1+Math.pow(v,2))),E=l((s+c*g+d*Math.pow(g,2))/(1+Math.pow(g,2)));m<E&&([v,g]=[g,v],[m,E]=[E,m]);const w=1/(1+Math.pow(v,2)),_=1-w,T=v/(1+Math.pow(v,2)),A=Math.pow(e,2)*i(o)*r(o)*w+e*t*T+Math.pow(t,2)*i(o)*r(o)*_,M=n*(Math.pow(e,2)*Math.pow(i(o),2)*w-Math.pow(t,2)*Math.pow(r(o),2)*_);let y=a(A/M);return[m,E,y]}(p,f,v,r);return`M${s},${c} A${g},${m} ${E*=180/Math.PI} 0,${i?1:0} ${l},${a}`}},e.arcPathD_bezier=function(e,t,o,n,i=1){if(0==t)return`M${e.x1},${e.y1} L${e.x2},${e.y2}`;{let{x1:i,y1:r,x2:l,y2:a}=e,s=l-i,c=Math.abs(s),d=t*c/(c+o)*(n?-1:1);const h=.05*s,u=1.32;return`M${i},${r} C${i+h},${r-d*u} ${l-h},${a-d*u} ${l},${a}`}},e.symCdfPolygonPoints=function(e,o){let[n,i]=t(e),l=o[o.length-1][0],a=o[0][0]>0?1:1-o[0][1],s=.5*e.width/l,c=.5*e.height/a,d=[];o[0][0]>0&&(d.push([0,c]),d.push([o[0][0]*s,c])),d.push([o[0][0]*s,(1-o[0][1])*c]);for(let e=1;e<o.length;e++)d.push([o[e][0]*s,(1-o[e-1][1])*c]),d.push([o[e][0]*s,(1-o[e][1])*c]);let h=[];for(let e=0;e<d.length-1;e++)h.push([n+d[e][0],i+d[e][1]]);for(let e=d.length-1;e>0;e--)h.push([n+d[e][0],i-d[e][1]]);for(let e=0;e<d.length-1;e++)h.push([n-d[e][0],i-d[e][1]]);for(let e=d.length-1;e>0;e--)h.push([n-d[e][0],i+d[e][1]]);return h.map(e=>r(e[0],1)+","+r(e[1],1)).join(" ")},e.rectToScreen=function(e,t,o){let{x:n,y:i,width:r,height:l}=o;return{x:(n-e.x)/e.width*t.width+t.x,y:(i-e.y)/e.height*t.height+t.y,width:r/e.width*t.width,height:l/e.height*t.height}},e.lineToScreen=function(e,t,o){let{x1:n,y1:i,x2:r,y2:l}=o;return{x1:(n-e.x)/e.width*t.width+t.x,y1:(i-e.y)/e.height*t.height+t.y,x2:(r-e.x)/e.width*t.width+t.x,y2:(l-e.y)/e.height*t.height+t.y}},e.round=r}(i||(i={})),function(t){function o(){return{nodes:[],precedence:[],beta_connectivity:[],levels:[],precedenceLines:[],activeNodes:[],origPrecedence:[],origBetaConnectivity:[],error:null}}function r(e){let t={nodes:[],precedence:[],beta_connectivity:[],levels:[],precedenceLines:[],activeNodes:[],origPrecedence:[],origBetaConnectivity:[],error:null};return t.error=e,t}function l(e,t,o,n){let i=o[e].filter(e=>e!=t);for(;i.length>0;){let e=i.pop();if(-1!=n[e]&&n[e]<n[t])i.push(...o[e]);else if(e==t)return!0}return!1}function a(e,t){let o=new Array(e),n=new Array(e);for(let t=0;t<e;t++)o[t]=[],n[t]=[];return t.forEach(e=>{o[e[1]].push(e[0]),n[e[0]].push(e[1])}),{ins:o,outs:n}}t.newDag=o,t.dagFromJson=function(t){var o;let n=null;try{let i=JSON.parse(t);return n=i.error=null!==(o=i.error)&&void 0!==o?o:null,i.nodes.forEach(e=>e.active=!0),i.levels=[],i.precedenceLines=[],i.activeNodes=e.range(i.nodes.length),i.origPrecedence=i.precedence,i.origBetaConnectivity=i.beta_connectivity,i}catch(e){return n=null!==n&&void 0!==n?n:"Failed to parse input file.",console.warn(n,"\n",e,"\n",t),r(n)}},t.newDagWithError=r,t.newNodeVisual=function(){return{rect:i.newRectangle(),fill:n.NODE_FILL.hex(),stroke:n.NODE_STROKE.hex()}},t.filterDagAndAddLevels=function(t,o){let n=t.nodes.length;for(let e of t.nodes)e.active=e.occurrence>=o&&e.avg_length>0;let i=e.range(n).filter(e=>t.nodes[e].active),{ins:r,outs:s}=a(n,t.origPrecedence);for(let e=0;e<n;e++)if(!t.nodes[e].active)for(let t of r[e])for(let o of s[e])s[t].includes(o)||(s[t].push(o),r[o].push(t));t.activeNodes=i,t.precedence=[];for(let e of i)for(let o of s[e])t.nodes[o].active&&t.precedence.push([e,o]);!function(e){let t=[],o=new Set(e.activeNodes),n=e.precedence;for(;o.size>0;){let e=new Set(o);n.forEach(t=>e.delete(t[1])),n=n.filter(t=>!e.has(t[0])),e.forEach(e=>o.delete(e)),t.push(Array.from(e))}e.levels=t}(t),function(e){let t=e.nodes.length,o=new Array(t).fill(-1);e.levels.forEach((e,t)=>e.forEach(e=>o[e]=t));let n=[],{outs:i}=a(t,e.precedence);for(let t=0;t<e.levels.length;t++){const r=e.levels[t];r.forEach(e=>{i[e].forEach(r=>{o[r]!=t+1&&l(e,r,i,o)||n.push([e,r])})})}e.precedence=n}(t)},t.getNodeMinMaxLength=function(e){let t=e.cdf.map(e=>e[0]).filter(e=>e>0);return 0==t.length?[0,0]:[t[0],t[t.length-1]]}}(r||(r={})),function(t){function l(){return{file:"",width:n.CANVAS_WIDTH,height:n.CANVAS_HEIGHT,colorMethod:n.DEFAULT_COLOR_METHOD,shapeMethod:n.DEFAULT_SHAPE_METHOD,layoutMethod:n.DEFAULT_LAYOUT_METHOD,betaConnectivityVisibility:n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY,occurrenceThreshold:n.DEFAULT_OCCURRENCE_THRESHOLD}}function a(e,t,o,n){return null===t?n:void 0!==o[t]?o[t]:(console.warn(`Attribute "${e}" has invalid value "${t}". Allowed values: ${Object.keys(o)}.`),n)}function s(e,t,o,n=[]){if(null===t)return o;{let i=parseInt(t);return isNaN(i)?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be an integer.`),o):n.length>=2&&(i<n[0]||i>n[1])?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be an integer between ${n[0]} and ${n[1]}.`),o):i}}t.newViewer=function(e,t,o,n,a,s=null){return{id:e,uniqueId:t,mainDiv:o,guiDiv:n,canvas:a,data:r.newDag(),world:i.newRectangle(),visWorld:i.newRectangle(),screen:i.rectangleFromCanvas(a),zoom:i.newZoomInfo(1,1,1,1,1),settings:null!==s&&void 0!==s?s:l()}},t.newSettings=l,t.newSettingsFromHTMLElement=function(t){var i;let r=["id","file","width","height","color-method","shape-method","layout-method","beta-connectivity","occurrence-threshold"];["file"].forEach(e=>{t.hasAttribute(e)||console.error(`Missing attribute: "${e}".`)});for(let e=0;e<t.attributes.length;e++){let o=t.attributes.item(e).name;r.includes(o)||console.warn(`Unknown attribute: "${o}"`)}let l=e.select(t),c={uniform:o.ColorMethod.Uniform,type:o.ColorMethod.Type,sheet:o.ColorMethod.Sheet,variability:o.ColorMethod.Stdev},d={rectangle:o.ShapeMethod.Rectangle,symcdf:o.ShapeMethod.SymCdf},h={old:o.LayoutMethod.Old,new:o.LayoutMethod.New};return{file:null!==(i=l.attr("file"))&&void 0!==i?i:"",height:s("height",l.attr("height"),n.CANVAS_HEIGHT),width:s("width",l.attr("width"),n.CANVAS_WIDTH),colorMethod:a("color-method",l.attr("color-method"),c,n.DEFAULT_COLOR_METHOD),shapeMethod:a("shape-method",l.attr("shape-method"),d,n.DEFAULT_SHAPE_METHOD),layoutMethod:a("layout-method",l.attr("layout-method"),h,n.DEFAULT_LAYOUT_METHOD),betaConnectivityVisibility:a("beta-connectivity",l.attr("beta-connectivity"),{on:!0,off:!1},n.DEFAULT_BETA_CONNECTIVITY_VISIBILITY),occurrenceThreshold:function(e,t,o,n=[],i=!1){if(null===t)return o;{let r=parseFloat(t);return i&&t.includes("%")&&(r*=.01),isNaN(r)?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be a float.`),o):n.length>=2&&(r<n[0]||r>n[1])?(console.warn(`Attribute "${e}" has invalid value "${t}". Value must be a float between ${n[0]} and ${n[1]}.`),o):r}}("occurrence-threshold",l.attr("occurrence-threshold"),n.DEFAULT_OCCURRENCE_THRESHOLD,[0,1],!0)}}}(l||(l={})),function(e){function t(){return{levels:[],edges:[],vertices:[],in_neighbors:new Map}}function o(e,t){let o=[];for(const t of e)for(const e of t)o.push(e);let i=new Set(o),r=[];for(const e of t)i.has(e[0])&&i.has(e[1])&&r.push(e);let l={levels:e,edges:r,vertices:o,in_neighbors:new Map};return n(l),l}function n(e){for(const t of e.vertices)e.in_neighbors.set(t,[]);for(const[t,o]of e.edges)e.in_neighbors.get(o).push(t)}function i(e,t,n){let i=e.levels.slice(t,n),r=[];for(let t=1;t<i.length;t++)for(const o of i[t])for(const t of e.in_neighbors.get(o))r.push([t,o]);let l=o(i,r);for(const[e,t]of l.edges)p(l.vertices.includes(e),e,"not in vertices"),p(l.vertices.includes(t),t,"not in vertices");return l}function r(e,n,c){return s(function(e){const o=function(e,t){const o=function(e){let t=new Map;for(const o of e)t.set(o,o);return t}(e);for(const[e,n]of t)u(o,e,n);return function(e){const t=new Map;for(const o of e.keys()){const n=h(e,o);t.has(n)?t.get(n).push(o):t.set(n,[o])}const o=[...t.values()];for(const e of o)e.sort();return o.sort(),o}(o)}(e.vertices,e.edges),n=o.length,i=new Map;for(let e=0;e<o.length;e++){const t=o[e];for(const o of t)i.set(o,e)}const r=[];for(let e=0;e<n;e++)r.push(t());for(let t=0;t<e.levels.length;t++)for(const o of e.levels[t]){const e=i.get(o),n=r[e].levels;n.length<=t&&n.push([]),p(n.length==t+1,"levs.length != iLevel + 1"),n[t].push(o),r[e].vertices.push(o),r[e].in_neighbors.set(o,[])}for(const t of e.edges){const[e,o]=t,n=i.get(e);p(i.get(o)==n,"vertex2component.get(v) != iComp"),r[n].edges.push(t),r[n].in_neighbors.get(o).push(e)}return r}(e).map(e=>(function(e,t,n){const c=function(e){let t=new Map,n=0,r=[],l=-1;const a=e.levels.length;for(let s=0;s<a;s++){const a=e.levels[s];for(let o=0;o<a.length;o++){const n=a[o],i=new Set(e.in_neighbors.get(n));for(const o of e.in_neighbors.get(n))for(const e of t.get(o))i.add(e);t.set(n,i)}if(1==a.length&&t.get(a[0]).size==n){const c=a[0];s>l+1&&r.push(i(e,l+1,s)),r.push(o([[c]],[])),t.clear(),t.set(c,new Set),l=s,n=1}else n+=a.length}a>l+1&&r.push(i(e,l+1,a));let s=new Set;for(const e of r)for(const t of e.vertices)s.add(t);return p(function(e,t){if(e.size!=t.size)return!1;for(const o of e)if(!t.has(o))return!1;return!0}(s,new Set(e.vertices)),"checkVertices",s,"!= dag.vertices",e.vertices),r}(e);if(1==c.length)return function(e,t,o,n=1024){const i=function(e,t){let o=1;for(const n of e)for(let e=n.length;e>0;e--)if((o*=e)>t)return t;return o}(e.levels,n+1);if(1==e.vertices.length||i>n)return l(e.levels,t,o=o);{let n=null,i=1/0;const r=e.levels.map(e=>(function e(t,o=!1){if(0==t.length)return[[]];const n=[];let i=t[0];let r=t.slice(1,void 0);for(let o=0;o<t.length;o++){for(const t of e(r,!0))t.push(i),n.push(t);[i,r[o]]=[r[o],i]}if(!o)for(const e of n)e.reverse();return n})(e,!0));for(const a of function e(t,o=0){if(o==t.length)return[[]];const n=[];for(const i of t[o])for(const r of e(t,o+1))r.push(i),n.push(r);if(0==o)for(const e of n)e.reverse();return n}(r)){const r=l(a,t,o),[s,c]=r;let d=0;for(const[t,o]of e.edges)d+=Math.abs(c.get(t).y-c.get(o).y);d<i&&(n=r,i=d)}return p(null!=n,"bestEmbedding is null",n),n}}(c[0],t,n);{const e=c.map(e=>r(e,t,n)),o=s(e,a.HORIZONTAL,n);return o}})(e,n,c)),a.VERTICAL_REARRANGED,c)}function l(e,t,o){const n=[];for(const i of e){const e=[];for(const o of i){const{width:n,height:i}=t.get(o),r={left:n/2,right:n/2,top:i/2,bottom:i/2,weight:n*i},l=new Map([[o,{x:0,y:0}]]);e.push([r,l])}const r=s(e,a.VERTICAL,o);n.push(r)}return s(n,a.HORIZONTAL,o)}let a;function s(e,t,o){const n=e.map(e=>e[0]),i=e.map(e=>e[1]);let r,l;if(t==a.HORIZONTAL)[r,l]=function(e,t){const o=(c(e.map(e=>e.left+e.right))+(e.length-1)*t.x)/2,n=o,i=Math.max(...e.map(e=>e.top)),r=Math.max(...e.map(e=>e.bottom)),l=c(e.map(e=>e.weight));let a=[],s=-o;for(const o of e)s+=o.left,a.push({x:s,y:0}),s+=o.right,s+=t.x;return[{left:o,right:n,top:i,bottom:r,weight:l},a]}(n,o);else if(t==a.VERTICAL)[r,l]=d(n,o);else{if(t!=a.VERTICAL_REARRANGED)throw new Error("direction must be HORIZONTAL or VERTICAL or VERTICAL_REARRANGED");[r,l]=d(n,o,!0)}let s=new Map;for(let t=0;t<e.length;t++)for(const[e,o]of i[t])s.set(e,(h=l[t],u=o,{x:h.x+u.x,y:h.y+u.y}));var h,u;return[r,s]}function c(e){let t=0;for(const o of e)t+=o;return t}function d(e,t,o=!1){e.length;let n=0,i=0,r=0;const l=o?function(e){const t=e.map((e,t)=>[t,e]);t.sort((e,t)=>t[1].weight-e[1].weight);let o=[],n=[];for(let e=0;e<t.length;e++)e%2==0?o.push(t[e]):n.push(t[e]);return n.reverse(),n.push(...o),n}(e):e.map((e,t)=>[t,e]);for(const[e,o]of l)r+=o.top,n+=o.weight,i+=o.weight*r,r+=o.bottom,r+=t.y;const a=n>0?i/n:0,s=[];r=-a;for(const[e,o]of l)r+=o.top,s[e]={x:0,y:r},r+=o.bottom,r+=t.y;const c=a,d=r-t.y;return[{left:Math.max(...e.map(e=>e.left)),right:Math.max(...e.map(e=>e.right)),top:c,bottom:d,weight:n},s]}function h(e,t){const o=e.get(t);if(o==t)return t;{const n=h(e,o);return e.set(t,n),n}}function u(e,t,o){const n=h(e,t),i=h(e,o),r=Math.min(n,i);return e.set(n,r),e.set(i,r),r}function p(e,...t){if(!e)throw console.error("AssertionError:",...t),new Error("AssertionError")}e.newDagEmpty=t,e.newDagFromPath=function(e){let t={levels:e.map(e=>[e]),edges:[],vertices:[...e],in_neighbors:new Map};for(let o=0;o<e.length-1;o++)t.edges.push([e[o],e[o+1]]);return n(t),t},e.newDagFromPrecedence=o,e.embedDag=function(e,t,o={x:0,y:0},n=0,i=0,l=0,a=0){let s,c;return 0==e.vertices.length?(s={left:0,right:0,top:0,bottom:0,weight:0},c=new Map):[s,c]=r(e,t,o),s.left+=n,s.right+=i,s.top+=l,s.bottom+=a,[s,c]},function(e){e[e.HORIZONTAL=0]="HORIZONTAL",e[e.VERTICAL=1]="VERTICAL",e[e.VERTICAL_REARRANGED=2]="VERTICAL_REARRANGED"}(a||(a={}))}(a||(a={}));var s,c,d=function(e,t,o,n){return new(o||(o=Promise))(function(i,r){function l(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(l,a)}s((n=n.apply(e,t||[])).next())})};!function(r){function l(e,t=n.ZOOM_STEP_RATIO,o){i.zoomInfoZoomOut(e.zoom,t);let[r,l]=void 0!=o?[o[0]/e.screen.width,o[1]/e.screen.height]:[.5,.5],s=e.screen.width*e.zoom.xZoomout,c=e.screen.height*e.zoom.yZoomout,{x:d,y:h,width:p,height:f}=e.visWorld;e.visWorld.x=d+(p-s)*r,e.visWorld.y=h+(f-c)*l,e.visWorld.width=s,e.visWorld.height=c,g(e),u(e),a(e)}function a(e){e.mainDiv.selectAll("div.button#zoom-out").attr("disabled",e.zoom.zoomout>=e.zoom.maxZoomout?"true":null),e.mainDiv.selectAll("div.button#zoom-in").attr("disabled",e.zoom.zoomout<=e.zoom.minZoomout?"true":null),e.mainDiv.selectAll("div.button#zoom-reset").attr("disabled",e.zoom.zoomout==e.zoom.initialZoomout?"true":null)}function s(t,o){return(o=o||t.mainDiv.select("div.tooltip")).style("left",e.event.clientX+n.TOOLTIP_OFFSET.x).style("top",e.event.clientY+n.TOOLTIP_OFFSET.y)}function c(t,o=(t=>e.select(t))){t.on("mouseenter.point",(e,t,n)=>{o(n[t]).attr("pointed","true")}),t.on("mouseleave.point",(e,t,n)=>{o(n[t]).attr("pointed",null)})}function h(e){return new Promise(t=>setTimeout(t,e))}function u(e,t=!0){let o=t?n.TRANSITION_DURATION:0,r=e.canvas.select("g.nodes").selectAll("g.node").filter(e=>e.active);r.select("rect").transition().duration(o).attrs(t=>i.rectToScreen(e.visWorld,e.screen,t.visual.rect)),r.select("polygon").transition().duration(o).attr("points",t=>i.symCdfPolygonPoints(i.rectToScreen(e.visWorld,e.screen,t.visual.rect),t.cdf)),r.select("text").transition().duration(o).attrs(t=>{let{x:o,y:r,height:l,width:a}=i.rectToScreen(e.visWorld,e.screen,t.visual.rect);return{x:o+a/2,y:r+l+n.HANGING_TEXT_OFFSET}}).style("opacity",t=>p(e,t)?1:0),e.canvas.select("g.edges").selectAll("line").transition().duration(o).attrs(t=>i.lineToScreen(e.visWorld,e.screen,t));let l=n.ARC_MAX_MINOR/e.zoom.yZoomout,a=e.data;a.beta_connectivity.forEach(e=>e[3]=a.nodes[e[0]].active&&a.nodes[e[1]].active?1:0),e.canvas.select("g.beta-connectivity").selectAll("path").transition().duration(o).attr("d",t=>{if(0==t[3])return"";let[o,n,r]=t,a=e.data.nodes[o].visual.rect,s=e.data.nodes[n].visual.rect,c=i.lineToScreen(e.visWorld,e.screen,{x1:a.x+.5*a.width,y1:a.y+.5*a.height,x2:s.x+.5*s.width,y2:s.y+.5*s.height}),d=e.zoom.yZoomout/e.zoom.xZoomout;return i.arcPathD_ellipse(c,e.world.width/e.zoom.xZoomout,l,1==r,d)})}function p(e,t){return i.rectToScreen(e.visWorld,e.screen,t.visual.rect).width>=n.MINIMAL_WIDTH_FOR_SSE_LABEL}function f(e,t=0){return e.transition().delay(t).duration(n.TRANSITION_DURATION).style("opacity",0).remove()}function v(e,t=0){if(0==e.size())return e.transition();let o=e.style("opacity");return e.style("opacity",0).transition().delay(t).duration(n.TRANSITION_DURATION).style("opacity",o)}function g(e){let{x:t,y:o,width:r,height:l}=e.world,{x:a,y:s,width:c,height:d}=e.visWorld;c<r*n.MAX_X_ZOOMOUT?e.visWorld.x=i.constrain(a,t-n.MAX_EMPTY_X_MARGIN*c,t+r+n.MAX_EMPTY_X_MARGIN*c-c):e.visWorld.x=t+.5*r-.5*c,d<l*n.MAX_Y_ZOOMOUT?e.visWorld.y=i.constrain(s,o-n.MAX_EMPTY_Y_MARGIN*d,o+l+n.MAX_EMPTY_Y_MARGIN*d-d):e.visWorld.y=o+.5*l-.5*d}r.zoomOut=l,r.zoomIn=function(e,t=n.ZOOM_STEP_RATIO,o){l(e,1/t,o)},r.zoomAll=function(e){i.zoomInfoSetZoomout(e.zoom,e.zoom.initialZoomout),e.visWorld=i.centeredVisWorld(e.world,e.screen,e.zoom),u(e),a(e)},r.zoomSet=function(e,t,o){i.zoomInfoSetZoomout(e.zoom,t);let[n,r]=null!==o&&void 0!==o?o:i.rectangleCenter(e.visWorld),l=e.screen.width*e.zoom.xZoomout,s=e.screen.height*e.zoom.yZoomout;e.visWorld={x:n-.5*l,y:r-.5*s,width:l,height:s},g(e),u(e,!1),a(e)},r.shift=function(e,t,o){let{width:n,height:i}=e.visWorld;e.visWorld.x+=t*n,e.visWorld.y+=o*i,g(e),u(e)},r.shiftByMouse=function(e,t,o){let{width:n,height:i}=e.visWorld,{width:r,height:l}=e.screen;e.visWorld.x+=t*n/r,e.visWorld.y+=o*i/l,g(e),u(e,!1)},r.setTooltips=function(t,o,i,r=!1,l=!1){if(null===i)o.on("mouseenter.tooltip",null).on("mousemove.tooltip",null).on("mouseleave.tooltip",null).on("click.tooltip",null);else{let a=i.map(e=>null!=e),c=i.filter(e=>null!=e);o.filter((e,t)=>a[t]).on("mouseenter.tooltip",(o,i,r)=>(function(t,o,i,r=!1){var l;if("pinned"!=e.select(o).attr("tooltip")){let a=t.mainDiv.append("div").attr("class","tooltip").attr("type","hover").html(i);s(t,a),null===(l=e.select(o))||void 0===l||l.attr("tooltip","hover"),v(a,r?n.TOOLTIP_DELAY:0)}})(t,r[i],c[i],l)).on("mousemove.tooltip",(e,o)=>(function(e){s(e,e.mainDiv.selectAll("div.tooltip[type=hover]"))})(t)).on("mouseleave.tooltip",(e,o)=>(function(e){e.mainDiv.selectAll("div.tooltip[type=hover]").remove(),e.mainDiv.selectAll("[tooltip=hover]").attr("tooltip",null)})(t)),r&&o.filter((e,t)=>a[t]).on("click.tooltip",(o,n,i)=>(function(t,o,n){var i;let r=t.mainDiv.append("div").attr("class","tooltip").attr("type","pre-pinned").html(n);s(t,r),null===(i=e.select(o))||void 0===i||i.attr("tooltip","pre-pinned"),t.mainDiv.on("click.tooltip",()=>{t.mainDiv.selectAll("div.tooltip[type=hover],div.tooltip[type=pinned]").remove(),t.mainDiv.selectAll("div.tooltip[type=pre-pinned]").attr("type","pinned"),t.mainDiv.selectAll("[tooltip=hover],[tooltip=pinned]").attr("tooltip",null),t.mainDiv.selectAll("[tooltip=pre-pinned]").attr("tooltip","pinned")})})(t,i[n],c[n])),o.filter((e,t)=>!a[t]).on("mouseenter.tooltip",null).on("mousemove.tooltip",null).on("mouseleave.tooltip",null).on("click.tooltip",null)}},r.addPointBehavior=c,r.addPickBehavior=function(t,o,n=(t=>e.select(t))){o.on("click.pick",(e,t,o)=>{n(o[t]).attr("picked","pre-picked")}),t.guiDiv.on("click.pick",()=>{t.guiDiv.selectAll("[picked=picked]").attr("picked",null),t.guiDiv.selectAll("[picked=pre-picked]").attr("picked","picked")})},r.addMouseHoldBehavior=function(t,o,i,r){t.on("mousedown",()=>d(this,void 0,void 0,function*(){if(1==e.event.which||void 0==e.event.which){let e=Math.random().toString(36).slice(2);for(o(),t.attr("pressed",e),yield h(n.MOUSE_HOLD_BEHAVIOR_INITIAL_SLEEP_TIME);t.attr("pressed")==e;)i(),yield h(n.MOUSE_HOLD_BEHAVIOR_STEP_SLEEP_TIME)}})),t.on("mouseup",()=>d(this,void 0,void 0,function*(){t.attr("pressed",null),r()})),t.on("mouseleave",()=>d(this,void 0,void 0,function*(){t.attr("pressed",null),r()}))},r.recolor=function(i,r=!0){let l=r?n.TRANSITION_DURATION:0;i.canvas.select("g.nodes").selectAll("g.node").selectAll("rect,polygon").transition().duration(l).style("fill",e=>e.visual.fill).style("stroke",e=>e.visual.stroke);let a=i.canvas.select("g.beta-connectivity").selectAll("path");if(i.settings.colorMethod!=o.ColorMethod.Stdev)a.style("stroke",e=>i.data.nodes[e[0]].visual.stroke);else{let e=t.NEUTRAL_DARK.hex();a.style("stroke",e)}!function(o,i,r=!0){var l,a,s,c;if(f(o.canvas.selectAll("g.heatmap-bar")),i){let i=function(o,i,r,l,a,s=""){let c=o.append("g").attr("class","heatmap-bar").attr("transform",`translate(${i.x},${i.y})`),d=(c.append("text").attr("class","heatmap-bar-label").attrs({x:-5,y:.5*i.height}).text(s),Math.floor(i.width)),h=(i.width-1)/d,u=c.append("g").attr("class","heatmap-bar-fill"),p=c.append("g").attr("class","heatmap-bar-stroke");return u.selectAll("rect").data(e.range(d)).enter().append("rect").attrs(e=>({x:e*h,y:0,width:h+1,height:i.height,stroke:"none",fill:t.byExpHeatmap(e/d*r,l).hex()})),p.append("rect").attrs(e=>({x:0,y:0,width:i.width,height:i.height,fill:"none"})),c.append("g").attr("class","heatmap-bar-ticks").selectAll("text").data(e.range(Math.floor(r/a)+1)).enter().append("text").attr("x",e=>e*a/r*i.width).attr("y",i.height+n.HANGING_TEXT_OFFSET).text(e=>e*a),c}(o.canvas,{x:o.screen.width-200-15,y:5,width:200,height:20},15,5,5,"3D variability [Å]"),d=null===(a=null===(l=o.mainDiv.select("div.control-panel#main-panel").node())||void 0===l?void 0:l.getBoundingClientRect())||void 0===a?void 0:a.right,h=null===(c=null===(s=i.node())||void 0===s?void 0:s.getBoundingClientRect())||void 0===c?void 0:c.left;void 0!==d&&void 0!==h&&d>h&&function(e,t,o,i){e.attr("transform",`translate(${t},${o})`);let r=e.select("g.heatmap-bar-ticks").selectAll("text"),l=e.select("g.heatmap-bar-stroke rect").attr("height");i?(r.attr("y",-n.HANGING_TEXT_OFFSET),r.style("dominant-baseline","alphabetic")):(r.attr("y",l+n.HANGING_TEXT_OFFSET),r.style("dominant-baseline","hanging"))}(i,o.screen.width-200-15,o.screen.height-5-20,!0),r&&v(i)}}(i,i.settings.colorMethod==o.ColorMethod.Stdev,r)},r.redraw=u,r.nodeBigEnoughForLabel=p,r.showBetaConnectivity=function(e,t,o=!0){e.settings.betaConnectivityVisibility=t;let n=e.canvas.selectAll("g.beta-connectivity");if(n.size()>0&&!t)o?f(n):n.remove();else if(0==n.size()&&t){let t=e.data;t.beta_connectivity.forEach(e=>e[3]=t.nodes[e[0]].active&&t.nodes[e[1]].active?1:0);let n=e.canvas.append("g").attr("class","beta-connectivity");c(n.selectAll().data(t.beta_connectivity).enter().append("path").style("stroke",e=>t.nodes[e[0]].visual.stroke)),u(e,!1),o&&v(n)}},r.fadeOutRemove=f,r.fadeIn=v}(s||(s={})),function(t){function o(){return e.selectAll()}function r(e,t,n,i,r,a){let s={base:{viewer:e,id:t,children:[],div:o(),tooltip:a,show:e=>l(s,e)},text:n,square:i,onClick:r};return s}function l(t,o){t.base.div=o.append("div").attr("class",t.square?"button square-button":"button").attr("id",t.base.id),t.base.div.append("div").attr("class","button-text").html(t.text),s.setTooltips(t.base.viewer,t.base.div,[t.base.tooltip],!1,!0),t.base.div.on("click",t.onClick),t.base.div.on("dblclick",()=>{e.event.stopPropagation()})}function a(e,t){e.text=t,e.base.div.select("div.button-text").html(t)}function c(t,i,a,s,c){let d={base:{viewer:t,id:i,children:[],div:o(),tooltip:c,show:e=>(function(e,t){e.base.div=t.append("div").attr("class",e.autocollapse?"popup autocollapse":"popup").attr("id",e.base.id);let o=e.base.div.append("div").attr("class","popup-head");e.base.div.data([e]),l(e.headButton,o)})(d,e)},headButton:r(t,null,a+n.OPEN_POPUP_SYMBOL,!1,()=>(function(t){t.base.div.selectAll("div.popup-tail").size()>0?h(t):(u(t.base.viewer),function(t){var o;let n=t.base.div.select("div.popup-head"),i=t.base.div.append("div").attr("class","popup-tail");t.base.children.forEach(e=>e.base.show(i));let r=n.node().getBoundingClientRect().width,l=null===(o=i.node())||void 0===o?void 0:o.getBoundingClientRect().width;void 0!==l&&void 0!==r&&l<r&&i.style("width",r);t.autocollapse&&(t.base.viewer.mainDiv.on("click.autocollapse-popups",()=>u(t.base.viewer)),i.on("click.autocollapse-popups",()=>e.event.stopPropagation()))}(t),e.event.stopPropagation())})(d),c),autocollapse:s};return d}function d(e,t){e.base.children.push(t)}function h(e){e.base.div.selectAll("div.popup-tail").remove()}function u(e){e.mainDiv.selectAll("div.popup.autocollapse").each(e=>h(e))}function p(e,t){a(e.headButton,t+n.OPEN_POPUP_SYMBOL)}function f(e,t,n,i,r,l){let a={base:{viewer:e,id:t,children:[],div:o(),tooltip:l,show:e=>(function(e,t){e.base.div=t.append("div").attr("class","listbox").attr("id",e.base.id);e.base.div.selectAll().data(e.namesValuesTooltips).enter().append("div").attr("class",t=>t[1]==e.selectedValue?"button listbox-item selected":"button listbox-item").on("click",t=>{e.selectedValue=t[1],e.base.div.selectAll("div.listbox-item").attr("class",t=>t[1]==e.selectedValue?"button listbox-item selected":"button listbox-item"),e.onSelect(t[1])}).append("div").attr("class","button-text").html(e=>e[0]),s.setTooltips(e.base.viewer,e.base.div.selectAll("div.listbox-item"),e.namesValuesTooltips.map(e=>e[2]),!1,!0),s.setTooltips(e.base.viewer,e.base.div,[e.base.tooltip],!1,!0)})(a,e)},namesValuesTooltips:n,selectedValue:i,onSelect:r};return a}function v(e,t,n,i,r,l,a,s,c,d,h){let u={base:{viewer:e,id:t,children:[],div:o(),tooltip:h,show:e=>g(u,e)},minValue:n,maxValue:i,step:r,selectedValue:l,minValueLabel:null!==a&&void 0!==a?a:n.toString(),maxValueLabel:null!==s&&void 0!==s?s:i.toString(),onMove:c,onRelease:d};return u}function g(t,o){t.base.div=o.append("div").attr("class","slider").attr("id",t.base.id);let n=t.base.div.append("div").attr("class","slider-left-value").text(t.minValueLabel),i=t.base.div.append("div").attr("class","slider-right-value").text(t.maxValueLabel),r=t.base.div.append("div").attr("class","slider-main"),l=r.append("div").attr("class","slider-rail-ruler");l.append("div").attr("class","slider-rail");let a=l.append("div").attr("class","slider-rail-clickable"),c=l.append("div").attr("class","slider-handle-ruler"),d=c.append("div").attr("class","slider-handle"),h=E(t,t.selectedValue);c.style("left",100*h+"%"),s.setTooltips(t.base.viewer,r,[t.base.tooltip],!1,!0),s.setTooltips(t.base.viewer,n,["Click/hold to decrease value."],!1,!0),s.setTooltips(t.base.viewer,i,["Click/hold to increase value."],!1,!0);let u=e.drag().on("start.slider",()=>A(t,e.event.sourceEvent)).on("drag.slider",()=>A(t,e.event.sourceEvent)).on("end.slider",()=>(function(e,t){let o=T(e,t);if(null!==o){let t=w(e,o);t=_(e,t),o=E(e,t),e.base.div.select("div.slider-handle-ruler").style("left",100*o+"%"),e.selectedValue=t,e.onRelease(t)}})(t,e.event.sourceEvent));u(a),u(d),s.addMouseHoldBehavior(n,()=>m(t,-1),()=>m(t,-1),()=>{}),s.addMouseHoldBehavior(i,()=>m(t,1),()=>m(t,1),()=>{})}function m(e,t){let o=i.constrain(e.selectedValue+t*e.step,e.minValue,e.maxValue),n=E(e,o);e.base.div.select("div.slider-handle-ruler").style("left",100*n+"%"),e.selectedValue=o,e.onMove(o),e.onRelease(o)}function E(e,t){let o=(t-e.minValue)/(e.maxValue-e.minValue);return o=i.constrain(o,0,1)}function w(e,t){return e.minValue+t*(e.maxValue-e.minValue)}function _(e,t){let o=Math.round((t-e.minValue)/e.step);return e.minValue+o*e.step}function T(e,t){let o=e.base.div.selectAll("div.slider-rail-ruler").node();if(null!==o){let{x:e,width:n}=o.getBoundingClientRect(),r=(t.clientX-e)/n;return r=i.constrain(r,0,1)}return null}function A(e,t){let o=T(e,t);if(null!==o){let t=w(e,o);o=E(e,t=_(e,t)),e.base.div.select("div.slider-handle-ruler").style("left",100*o+"%"),e.onMove(t)}}t.newControlPanel=function(e,t,n){let i={base:{viewer:e,id:t,children:[],div:o(),tooltip:n,show:e=>(function(e,t){e.base.div=t.append("div").attr("class","control-panel").attr("id",e.base.id),e.base.children.forEach(t=>t.base.show(e.base.div))})(i,e)}};return i},t.addToControlPanel=function(e,t){e.base.children.push(t)},t.newButton=r,t.changeButtonText=a,t.newPopup=c,t.addToPopup=d,t.newListbox=f,t.newDropdownList=function(e,t,o,n,i,r,l,a=!0,s=!0){let u=c(e,t,o,a,l),p=f(e,t,n,i,s?e=>{h(u),r(e)}:r,null);return d(u,p),u},t.newSlider=v,t.showSlider=g,t.newPopupSlider=function(e,t,o,n,i,r,l,a,s,h,u,f,g,m=!0){let E=c(e,t,o+a+n,m,g),w=v(e,t,i,r,l,a,s,h,e=>{p(E,o+e+n),u(e)},e=>{p(E,o+e+n),f(e)},null);return d(E,w),E}}(c||(c={}));var h,u=function(e,t,o,n){return new(o||(o=Promise))(function(i,r){function l(e){try{s(n.next(e))}catch(e){r(e)}}function a(e){try{s(n.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(l,a)}s((n=n.apply(e,t||[])).next())})};!function(d){function h(e,t){e.data=t,r.filterDagAndAddLevels(e.data,e.settings.occurrenceThreshold),p(e)}function p(t){if(t.canvas.selectAll("*").remove(),null!==t.data.error)return void t.canvas.append("text").attr("class","central-message").attrs({x:t.screen.width/2,y:t.screen.height/2}).text("Error: "+t.data.error);if(0==t.data.activeNodes.length)return void t.canvas.append("text").attr("class","central-message").attrs({x:t.screen.width/2,y:t.screen.height/2}).text("No secondary structure elements");let l=t.data,c=t.settings.shapeMethod==o.ShapeMethod.SymCdf?l.nodes.map(e=>e.cdf[e.cdf.length-1][0]*n.LENGTH_SCALE):l.nodes.map(e=>e.avg_length*n.LENGTH_SCALE),d=l.nodes.map(e=>e.occurrence*n.OCCURRENCE_SCALE);if(t.settings.layoutMethod==o.LayoutMethod.Old){let e=l.nodes.length,o=l.levels.length,i=new Array(e),a=new Array(e),s=new Array(e).fill(0),h=0;for(let e=0;e<o;e++){const t=l.levels[e];let o=t.length;for(let e=0;e<o;e++){const n=t[e];i[n]=h,a[n]=h+c[n],s[n]=e-(o-1)/2}h=Math.max(...t.map(e=>a[e]))+n.GAP_LENGTH}for(let e=0;e<l.nodes.length;e++)l.nodes[e].visual=r.newNodeVisual(),l.nodes[e].active?l.nodes[e].visual.rect={x:i[e],width:c[e],y:s[e]*n.FLOOR_HEIGHT-d[e]/2,height:d[e]}:l.nodes[e].visual.rect={x:-n.LEFT_MARGIN,width:0,y:0,height:0};let u=h-n.GAP_LENGTH,p=Math.min(...s),f=Math.max(...s),v=-n.LEFT_MARGIN,g=u+n.RIGHT_MARGIN,m=p*n.FLOOR_HEIGHT-.5*n.OCCURRENCE_SCALE-n.TOP_MARGIN,E=f*n.FLOOR_HEIGHT+.5*n.OCCURRENCE_SCALE+n.BOTTOM_MARGIN;t.world={x:v,y:m,width:g-v,height:E-m}}else if(t.settings.layoutMethod==o.LayoutMethod.New){let e=a.newDagFromPrecedence(l.levels,l.precedence),o=new Map;for(const t of e.vertices)o.set(t,{width:c[t],height:d[t]});const[i,s]=a.embedDag(e,o,{x:n.GAP_LENGTH,y:n.FLOOR_HEIGHT-n.OCCURRENCE_SCALE},n.LEFT_MARGIN,n.RIGHT_MARGIN,n.TOP_MARGIN,n.BOTTOM_MARGIN);t.world={x:-i.left,y:-i.top,width:i.right+i.left,height:i.bottom+i.top};for(let e=0;e<l.nodes.length;e++)if(l.nodes[e].visual=r.newNodeVisual(),l.nodes[e].active){const{x:t,y:n}=s.get(e),{width:i,height:r}=o.get(e);l.nodes[e].visual.rect={x:t-i/2,y:n-r/2,width:i,height:r}}else l.nodes[e].visual.rect={x:t.world.x,y:t.world.y,width:0,height:0}}let h=i.zoomAllZoomout(t.world,t.screen),u=(n.OCCURRENCE_SCALE+n.TOP_MARGIN+n.BOTTOM_MARGIN)/t.screen.height,p=t.world.height/t.screen.height,g=u/10,m=h*n.MAX_X_ZOOMOUT;t.zoom=i.newZoomInfo(g,m,u,p,h),t.visWorld=i.centeredVisWorld(t.world,t.screen,t.zoom),l.precedenceLines=[];for(const e of l.precedence){let t=l.nodes[e[0]].visual.rect,o=l.nodes[e[1]].visual.rect,i=t.x+t.width,r=t.y+t.height/2,a=o.x,s=o.y+o.height/2;l.precedenceLines.push({x1:i,y1:r,x2:i+n.KNOB_LENGTH,y2:r}),l.precedenceLines.push({x1:i+n.KNOB_LENGTH,y1:r,x2:a-n.KNOB_LENGTH,y2:s}),l.precedenceLines.push({x1:a-n.KNOB_LENGTH,y1:s,x2:a,y2:s})}let E,w=t.canvas.append("g").attr("class","nodes").selectAll("g.node").data(l.nodes).enter().append("g").attr("class","node").attr("opacity",e=>e.active?1:0);(E=t.settings.shapeMethod==o.ShapeMethod.SymCdf?w.append("polygon"):w.append("rect")).filter(e=>e.active);s.addPointBehavior(E,t=>e.select(t.parentElement)),s.addPickBehavior(t,E,t=>e.select(t.parentElement)),s.setTooltips(t,E,w.data().map(f),!0,!1),w.append("text").attr("class","node-label").style("opacity",e=>s.nodeBigEnoughForLabel(t,e)?1:0).text(e=>e.label),t.canvas.append("g").attr("class","edges").selectAll().data(l.precedenceLines).enter().append("line").attr("stroke",n.EDGE_COLOR),s.showBetaConnectivity(t,t.settings.betaConnectivityVisibility,!1),v(t,t.settings.colorMethod,!1),s.zoomAll(t),s.redraw(t,!1)}function f(e){if(e.active){let[t,o]=r.getNodeMinMaxLength(e);return['<div class="node-tooltip">',`<span class="tooltip-title">${e.label}</span>`,"<table>",`<tr><td>Type:</td><td>${"e"==e.type?"Strand":"Helix"}</td></tr>`,`<tr><td>Occurrence:</td><td>${i.round(100*e.occurrence,1)}%</td></tr>`,`<tr><td>Min. length:</td><td>${t} residues</td></tr>`,`<tr><td>Avg. length:</td><td>${i.round(e.avg_length,2)} residues</td></tr>`,`<tr><td>Max. length:</td><td>${o} residues</td></tr>`,`<tr><td>3D variability:</td><td>${i.round(e.stdev3d,2)} &#8491;</td></tr>`,"e"==e.type?`<tr><td>Sheet:</td><td>${e.sheet_id}</td></tr>`:"","</table>","</div>"].join("")}return null}function v(e,i,r=!0){e.settings.colorMethod=i,e.data.nodes.forEach((e,r)=>{let l;switch(i){case o.ColorMethod.Uniform:l=t.NEUTRAL_COLOR;break;case o.ColorMethod.Type:l=t.bySseType(e.type);break;case o.ColorMethod.Sheet:l=t.byIndex1(e.sheet_id);break;case o.ColorMethod.Stdev:l=t.byExpHeatmap(e.stdev3d,n.HEATMAP_MIDDLE_VALUE)}e.visual.fill=l.hex(),e.visual.stroke=l.darker().hex()}),s.recolor(e,r)}d.initializeViewer=function(t){var a;let d=l.newSettingsFromHTMLElement(t);const f=t.id||"",g=`${f}-${Math.random().toString(36).slice(2)}`;console.log(`Initializing OverProt viewer with id="${f}", file="${d.file}"`),e.select(t).selectAll(":scope > *").remove();let m=e.select(t).append("div").attr("class","overprot-viewer").attr("id","overprot-viewer-"+g),E=m.append("div").attr("class","gui").styles({width:d.width,height:d.height}),w=null===(a=E.node())||void 0===a?void 0:a.getBoundingClientRect();if(void 0!==w){let{width:e,height:t}=w;d.width=e,d.height=t}let _=E.append("div").attr("class","canvas").append("svg").attr("class","canvas").attrs({width:d.width,height:d.height}),T=l.newViewer(f,g,m,E,_,d);if(function(e){let t=e.guiDiv.append("div").attr("class","internal-controls"),i=[["Uniform",o.ColorMethod.Uniform,"Show all SSEs in the same color."],["Type",o.ColorMethod.Type,"Show &beta;-strands in blue, helices in gray."],["Sheet",o.ColorMethod.Sheet,"Assign the same color to &beta;-strands from the same &beta;-sheet, <br>show helices in gray."],["Variability",o.ColorMethod.Stdev,"<strong>3D variability</strong> measures the standard deviation of the SSE end point coordinates.<br>Low values (dark) indicate conserved SSE position, <br>high values (bright) indicate variable SSE position."]],l=[["Rectangle",o.ShapeMethod.Rectangle,"Show SSEs as rectangles. <br>Height of the rectangle indicates <strong>occurrence</strong> (what percentage of structures contain this SSE), <br>width indicates <strong>average length</strong> (number of residues)."],["SymCDF",o.ShapeMethod.SymCdf,"<strong>Cumulative distribution function</strong> describes the statistical distribution of the SSE length. <br>The widest part of the shape corresponds to maximum length, the narrowest to minimum length, <br> the height corresponds to occurrence. <br>(The SymCDF shape consists of four symmetrical copies of the CDF, the bottom right quarter is the classical CDF.)"]],a=c.newControlPanel(e,"main-panel",null),d=c.newButton(e,"zoom-in","+",!0,()=>s.zoomIn(e),"Zoom in. <br>Tip: Use Ctrl + mouse wheel to zoom.");c.addToControlPanel(a,d);let u=c.newButton(e,"zoom-out","-",!0,()=>s.zoomOut(e),"Zoom out. <br>Tip: Use Ctrl + mouse wheel to zoom.");c.addToControlPanel(a,u);let f=c.newButton(e,"zoom-reset",n.RESET_SYMBOL,!0,()=>s.zoomAll(e),"Reset zoom. <br>Tip: Use double click to reset zoom.");c.addToControlPanel(a,f);let g=c.newDropdownList(e,"color-method","Color",i,e.settings.colorMethod,t=>v(e,t),"Choose coloring method.",!0,!1);c.addToControlPanel(a,g);let m=c.newDropdownList(e,"shape-method","Shape",l,e.settings.shapeMethod,t=>(function(e,t){e.settings.shapeMethod=t,h(e,e.data)})(e,t),"Choose shape method.",!0,!1);c.addToControlPanel(a,m);let E=c.newDropdownList(e,"beta-connectivity","Beta-connectivity",[["On",!0,null],["Off",!1,null]],e.settings.betaConnectivityVisibility,t=>s.showBetaConnectivity(e,t,!0),"<strong>Beta-connectivity</strong> shows how &beta;-strands are connected to each other in &beta;-sheets.<br>Upper arcs indicate antiparallel connections,<br>lower arcs indicate parallel connections.",!0,!1);c.addToControlPanel(a,E);let w=c.newPopupSlider(e,"occurrence-threshold","Occurrence threshold: ","%",0,100,1,100*e.settings.occurrenceThreshold,"0%","100%",e=>{},t=>(function(e,t){e.settings.occurrenceThreshold=t,r.filterDagAndAddLevels(e.data,t),p(e)})(e,t/100),"Hide SSEs with occurrence lower than the specified threshold.");c.addToControlPanel(a,w),a.base.show(t)}(T),m.append("br"),_.on("dblclick",()=>s.zoomAll(T)),_.on("wheel",()=>{if(e.event.ctrlKey){let t=e.event.deltaY>0?n.ZOOM_STEP_RATIO_MOUSE:1/n.ZOOM_STEP_RATIO_MOUSE;s.zoomOut(T,t,e.mouse(_.node())),e.event.preventDefault()}else{let e=T.canvas.selectAll("text.temporary-central-message").data([1]).enter().append("rect").attr("class","temporary-central-message-background").attrs({x:0,width:T.screen.width,y:0,height:T.screen.height}),t=T.canvas.selectAll("text.temporary-central-message").data([1]).enter().append("text").attr("class","temporary-central-message").attrs({x:T.screen.width/2,y:T.screen.height/2}).text("Use Ctrl + scroll to zoom");s.fadeIn(e),s.fadeIn(t),s.fadeOutRemove(e,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT),s.fadeOutRemove(t,n.TEMPORARY_CENTRAL_MESSAGE_TIMEOUT)}}),e.drag().on("drag",()=>s.shiftByMouse(T,-e.event.dx,-e.event.dy))(_),e.select(window).on("resize."+g,()=>{let e=E.node().getBoundingClientRect();!function(e,t,o){let n=e.zoom.zoomout!=e.zoom.initialZoomout,r=e.zoom.zoomout,l=e.visWorld,a=r*e.screen.width/t;e.canvas.attr("width",t).attr("height",o),e.screen.width=t,e.screen.height=o,p(e),n&&s.zoomSet(e,a,i.rectangleCenter(l))}(T,e.width,e.height)}),T.canvas.append("text").attr("class","central-message").attrs({x:T.screen.width/2,y:T.screen.height/2}).text("Loading..."),""!=d.file){let e=new URL(d.file,document.baseURI).toString();fetch(e).catch(t=>u(this,void 0,void 0,function*(){console.error(`OverProt Viewer with id="${T.id}" failed to initialize because the request for`,e,"failed (this might be caused by CORS policy). Original error:",t);let o=r.newDagWithError(`Failed to fetch data from "${e}"`);h(T,o)})).then(t=>u(this,void 0,void 0,function*(){if(t&&t.ok){let e=yield t.text(),o=r.dagFromJson(e);h(T,o)}else if(t&&!t.ok){console.error(`OverProt Viewer with id="${T.id}" failed to initialize because the request for`,e,"returned status code",t.status,t.statusText);let o=r.newDagWithError(`Failed to fetch data from "${e}"`);h(T,o)}})).catch(e=>u(this,void 0,void 0,function*(){console.error(`OverProt Viewer with id="${T.id}" failed to initialize because of internal error.`);let t=r.newDagWithError("Internal error");throw h(T,t),e}))}else{let e=r.newDagWithError("No file specified");h(T,e)}}}(h||(h={})),function(e){window.customElements.define("overprot-viewer",class extends HTMLElement{constructor(){super()}connectedCallback(){this.initialize()}initialize(){return h.initializeViewer(this)}})}()}(d3);